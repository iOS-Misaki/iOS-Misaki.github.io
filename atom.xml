<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Misakiçš„å°ç«™</title>
  
  <subtitle>Stay Hungry, Stay Foolish</subtitle>
  <link href="/iOS-Misaki.github.io/atom.xml" rel="self"/>
  
  <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/"/>
  <updated>2018-12-31T09:21:43.527Z</updated>
  <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/</id>
  
  <author>
    <name>Misaki</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2018å¹´å¹´ç»ˆæ€»ç»“</title>
    <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/12/31/2018%E5%B9%B4%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/12/31/2018å¹´å¹´ç»ˆæ€»ç»“/</id>
    <published>2018-12-31T09:21:06.000Z</published>
    <updated>2018-12-31T09:21:43.527Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;&ensp;&ensp;12æœˆä¸€æ•´ä¸ªæœˆçš„996ï¼Œå¼„å¾—æ•´ä¸ªäººèº«å¿ƒäº¤ç˜ï¼Œè¶ç€å…ƒæ—¦ä¼‘æ¯çš„æ—¶é—´ï¼Œèµ¶åœ¨2018å¹´æœ€åä¸€å¤©ï¼Œå¹´ç»ˆæ€»ç»“ä¸€ä¸‹ã€‚</p><a id="more"></a><p>&ensp;&ensp;&ensp;&ensp;è¿›å…¥æ–°å…¬å¸çš„ä¸»è¦å·¥ä½œæ˜¯ï¼Œç”¨åŸç”Ÿä»£ç å®ç°PaaSç”µå•†é¡¹ç›®çš„æ•´ä¸ªæµç¨‹ï¼Œç„¶åå°†åŸºæœ¬åŠŸèƒ½ï¼Œä¾‹å¦‚UMã€è´­ç‰©è½¦ã€è®¢å•ã€å”®åã€æ”¶è—ç­‰å…¨éƒ¨è§£è€¦å‡ºæ¥ï¼Œä¸€ä¸ªä¸ªæ‰“æˆç§æœ‰åº“ï¼Œä¸»å·¥ç¨‹æ¥å¼•å…¥ç§æœ‰åº“çš„æ–¹å¼å®Œæˆç»„ä»¶åŒ–ã€‚å½“ç„¶è¿˜æœ‰å…¬å¸å…¶ä»–æ¥æ‰‹çš„äº”å…­ä¸ªé¡¹ç›®ï¼Œä¿®æ”¹è¿­ä»£ï¼Œæ²¡æœ‰ä»€ä¹ˆéš¾åº¦ï¼Œä½†æ˜¯ç¹çã€‚æ€»æ˜¯åœ¨å¿™ç€PaaSé¡¹ç›®ï¼Œåšç€åšç€å°±è¢«æ‰“æ–­å¤„ç†è¿™äº›é›¶ç¢çš„é¡¹ç›®ã€‚ä»äº¤ä»˜é¡¹ç›®ç»“æœæ¥çœ‹ï¼Œè¿˜æ˜¯äº‹ä¸æ„¿è¿ğŸ˜‚ã€‚äº¤ä»˜çš„é¡¹ç›®æ ¸å¿ƒä¸šåŠ¡éƒ½æ˜¯å‰ç«¯ç”¨Vueæ¥å®Œæˆçš„ï¼ŒAppå°±æ˜¯ç”¨<code>WebView</code>æ¥å±•ç¤ºï¼Œé€šè¿‡JSå’ŒåŸç”Ÿä»£ç çš„äº¤äº’ï¼Œæ¥è°ƒç”¨åŸç”Ÿçš„ç™»å½•ç™»å‡ºã€æ”¯ä»˜ç­‰ï¼ŒåŸç”Ÿçš„éƒ¨åˆ†åªæœ‰UMæ¨¡å—å’Œæ”¯ä»˜æ¨¡å—ã€‚<strong>è¿™ä¸ªè¿˜ç”¨å¾—ç€ç»„ä»¶åŒ–ä¹ˆğŸ˜‚ğŸ˜‚ğŸ˜‚</strong>ã€‚</p><p>&ensp;&ensp;&ensp;&ensp;å†æ¥çœ‹çœ‹ä¸ªäººæŠ€æœ¯æˆé•¿ã€‚å¯ä»¥ä¸2017å¹´åšä¸ªå¯¹æ¯”ï¼Œ17å¹´åˆçš„æ—¶å€™ä¸»è¦ç²¾åŠ›åœ¨å­¦ä¹ <code>Swift</code>è¯­è¨€æ–°ç‰¹æ€§ï¼Œ17å¹´ä¸‹åŠå¹´åˆ°ä»Šå¹´ä¸ŠåŠå¹´ï¼Œä¸»è¦ç²¾åŠ›æ”¾åœ¨äº†<code>Angular</code>å’Œ<code>HTML</code>ã€<code>JavaScript</code>ä¸Šé¢ã€‚åœ¨è¿­ä»£ç†ŠçŒ«ä¿ä¿çš„æ—¶å€™ï¼ŒiOSå¼€å‘ä»»åŠ¡ä¸é¥±å’Œï¼Œå·¥ä½œå†…å®¹ä¹Ÿå˜æˆä¸€å°åŠåŸç”Ÿå¼€å‘ï¼Œä¸€å¤§åŠå‰ç«¯<code>Angular</code>å¼€å‘ã€‚ä»Šå¹´å¼€é€šäº†<a href="https://juejin.im/user/5ab886906fb9a028b547df12" target="_blank" rel="noopener">æ˜é‡‘ä¸“æ </a>ï¼Œ<strong>è¿˜æ­å»ºäº†<a href="https://ios-misaki.github.io/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a>ï¼Œç®—ä¸Šä»Šå¤©ï¼Œä¸€å…±å†™äº†12ç¯‡æ–‡ç« </strong>ï¼Œå’Œå¹´åˆè®¢ä¸‹çš„æ¯åŠä¸ªæœˆå†™ç¯‡æŠ€æœ¯åšå®¢ç›®æ ‡å·®è·ä¸å°ã€‚è¦æƒ³æŠ€æœ¯åšå®¢ä¸æµäºå½¢å¼ï¼ˆä¸»è¦æ˜¯17å¹´ä¸ŠåŠå¹´ä¹‹å‰çš„åœ¨<a href="https://www.jianshu.com/u/abb55beb0e35" target="_blank" rel="noopener">ç®€ä¹¦</a>å‘è¡¨çš„æ–‡ç« éƒ½å¤ªè¿‡äºå½¢å¼åŒ–äº†ï¼‰ï¼ŒæŒç»­æœ‰å†…å®¹æœ‰æ·±åº¦ï¼Œå®ç°å¹´åˆçš„ç›®æ ‡æ„Ÿè§‰å¾ˆå›°éš¾ã€‚åœ¨æ–°å·¥ä½œåï¼Œå°±æ²¡æœ‰æ¨ªå‘å‘å±•äº†ï¼Œè¿˜æ˜¯ä¸“æ”»iOSè¿™å—ã€‚12ç¯‡æ–‡ç« ä¸­æœ‰4ç¯‡éƒ½å’Œç»„ä»¶åŒ–ç›¸å…³ï¼ŒåŒ…æ‹¬æ­å»ºç§æœ‰åº“ã€æ¨¡å—é—´è§£è€¦ã€ç»„ä»¶ä¹‹é—´é€šè®¯éƒ½æœ‰ä¸å°‘æ”¶è·ã€‚é™¤äº†è¿™äº›ï¼Œè¿˜é˜…è¯»äº†<code>SDWebImage</code>ã€<code>YTKNetwork</code>å’Œ<code>AFNetworking</code>çš„éƒ¨åˆ†æºç ï¼Œæ•´ç†äº†<code>Runtime</code>çš„ç›¸å…³ç”¨æ³•ï¼Œå­¦ä¹ äº†<code>CAAnimation</code>åŠ¨ç”»å’Œè‡ªå®šä¹‰è½¬åœºåŠ¨ç”»ã€‚</p><p>&ensp;&ensp;&ensp;&ensp;ä»å¹´ä¸­è·³æ§½ç»å†çš„é¢è¯•ç»“æœæ¥çœ‹ï¼ŒiOSå¼€å‘è¿˜æ˜¯ä»¥<code>OC</code>è¯­è¨€ä¸ºä¸»ï¼Œé¢è¯•ä¸­ä»…æœ‰ä¸€å®¶æå‡ºé¡¹ç›®æ˜¯ç”¨<code>Swift</code>è¯­è¨€å®Œæˆï¼Œå¤§å¤šæ•°ä¼š<code>Swift</code>åªæ˜¯ä¸€ä¸ªåŠ åˆ†é¡¹ã€‚ä½†æ˜¯åŸç”ŸiOSè¿™å—éœ€æ±‚è¢«å¤§å‰ç«¯èš•é£Ÿï¼Œå¤§ä¸€ç‚¹çš„å…¬å¸é™¤äº†è¦æ±‚å¯¹åº•å±‚åŸç†éå¸¸äº†è§£å¤–ï¼Œè¿˜éœ€è¦å¯¹æ·±åº¦ä¼˜åŒ–Appè¦æœ‰ä¸€å®šè§è§£ï¼Œå°å…¬å¸æ›´çœ‹é‡é™¤äº†iOSå¤–ï¼Œè¿˜è¦æ±‚è·¨å¹³å°èƒ½åŠ›ï¼Œä¼š<code>Ionic</code>æˆ–è€…<code>React Native</code>ã€‚æœ€è¿‘é£å¤´å¾ˆæ—ºçš„<code>Flutter</code>ä¹Ÿæ˜¯è·¨å¹³å°çš„æ–¹æ¡ˆä¹‹ä¸€ã€‚ä»Šåçš„åŠªåŠ›çš„æ–¹å‘è¿˜æ˜¯ä¸¤æ¡çº¿ï¼Œä¸€ä¸ªæ˜¯åŸç”Ÿè¿™å—ç»§ç»­æ·±å…¥ï¼Œä¸€ä¸ªå‰ç«¯æ–¹å‘é‡ç‚¹å­¦ä¹ HTMLã€JavaScriptã€CSSã€‚<strong>å‰ç«¯æ¡†æ¶å’Œè·¨å¹³å°æ–¹æ¡ˆæ¯å¹´éƒ½æ¨é™ˆå‡ºæ–°ï¼Œå­¦éƒ½å­¦ä¸å®Œï¼Œåªæœ‰è¿™ä¸ªä¸‰é©¾é©¬è½¦æ‰æ˜¯ä¸‡å˜ä¸ç¦»å…¶å®—</strong>ã€‚</p><p>&ensp;&ensp;&ensp;&ensp;ä»Šå¹´é™¤äº†å·¥ä½œå’Œä¸ªäººæŠ€æœ¯æˆé•¿å¤–ï¼Œè¿˜æœ‰å€¼å¾—è¯´é“çš„åœ°æ–¹ï¼ˆæ‰‹åŠ¨(ãƒã¸ï¿£ã€)æ‚è„¸ï¼‰ã€‚æ­£æ‰€è°“æ‰‹ä¸­æœ‰ç²®å¿ƒä¸­ä¸æ…Œã€‚é™¤äº†ä¿é™©ä¸Šæœ‰é…ç½®å¤–ï¼Œä»¥å‰è¿˜æœ‰ä¹°å®šæœŸçš„ç†è´¢äº§å“ï¼Œè™½ç„¶é‡‘é¢ä¸å¤šï¼Œä½†æ˜¯èƒ½å…»æˆå¥½çš„å‚¨è“„ä¹ æƒ¯ã€‚ç„¶è€Œä»Šå¹´åŠ å¤§äº†åœ¨å¸åœˆçš„æŠ•å…¥ã€‚ä¸ªäººä¹‹å‰ç§‰æŒçš„æ˜¯ä»·å€¼æŠ•èµ„ï¼Œä¹°å…¥çš„éƒ½æ˜¯<code>EOSã€ETHã€AEã€ADAã€QTUM</code>ç­‰åº•å±‚å…¬é“¾ã€‚åˆ°å››äº”æœˆä»½çš„å°ç‰›çš„æ—¶å€™ï¼Œè¿˜æœ‰å‡ ä¸‡å—çš„æ”¶ç›Šã€‚é—æ†¾çš„æ²¡æœ‰èƒ½åœ¨é«˜ä½å¥—ç°ï¼Œæ‹¿ç€æ‰‹ä¸­ä¸€ç›´ä¸åŠ¨ï¼Œåšä¿¡ä»·å€¼æŠ•èµ„ï¼Œåè€ŒåŠ äº†æ æ†ï¼Œç»§ç»­æŠ•èµ„ã€‚åæ¥çš„ç»“æœå¤§å®¶éƒ½çŸ¥é“ï¼Œ<code>BTC</code>ä»æœ€é«˜ç‚¹è¿‘2ä¸‡ç¾å…ƒè·Œåˆ°æœ€ä½3155ç¾å…ƒï¼Œè·Œå¹…84%ã€‚<code>ETH</code>ä»840å¤šè·Œåˆ°82ï¼Œè·Œå¹…90%ï¼Œé¾™å¤´å¦‚æ­¤ï¼Œå…¶ä»–å¸æ›´ä¸ç”¨è¯´äº†ã€‚æœ€è¦å‘½çš„æ˜¯ï¼Œåé¢åŠ äº†æ æ†ï¼Œåœ¨æœªæ¥å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œéƒ½è¦ä¸ºè¿™ä¸ªé”™è¯¯æŒç»­ä¹°å•ã€‚æˆ‘ä¼°è®¡ï¼Œå¤´å‘ç¨€å°‘ï¼Œå¿«è¦è°¢é¡¶ä¸æ˜¯å› ä¸ºåŠ ç­æ•²ä»£ç ï¼Œè€Œæ˜¯å› ä¸ºäºé’±æ„çš„ï¼ˆæ‰‹åŠ¨(ãƒã¸ï¿£ã€)æ‚è„¸ï¼‰ã€‚<strong>è¿˜å¥½æ‰›äº†ä¸‹æ¥ï¼Œå¿ƒæ€æ²¡æœ‰å´©æºƒ</strong>ã€‚2019å¸åœˆè¿˜æ˜¯è°·åº•ï¼Œè¿™ä¹Ÿæ˜¯ä¸ªæœºä¼šï¼Œç›®å‰è¿˜åœ¨å°é¢å®šæŠ•ä¸­ã€‚æ²¡æœ‰èµ°å®Œæ•´ä¸ªç‰›ç†Šå‘¨æœŸæ˜¯å¾ˆåƒäºçš„ï¼Œå­¦ä¼šç†Šå¸‚ä½ä»·æ”’ç­¹ç ç‰›å¸‚é«˜ä½æŠ›å”®è¿™ä¸ªæµ…æ˜¾é“ç†èŠ±çš„ä»£ä»·å®åœ¨å¤ªå¤§äº†ã€‚</p><p>&ensp;&ensp;&ensp;&ensp;å½“ç„¶ä¹Ÿä¸æ˜¯å®Œå…¨çš„éƒ½æ˜¯ç³Ÿå¿ƒäº‹ï¼Œ2017æ²¡æœ‰åšæŒä¸‹æ¥çš„å¥èº«ï¼Œ2018å¹´å®Œæˆäº†ã€‚é™¤å»å‘¨æœ«ï¼Œä¸‹ç­å›å®¶æ—©çš„æ—¶å€™ï¼Œéƒ½ä¼šå¥èº«æˆ¿ç»ƒç»ƒã€‚å½¢ä½“æ…¢æ…¢å‡ºæ¥äº†ï¼Œä½“é‡æœ€é«˜çš„æ—¶å€™æ˜¯150æ–¤å·¦å³ï¼Œç°åœ¨ä¸åˆ°135ã€‚ç›¸å¯¹ä½“é‡å˜åŒ–ï¼Œæˆ‘æ›´çœ‹é‡ä½“è„‚çš„å˜åŒ–ï¼Œä»Šå¹´æœ€é«˜23%åˆ°ç°åœ¨ç¨³å®šç»´æŒ16%å·¦å³ï¼Œéª¨éª¼è‚Œå’ŒåŸºç¡€ä»£è°¢éƒ½æœ‰æ˜æ˜¾çš„å¢é•¿ã€‚</p><p>&ensp;&ensp;&ensp;&ensp;2018å¹´å°±è¿™ä¹ˆè·Œè·Œæ’æ’çš„èµ°è¿‡å»äº†ï¼Œè¿˜æ˜¯æƒ³è½å…¥ä¿—å¥—åœ°è¯´ä¸€å¥â€œ<strong>2018ï¼Œå†è§ï¼2019ï¼Œä½ å¥½ï¼</strong>â€ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;12æœˆä¸€æ•´ä¸ªæœˆçš„996ï¼Œå¼„å¾—æ•´ä¸ªäººèº«å¿ƒäº¤ç˜ï¼Œè¶ç€å…ƒæ—¦ä¼‘æ¯çš„æ—¶é—´ï¼Œèµ¶åœ¨2018å¹´æœ€åä¸€å¤©ï¼Œå¹´ç»ˆæ€»ç»“ä¸€ä¸‹ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOSç¼“å­˜æœºåˆ¶è¯¦è§£</title>
    <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/12/01/iOS%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/"/>
    <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/12/01/iOSç¼“å­˜æœºåˆ¶è¯¦è§£/</id>
    <published>2018-12-01T10:04:20.000Z</published>
    <updated>2018-12-01T10:22:52.244Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Untold numbers of developers have hacked together an awkward, fragile system for network caching functionality, all because they werenâ€™t aware that NSURLCache could be setup in two lines and do it 100Ã— better. Even more developers have never known the benefits of network caching, and never attempted a solution, causing their apps to make untold numbers of unnecessary requests to the server.<br>æ— æ•°å¼€å‘è€…å°è¯•è‡ªå·±åšä¸€ä¸ªä¸‘é™‹è€Œè„†å¼±çš„ç³»ç»Ÿæ¥å®ç°ç½‘ç»œç¼“å­˜çš„åŠŸèƒ½ï¼Œæ®Šä¸çŸ¥NSURLCacheåªè¦ä¸¤è¡Œä»£ç å°±èƒ½æå®šï¼Œå¹¶ä¸”å¥½ä¸Š100å€ã€‚ç”šè‡³æ›´å¤šçš„å¼€å‘è€…æ ¹æœ¬ä¸çŸ¥é“ç½‘ç»œç¼“å­˜çš„å¥½å¤„ï¼Œä»æ¥æ²¡æœ‰å°è¯•è¿‡è§£å†³æ–¹æ¡ˆï¼Œå¯¼è‡´ä»–ä»¬çš„Appå‘æœåŠ¡å™¨å‘å‡ºæ— æ•°ä¸å¿…è¦çš„è¯·æ±‚ã€‚</p></blockquote><a id="more"></a><h2 id="iOSç³»ç»Ÿçš„ç¼“å­˜ç­–ç•¥"><a href="#iOSç³»ç»Ÿçš„ç¼“å­˜ç­–ç•¥" class="headerlink" title="iOSç³»ç»Ÿçš„ç¼“å­˜ç­–ç•¥"></a>iOSç³»ç»Ÿçš„ç¼“å­˜ç­–ç•¥</h2><p>&ensp;&ensp;&ensp;&ensp;ä¸Šé¢æ˜¯å¼•ç”¨<code>Mattt</code>å¤§ç¥åœ¨<a href="https://nshipster.com/" target="_blank" rel="noopener">NSHipster</a>ä»‹ç»NSURLCacheæ—¶çš„åŸè¯ã€‚</p><h3 id="æœåŠ¡ç«¯çš„ç¼“å­˜ç­–ç•¥"><a href="#æœåŠ¡ç«¯çš„ç¼“å­˜ç­–ç•¥" class="headerlink" title="æœåŠ¡ç«¯çš„ç¼“å­˜ç­–ç•¥"></a>æœåŠ¡ç«¯çš„ç¼“å­˜ç­–ç•¥</h3><p>&ensp;&ensp;&ensp;&ensp;å…ˆçœ‹çœ‹æœåŠ¡ç«¯çš„ç¼“å­˜ç­–ç•¥ã€‚å½“ç¬¬ä¸€æ¬¡è¯·æ±‚åï¼Œå®¢æˆ·ç«¯ä¼šç¼“å­˜æ•°æ®ï¼Œå½“æœ‰ç¬¬äºŒæ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šé¢å¤–åœ¨è¯·æ±‚å¤´åŠ ä¸Š<code>If-Modified-Since</code>æˆ–è€…<code>If-None-Match</code>ï¼Œ<code>If-Modified-Since</code>ä¼šæºå¸¦ç¼“å­˜çš„æœ€åä¿®æ”¹æ—¶é—´ï¼ŒæœåŠ¡ç«¯ä¼šæŠŠè¿™ä¸ªæ—¶é—´å’Œå®é™…æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´è¿›è¡Œæ¯”è¾ƒã€‚</p><ul><li>ç›¸åŒå°±è¿”å›çŠ¶æ€ç 304ï¼Œä¸”ä¸è¿”å›æ•°æ®ï¼Œå®¢æˆ·ç«¯æ‹¿å‡ºç¼“å­˜æ•°æ®ï¼Œæ¸²æŸ“é¡µé¢</li><li>ä¸åŒå°±è¿”å›çŠ¶æ€ç 200ï¼Œå¹¶ä¸”è¿”å›æ•°æ®ï¼Œå®¢æˆ·ç«¯æ¸²æŸ“é¡µé¢ï¼Œå¹¶ä¸”æ›´æ–°ç¼“å­˜</li></ul><p>&ensp;&ensp;&ensp;&ensp;å½“ç„¶ç±»ä¼¼çš„è¿˜æœ‰<code>Cache-Control</code>ã€<code>Expires</code>å’Œ<code>Etag</code>ï¼Œéƒ½æ˜¯ä¸ºäº†æ ¡éªŒæœ¬åœ°ç¼“å­˜æ–‡ä»¶å’ŒæœåŠ¡ç«¯æ˜¯å¦ä¸€è‡´ï¼Œè¿™é‡Œå°±å¸¦è¿‡äº†ã€‚</p><h3 id="NSURLCache"><a href="#NSURLCache" class="headerlink" title="NSURLCache"></a>NSURLCache</h3><p>&ensp;&ensp;&ensp;&ensp;<code>NSURLCache</code>æ˜¯iOSç³»ç»Ÿæä¾›çš„å†…å­˜ä»¥åŠç£ç›˜çš„ç»¼åˆç¼“å­˜æœºåˆ¶ã€‚<code>NSURLCache</code>å¯¹è±¡è¢«å­˜å‚¨æ²™ç›’ä¸­<code>Library/cache</code>ç›®å½•ä¸‹ã€‚åœ¨æˆ‘ä»¬åªéœ€è¦åœ¨<code>didFinishLaunchingWithOptions</code>å‡½æ•°é‡Œé¢åŠ ä¸Šä¸‹é¢çš„ä»£ç ï¼Œå°±å¯ä»¥æ»¡è¶³ä¸€èˆ¬çš„ç¼“å­˜è¦æ±‚ã€‚(æ˜¯çš„ï¼Œæå®šNSURLCacheå°±æ˜¯è¿™ä¹ˆç®€å•)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSURLCache * sharedCache = [[NSURLCache alloc] initWithMemoryCapacity:20 * 1024 *1024 diskCapacity:100 * 1024 * 1024 diskPath:nil];</span><br><span class="line">[NSURLCache setSharedURLCache:sharedCache];</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;ä¸‹é¢æ˜¯å‡ ä¸ªå¸¸ç”¨çš„API<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//è®¾ç½®å†…å­˜ç¼“å­˜çš„æœ€å¤§å®¹é‡</span><br><span class="line">[cache setMemoryCapacity:1024 * 1024 * 20];</span><br><span class="line"></span><br><span class="line">//è®¾ç½®ç£ç›˜ç¼“å­˜çš„æœ€å¤§å®¹é‡</span><br><span class="line">[cache setDiskCapacity:1024 * 1024 * 100];</span><br><span class="line"></span><br><span class="line">//è·å–æŸä¸ªè¯·æ±‚çš„ç¼“å­˜</span><br><span class="line">[cache cachedResponseForRequest:request];</span><br><span class="line"></span><br><span class="line">//æ¸…é™¤æŸä¸ªè¯·æ±‚çš„ç¼“å­˜</span><br><span class="line">[cache removeCachedResponseForRequest:request];</span><br><span class="line"></span><br><span class="line">//è¯·æ±‚ç­–ç•¥ï¼Œè®¾ç½®äº†ç³»ç»Ÿä¼šè‡ªåŠ¨ç”¨NSURLCacheè¿›è¡Œæ•°æ®ç¼“å­˜</span><br><span class="line">request.cachePolicy = NSURLRequestReturnCacheDataElseLoad;</span><br></pre></td></tr></table></figure></p><h3 id="iOSå¸¸ç”¨çš„ç¼“å­˜ç­–ç•¥"><a href="#iOSå¸¸ç”¨çš„ç¼“å­˜ç­–ç•¥" class="headerlink" title="iOSå¸¸ç”¨çš„ç¼“å­˜ç­–ç•¥"></a>iOSå¸¸ç”¨çš„ç¼“å­˜ç­–ç•¥</h3><p>&ensp;&ensp;&ensp;&ensp;<code>NSURLRequestCachePolicy</code>æ˜¯ä¸ªæšä¸¾ï¼ŒæŒ‡çš„æ˜¯ä¸åŒçš„ç¼“å­˜ç­–ç•¥ï¼Œä¸€å…±æœ‰7ç§ï¼Œä½†æ˜¯èƒ½ç”¨çš„åªæœ‰4ç§ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSUInteger, NSURLRequestCachePolicy)</span><br><span class="line">&#123;</span><br><span class="line">    //å¦‚æœæœ‰åè®®ï¼Œå¯¹äºç‰¹å®šçš„URLè¯·æ±‚ï¼Œä½¿ç”¨åè®®å®ç°å®šä¹‰çš„ç¼“å­˜é€»è¾‘ã€‚(é»˜è®¤çš„ç¼“å­˜ç­–ç•¥)</span><br><span class="line">    NSURLRequestUseProtocolCachePolicy = 0,</span><br><span class="line"></span><br><span class="line">    //è¯·æ±‚ä»…ä»åŸå§‹èµ„æºåŠ è½½URLï¼Œä¸ä½¿ç”¨ä»»ä½•ç¼“å­˜</span><br><span class="line">    NSURLRequestReloadIgnoringLocalCacheData = 1,</span><br><span class="line"></span><br><span class="line">    //ä¸ä»…å¿½ç•¥æœ¬åœ°ç¼“å­˜ï¼Œè¿˜è¦å¿½ç•¥åè®®ç¼“å­˜å’Œå…¶ä»–ç¼“å­˜ (æœªå®ç°)</span><br><span class="line">    NSURLRequestReloadIgnoringLocalAndRemoteCacheData = 4,</span><br><span class="line"></span><br><span class="line">    //è¢«NSURLRequestReloadIgnoringLocalCacheDataæ›¿ä»£</span><br><span class="line">    NSURLRequestReloadIgnoringCacheData = NSURLRequestReloadIgnoringLocalCacheData,</span><br><span class="line"></span><br><span class="line">    //æ— è§†ç¼“å­˜çš„æœ‰æ•ˆæœŸ,æœ‰ç¼“å­˜å°±å–ç¼“å­˜ï¼Œæ²¡æœ‰ç¼“å­˜å°±ä¼šä»åŸå§‹åœ°å€åŠ è½½</span><br><span class="line">    NSURLRequestReturnCacheDataElseLoad = 2,</span><br><span class="line"></span><br><span class="line">    //æ— è§†ç¼“å­˜çš„æœ‰æ•ˆæœŸï¼Œæœ‰ç¼“å­˜å°±å–ç¼“å­˜ï¼Œæ²¡æœ‰ç¼“å­˜å°±è§†ä¸ºå¤±è´¥ (å¯ä»¥ç”¨äºç¦»çº¿æ¨¡å¼)</span><br><span class="line">    NSURLRequestReturnCacheDataDontLoad = 3,</span><br><span class="line"></span><br><span class="line">    //ä¼šä»åˆå§‹åœ°å€æ ¡éªŒç¼“å­˜çš„åˆæ³•æ€§ï¼Œåˆæ³•å°±ç”¨ç¼“å­˜æ•°æ®ï¼Œä¸åˆæ³•ä»åŸå§‹åœ°å€åŠ è½½æ•°æ® (æœªå®ç°)</span><br><span class="line">    NSURLRequestReloadRevalidatingCacheData = 5, // Unimplemented</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h2 id="AFNetworkingçš„ç¼“å­˜ç­–ç•¥"><a href="#AFNetworkingçš„ç¼“å­˜ç­–ç•¥" class="headerlink" title="AFNetworkingçš„ç¼“å­˜ç­–ç•¥"></a>AFNetworkingçš„ç¼“å­˜ç­–ç•¥</h2><p>&ensp;&ensp;&ensp;&ensp;ä¹‹å‰å†™äº†<a href="https://ios-misaki.github.io/iOS-Misaki.github.io/2018/04/11/SDWebImage-%E6%BA%90%E7%A0%81%E6%B5%85%E6%9E%90/" target="_blank" rel="noopener">SDWebImageçš„æºç è§£æ</a> é‡Œé¢ä»‹ç»è¿‡<code>SDWebImage</code>çš„ç¼“å­˜ç­–ç•¥ï¼Œæœ‰ä¸¤æ¡çº¿æ ¹æ®æ—¶é—´å’Œç©ºé—´æ¥ç®¡ç†ç¼“å­˜å’Œ<code>AFNetworking</code>å¾ˆç›¸ä¼¼ã€‚<a href="https://github.com/AFNetworking/AFNetworking">AFNetworking</a>ä¸­<code>AFImageDownloader</code>ä½¿ç”¨<code>AFAutoPurgingImageCache</code>å’Œ<code>NSURLCache</code>ç®¡ç†å›¾ç‰‡ç¼“å­˜ã€‚</p><h3 id="AFNetworkingä¸­çš„NSURLCache"><a href="#AFNetworkingä¸­çš„NSURLCache" class="headerlink" title="AFNetworkingä¸­çš„NSURLCache"></a>AFNetworkingä¸­çš„NSURLCache</h3><p>&ensp;&ensp;&ensp;&ensp;<code>AFImageDownloader</code>ä¸­è®¾ç½®<code>NSURLCache</code>ï¼Œä½ç‰ˆæœ¬<code>iOS</code>ç‰ˆæœ¬ä¸­è®¾ç½®å†…å­˜å®¹é‡å’Œç£ç›˜å®¹é‡ä¼šé—ªé€€ï¼ˆè¿™ä¸ªæˆ‘æ²¡æœ‰è€ƒè¯ï¼Œ<code>iOS 7</code>çš„æ‰‹æœºè¿˜çœŸæ²¡æœ‰ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if ([[[UIDevice currentDevice] systemVersion] compare:@&quot;8.2&quot; options:NSNumericSearch] == NSOrderedAscending) </span><br><span class="line">&#123;</span><br><span class="line">    return [NSURLCache sharedURLCache];</span><br><span class="line">&#125;</span><br><span class="line">return [[NSURLCache alloc] initWithMemoryCapacity:20 * 1024 * 1024 diskCapacity:150 * 1024 * 1024 diskPath:@&quot;com.alamofire.imagedownloader&quot;];</span><br></pre></td></tr></table></figure><h3 id="AFNetworkingä¸­çš„AFAutoPurgingImageCache"><a href="#AFNetworkingä¸­çš„AFAutoPurgingImageCache" class="headerlink" title="AFNetworkingä¸­çš„AFAutoPurgingImageCache"></a>AFNetworkingä¸­çš„AFAutoPurgingImageCache</h3><p>&ensp;&ensp;&ensp;&ensp;<code>AFAutoPurgingImageCache</code>æ˜¯ä¸“é—¨ç”¨æ¥å›¾ç‰‡ç¼“å­˜çš„ã€‚å¯ä»¥çœ‹åˆ°å†…éƒ¨æœ‰ä¸‰ä¸ªå±æ€§ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥è£…è½½<code>AFImageCache</code>å¯¹è±¡çš„å­—å…¸å®¹å™¨ï¼Œä¸€ä¸ªæ˜¯å¯ä»¥ç”¨å†…å­˜ç©ºé—´å¤§å°ã€ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ã€‚<code>AFAutoPurgingImageCache</code>åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šæ³¨å†Œ<code>UIApplicationDidReceiveMemoryWarningNotification</code>é€šçŸ¥ï¼Œæ”¶åˆ°å†…å­˜è­¦å‘Šçš„æ—¶å€™ä¼šæ¸…é™¤æ‰€æœ‰ç¼“å­˜ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@interface AFAutoPurgingImageCache ()</span><br><span class="line">@property (nonatomic, strong) NSMutableDictionary &lt;NSString* , AFCachedImage*&gt; *cachedImages;</span><br><span class="line">@property (nonatomic, assign) UInt64 currentMemoryUsage;</span><br><span class="line">@property (nonatomic, strong) dispatch_queue_t synchronizationQueue;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;<code>AFCachedImage</code>æ˜¯å•ä¸ªå›¾ç‰‡ç¼“å­˜å¯¹è±¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, strong) UIImage *image;</span><br><span class="line"></span><br><span class="line">//æ ‡å¿—ç¬¦(è¿™ä¸ªå€¼å°±æ˜¯å›¾ç‰‡çš„è¯·è·¯å¾„ request.URL.absoluteString)</span><br><span class="line">@property (nonatomic, strong) NSString *identifier;</span><br><span class="line"></span><br><span class="line">//å›¾ç‰‡å¤§å°</span><br><span class="line">@property (nonatomic, assign) UInt64 totalBytes;</span><br><span class="line"></span><br><span class="line">//ç¼“å­˜æ—¥æœŸ</span><br><span class="line">@property (nonatomic, strong) NSDate *lastAccessDate;</span><br><span class="line"></span><br><span class="line">//å½“å‰å¯ç”¨å†…å­˜ç©ºé—´å¤§å°</span><br><span class="line">@property (nonatomic, assign) UInt64 currentMemoryUsage;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;æ¥çœ‹çœ‹<code>AFCachedImage</code>åˆå§‹åŒ–çš„æ—¶å€™ã€‚<code>iOS</code>ä½¿ç”¨å›¾æ ‡æ ‡å‡†æ˜¯<code>ARGB_8888</code>ï¼Œå³ä¸€åƒç´ å ä½4ä¸ªå­—èŠ‚ã€‚å†…å­˜å¤§å° = å®½Ã—é«˜Ã—æ¯åƒç´ å­—èŠ‚æ•°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-(instancetype)initWithImage:(UIImage *)image identifier:(NSString *)identifier </span><br><span class="line">&#123;</span><br><span class="line">    if (self = [self init]) </span><br><span class="line">    &#123;</span><br><span class="line">        self.image = image;</span><br><span class="line">        self.identifier = identifier;</span><br><span class="line"></span><br><span class="line">        CGSize imageSize = CGSizeMake(image.size.width * image.scale, image.size.height * image.scale);</span><br><span class="line">        CGFloat bytesPerPixel = 4.0;</span><br><span class="line">        CGFloat bytesPerSize = imageSize.width * imageSize.height;</span><br><span class="line">        self.totalBytes = (UInt64)bytesPerPixel * (UInt64)bytesPerSize;</span><br><span class="line">        self.lastAccessDate = [NSDate date];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;æ¥çœ‹çœ‹æ·»åŠ ç¼“å­˜çš„ä»£ç ï¼Œç”¨äº†<code>dispatch_barrier_async</code>æ …æ å‡½æ•°å°†æ·»åŠ æ“ä½œå’Œåˆ é™¤ç¼“å­˜æ“ä½œåˆ†å‰²å¼€æ¥ã€‚æ¯æ·»åŠ ä¸€ä¸ªç¼“å­˜å¯¹è±¡ï¼Œéƒ½é‡æ–°è®¡ç®—å½“å‰ç¼“å­˜å¤§å°å’Œå¯ç”¨ç©ºé—´å¤§å°ã€‚å½“å†…å­˜è¶…è¿‡è®¾å®šå€¼æ—¶ï¼Œä¼šæŒ‰ç…§æ—¥æœŸçš„å€’åºæ¥éå†ç¼“å­˜å›¾ç‰‡ï¼Œåˆ é™¤æœ€æ—©æ—¥æœŸçš„ç¼“å­˜ï¼Œä¸€ç›´åˆ°æ»¡è¶³ç¼“å­˜ç©ºé—´ä¸ºæ­¢ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- (void)addImage:(UIImage *)image withIdentifier:(NSString *)identifier </span><br><span class="line">&#123;</span><br><span class="line">    dispatch_barrier_async(self.synchronizationQueue, ^&#123;</span><br><span class="line">        AFCachedImage *cacheImage = [[AFCachedImage alloc] initWithImage:image identifier:identifier];</span><br><span class="line"></span><br><span class="line">        AFCachedImage *previousCachedImage = self.cachedImages[identifier];</span><br><span class="line">        if (previousCachedImage != nil) </span><br><span class="line">        &#123;</span><br><span class="line">            self.currentMemoryUsage -= previousCachedImage.totalBytes;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        self.cachedImages[identifier] = cacheImage;</span><br><span class="line">        self.currentMemoryUsage += cacheImage.totalBytes;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    dispatch_barrier_async(self.synchronizationQueue, ^&#123;</span><br><span class="line">        if (self.currentMemoryUsage &gt; self.memoryCapacity) </span><br><span class="line">        &#123;</span><br><span class="line">            UInt64 bytesToPurge = self.currentMemoryUsage - self.preferredMemoryUsageAfterPurge;</span><br><span class="line">            NSMutableArray &lt;AFCachedImage*&gt; *sortedImages = [NSMutableArray arrayWithArray:self.cachedImages.allValues];</span><br><span class="line">            NSSortDescriptor *sortDescriptor = [[NSSortDescriptor alloc] initWithKey:@&quot;lastAccessDate&quot; ascending:YES];</span><br><span class="line">            [sortedImages sortUsingDescriptors:@[sortDescriptor]];</span><br><span class="line"></span><br><span class="line">            UInt64 bytesPurged = 0;</span><br><span class="line"></span><br><span class="line">            for (AFCachedImage *cachedImage in sortedImages) </span><br><span class="line">            &#123;</span><br><span class="line">                [self.cachedImages removeObjectForKey:cachedImage.identifier];</span><br><span class="line">                bytesPurged += cachedImage.totalBytes;</span><br><span class="line">                if (bytesPurged &gt;= bytesToPurge) </span><br><span class="line">                &#123;</span><br><span class="line">                    break ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            self.currentMemoryUsage -= bytesPurged;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="YTKNetworkçš„ç¼“å­˜ç­–ç•¥"><a href="#YTKNetworkçš„ç¼“å­˜ç­–ç•¥" class="headerlink" title="YTKNetworkçš„ç¼“å­˜ç­–ç•¥"></a>YTKNetworkçš„ç¼“å­˜ç­–ç•¥</h2><p>&ensp;&ensp;&ensp;&ensp;<a href="https://github.com/yuantiku/YTKNetwork">YTKNetwork</a>æ˜¯çŒ¿é¢˜åº“æŠ€æœ¯å›¢é˜Ÿå¼€æºçš„ä¸€ä¸ªç½‘ç»œè¯·æ±‚æ¡†æ¶ï¼Œå†…éƒ¨å°è£…äº†<code>AFNetworking</code>ã€‚å®ƒæŠŠæ¯ä¸ªè¯·æ±‚å®ä¾‹åŒ–ï¼Œç®¡ç†å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå¯ä»¥ç®¡ç†å¤šä¸ªè¯·æ±‚ã€‚ç¬”è€…åœ¨ä¸€ä¸ªç”µå•†çš„<code>PaaS</code>é¡¹ç›®ä¸­å°±æ˜¯ä½¿ç”¨<code>YTKNetwork</code>ï¼Œå®ƒçš„ç‰¹ç‚¹è¿˜æœ‰æ”¯æŒè¯·æ±‚ç»“æœç¼“å­˜ï¼Œæ”¯æŒæ‰¹é‡è¯·æ±‚ï¼Œæ”¯æŒå¤šè¯·æ±‚ä¾èµ–ç­‰ã€‚</p><h3 id="å‡†å¤‡è¯·æ±‚ä¹‹å‰"><a href="#å‡†å¤‡è¯·æ±‚ä¹‹å‰" class="headerlink" title="å‡†å¤‡è¯·æ±‚ä¹‹å‰"></a>å‡†å¤‡è¯·æ±‚ä¹‹å‰</h3><p>&ensp;&ensp;&ensp;&ensp;å…ˆæ¥çœ‹çœ‹è¯·æ±‚åŸºç±»<code>YTKRequest</code>åœ¨è¯·æ±‚ä¹‹å‰åšäº†ä»€ä¹ˆ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">- (void)start </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    //å¿½ç•¥ç¼“å­˜çš„æ ‡å¿— æ‰‹åŠ¨è®¾ç½® æ˜¯å¦åˆ©ç”¨ç¼“å­˜</span><br><span class="line">    if (self.ignoreCache) </span><br><span class="line">    &#123;</span><br><span class="line">        [self startWithoutCache];</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¿˜æœ‰æœªå®Œæˆçš„è¯·æ±‚ æ˜¯å¦è¿˜æœ‰æœªå®Œæˆçš„è¯·æ±‚</span><br><span class="line">    if (self.resumableDownloadPath) </span><br><span class="line">    &#123;</span><br><span class="line">        [self startWithoutCache];</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //åŠ è½½ç¼“å­˜æ˜¯å¦æˆåŠŸ</span><br><span class="line">    if (![self loadCacheWithError:nil]) </span><br><span class="line">    &#123;</span><br><span class="line">        [self startWithoutCache];</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _dataFromCache = YES;</span><br><span class="line"></span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line"></span><br><span class="line">        //å°†è¯·æ±‚æ•°æ®å†™å…¥æ–‡ä»¶</span><br><span class="line">        [self requestCompletePreprocessor];</span><br><span class="line">        [self requestCompleteFilter];</span><br><span class="line"></span><br><span class="line">        //è¿™ä¸ªæ—¶å€™ç›´æ¥å»ç›¸åº” è¯·æ±‚æˆåŠŸçš„delegateå’Œblock ï¼Œæ²¡æœ‰å‘é€è¯·æ±‚</span><br><span class="line">        YTKRequest *strongSelf = self;</span><br><span class="line">        [strongSelf.delegate requestFinished:strongSelf];</span><br><span class="line">        if (strongSelf.successCompletionBlock) </span><br><span class="line">        &#123;</span><br><span class="line">            strongSelf.successCompletionBlock(strongSelf);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //å°†blockç½®ç©º</span><br><span class="line">        [strongSelf clearCompletionBlock];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ç¼“å­˜æ•°æ®å†™å…¥æ–‡ä»¶"><a href="#ç¼“å­˜æ•°æ®å†™å…¥æ–‡ä»¶" class="headerlink" title="ç¼“å­˜æ•°æ®å†™å…¥æ–‡ä»¶"></a>ç¼“å­˜æ•°æ®å†™å…¥æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (void)requestCompletePreprocessor </span><br><span class="line">&#123;</span><br><span class="line">    [super requestCompletePreprocessor];</span><br><span class="line"></span><br><span class="line">    if (self.writeCacheAsynchronously) </span><br><span class="line">    &#123;</span><br><span class="line">        dispatch_async(ytkrequest_cache_writing_queue(), ^&#123;</span><br><span class="line">            [self saveResponseDataToCacheFile:[super responseData]];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; </span><br><span class="line">    else </span><br><span class="line">    &#123;</span><br><span class="line">        [self saveResponseDataToCacheFile:[super responseData]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&ensp;&ensp;&ensp;&ensp;<code>ytkrequest_cache_writing_queue</code>æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§æ¯”è¾ƒä½çš„ä¸²è¡Œé˜Ÿåˆ—ï¼Œå½“æ ‡å¿—<code>dataFromCache</code>ä¸º<code>YES</code>çš„æ—¶å€™ï¼Œç¡®å®šèƒ½æ‹¿åˆ°æ•°æ®ï¼Œåœ¨è¿™ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¸­å¼‚æ­¥çš„å†™å…¥æ–‡ä»¶ã€‚æ¥çœ‹çœ‹å†™å…¥ç¼“å­˜çš„å…·ä½“æ“ä½œã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (void)saveResponseDataToCacheFile:(NSData *)data </span><br><span class="line">&#123;</span><br><span class="line">    if ([self cacheTimeInSeconds] &gt; 0 &amp;&amp; ![self isDataFromCache]) </span><br><span class="line">    &#123;</span><br><span class="line">        if (data != nil) </span><br><span class="line">        &#123;</span><br><span class="line">            @try &#123;</span><br><span class="line">                // New data will always overwrite old data.</span><br><span class="line">                [data writeToFile:[self cacheFilePath] atomically:YES];</span><br><span class="line"></span><br><span class="line">                YTKCacheMetadata *metadata = [[YTKCacheMetadata alloc] init];</span><br><span class="line">                metadata.version = [self cacheVersion];</span><br><span class="line">                metadata.sensitiveDataString = ((NSObject *)[self cacheSensitiveData]).description;</span><br><span class="line">                metadata.stringEncoding = [YTKNetworkUtils stringEncodingWithRequest:self];</span><br><span class="line">                metadata.creationDate = [NSDate date];</span><br><span class="line">                metadata.appVersionString = [YTKNetworkUtils appVersionString];</span><br><span class="line">                [NSKeyedArchiver archiveRootObject:metadata toFile:[self cacheMetadataFilePath]];</span><br><span class="line">            &#125; @catch (NSException *exception) &#123;</span><br><span class="line">                YTKLog(@&quot;Save cache failed, reason = %@&quot;, exception.reason);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;é™¤äº†è¯·æ±‚æ•°æ®æ–‡ä»¶ï¼Œ<code>YTK</code>è¿˜ä¼šç”Ÿæˆä¸€ä¸ªè®°å½•ç¼“å­˜æ•°æ®ä¿¡æ¯çš„å…ƒæ•°æ®<code>YTKCacheMetadata</code>å¯¹è±¡ã€‚<code>YTKCacheMetadata</code>è®°å½•äº†ç¼“å­˜çš„ç‰ˆæœ¬å·ã€æ•æ„Ÿä¿¡æ¯ã€ç¼“å­˜æ—¥æœŸå’ŒAppçš„ç‰ˆæœ¬å·ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, assign) long long version;</span><br><span class="line">@property (nonatomic, strong) NSString *sensitiveDataString;</span><br><span class="line">@property (nonatomic, assign) NSStringEncoding stringEncoding;</span><br><span class="line">@property (nonatomic, strong) NSDate *creationDate;</span><br><span class="line">@property (nonatomic, strong) NSString *appVersionString;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;ç„¶åæŠŠè¯·æ±‚æ–¹æ³•ã€è¯·æ±‚åŸŸåã€è¯·æ±‚URLå’Œè¯·æ±‚å‚æ•°ç»„æˆçš„å­—ç¬¦ä¸²è¿›è¡Œä¸€æ¬¡<code>MD5</code>åŠ å¯†ï¼Œä½œä¸ºç¼“å­˜æ–‡ä»¶çš„åç§°ã€‚<code>YTKCacheMetadata</code>å’Œç¼“å­˜æ–‡ä»¶åŒåï¼Œå¤šäº†ä¸€ä¸ª<code>.metadata</code>çš„åç¼€ä½œä¸ºåŒºåˆ†ã€‚æ–‡ä»¶å†™å…¥çš„è·¯å¾„æ˜¯æ²™ç›’ä¸­<code>Library/LazyRequestCache</code>ç›®å½•ä¸‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (NSString *)cacheFileName </span><br><span class="line">&#123;</span><br><span class="line">    NSString *requestUrl = [self requestUrl];</span><br><span class="line">    NSString *baseUrl = [YTKNetworkConfig sharedConfig].baseUrl;</span><br><span class="line">    id argument = [self cacheFileNameFilterForRequestArgument:[self requestArgument]];</span><br><span class="line">    NSString *requestInfo = [NSString stringWithFormat:@&quot;Method:%ld Host:%@ Url:%@ Argument:%@&quot;,</span><br><span class="line">    (long)[self requestMethod], baseUrl, requestUrl, argument];</span><br><span class="line">    NSString *cacheFileName = [YTKNetworkUtils md5StringFromString:requestInfo];</span><br><span class="line">    return cacheFileName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="https://upload-images.jianshu.io/upload_images/1487718-b3a080f6739c49cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="YTKNetworkç¼“å­˜æ–‡ä»¶è·¯å¾„.png"></p><h3 id="æ ¡éªŒç¼“å­˜"><a href="#æ ¡éªŒç¼“å­˜" class="headerlink" title="æ ¡éªŒç¼“å­˜"></a>æ ¡éªŒç¼“å­˜</h3><p>&ensp;&ensp;&ensp;&ensp;å›åˆ°startæ–¹æ³•ä¸­ï¼Œ<code>loadCacheWithError</code>æ˜¯æ ¡éªŒç¼“å­˜èƒ½ä¸èƒ½æˆåŠŸåŠ è½½å‡ºæ¥ï¼Œ<code>loadCacheWithError</code>ä¸­ä¼šè°ƒç”¨<code>validateCacheWithError</code>æ¥æ£€éªŒç¼“å­˜çš„åˆæ³•æ€§ï¼Œæ ¡éªŒçš„ä¾æ®æ­£æ˜¯<code>YTKCacheMetadata</code>å’Œ<code>cacheTimeInSeconds</code>ã€‚è¦æƒ³ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œè¯·æ±‚å®ä¾‹è¦é‡å†™<code>cacheTimeInSeconds</code>è®¾ç½®ä¸€ä¸ªå¤§äº0çš„å€¼ï¼Œè€Œä¸”ç¼“å­˜è¿˜æ”¯æŒç‰ˆæœ¬ã€Appçš„ç‰ˆæœ¬ã€‚åœ¨å®é™…é¡¹ç›®ä¸Šåº”ç”¨ï¼Œ<code>get</code>è¯·æ±‚å®ä¾‹è®¾ç½®ä¸€ä¸ª<code>cacheTimeInSeconds</code>å°±å¤Ÿç”¨äº†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)validateCacheWithError:(NSError * _Nullable __autoreleasing *)error     </span><br><span class="line">&#123;</span><br><span class="line">    // Date</span><br><span class="line">    NSDate *creationDate = self.cacheMetadata.creationDate;</span><br><span class="line">    NSTimeInterval duration = -[creationDate timeIntervalSinceNow];</span><br><span class="line">    if (duration &lt; 0 || duration &gt; [self cacheTimeInSeconds]) </span><br><span class="line">    &#123;</span><br><span class="line">        if (error) </span><br><span class="line">        &#123;</span><br><span class="line">            *error = [NSError errorWithDomain:YTKRequestCacheErrorDomain code:YTKRequestCacheErrorExpired userInfo:@&#123; NSLocalizedDescriptionKey:@&quot;Cache expired&quot;&#125;];</span><br><span class="line">        &#125;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    // Version</span><br><span class="line">    long long cacheVersionFileContent = self.cacheMetadata.version;</span><br><span class="line">    if (cacheVersionFileContent != [self cacheVersion]) </span><br><span class="line">    &#123;</span><br><span class="line">        if (error) </span><br><span class="line">        &#123;</span><br><span class="line">            *error = [NSError errorWithDomain:YTKRequestCacheErrorDomain code:YTKRequestCacheErrorVersionMismatch userInfo:@&#123; NSLocalizedDescriptionKey:@&quot;Cache version mismatch&quot;&#125;];</span><br><span class="line">        &#125;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    // Sensitive data</span><br><span class="line">    NSString *sensitiveDataString = self.cacheMetadata.sensitiveDataString;</span><br><span class="line">    NSString *currentSensitiveDataString = ((NSObject *)[self cacheSensitiveData]).description;</span><br><span class="line">    if (sensitiveDataString || currentSensitiveDataString) </span><br><span class="line">    &#123;</span><br><span class="line">        // If one of the strings is nil, short-circuit evaluation will trigger</span><br><span class="line">        if (sensitiveDataString.length != currentSensitiveDataString.length || ![sensitiveDataString isEqualToString:currentSensitiveDataString]) </span><br><span class="line">        &#123;</span><br><span class="line">            if (error) </span><br><span class="line">            &#123;</span><br><span class="line">                *error = [NSError errorWithDomain:YTKRequestCacheErrorDomain code:YTKRequestCacheErrorSensitiveDataMismatch userInfo:@&#123; NSLocalizedDescriptionKey:@&quot;Cache sensitive data mismatch&quot;&#125;];</span><br><span class="line">            &#125;</span><br><span class="line">            return NO;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // App version</span><br><span class="line">    NSString *appVersionString = self.cacheMetadata.appVersionString;</span><br><span class="line">    NSString *currentAppVersionString = [YTKNetworkUtils appVersionString];</span><br><span class="line">    if (appVersionString || currentAppVersionString) </span><br><span class="line">    &#123;</span><br><span class="line">        if (appVersionString.length != currentAppVersionString.length || ![appVersionString isEqualToString:currentAppVersionString]) </span><br><span class="line">        &#123;</span><br><span class="line">            if (error) </span><br><span class="line">            &#123;</span><br><span class="line">                *error = [NSError errorWithDomain:YTKRequestCacheErrorDomain code:YTKRequestCacheErrorAppVersionMismatch userInfo:@&#123; NSLocalizedDescriptionKey:@&quot;App version mismatch&quot;&#125;];</span><br><span class="line">            &#125;</span><br><span class="line">            return NO;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ¸…é™¤ç¼“å­˜"><a href="#æ¸…é™¤ç¼“å­˜" class="headerlink" title="æ¸…é™¤ç¼“å­˜"></a>æ¸…é™¤ç¼“å­˜</h3><p>&ensp;&ensp;&ensp;&ensp;å› ä¸ºç¼“å­˜çš„ç›®å½•æ˜¯<code>Library/LazyRequestCache</code>ï¼Œæ¸…é™¤ç¼“å­˜å°±ç›´æ¥æ¸…ç©ºç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å°±å¯ä»¥äº†ã€‚è°ƒç”¨<code>[[YTKNetworkConfig sharedConfig] clearCacheDirPathFilter]</code>å°±è¡Œã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>&ensp;&ensp;&ensp;&ensp;<strong>ç¼“å­˜çš„æœ¬è´¨æ˜¯ç”¨ç©ºé—´æ¢å–æ—¶é—´ã€‚å¤§å­¦é‡Œé¢å­¦è¿‡çš„ã€Šè®¡ç®—æœºç»„æˆåŸç†ã€‹ä¸­å°±æœ‰ä»‹ç»<code>cache</code>ï¼Œé™¤äº†ç£ç›˜å’Œå†…å­˜,è¿˜æœ‰L1å’ŒL2ï¼Œå¯¹äºiOSå¼€å‘è€…æ¥è¯´ï¼Œä¸€èˆ¬å…³æ³¨<code>disk</code>å’Œ<code>memory</code>å°±å¤Ÿäº†ã€‚é˜…è¯»<code>SDWebImageã€AFNetworkingã€YTKNetwork</code>çš„æºç åï¼Œå¯ä»¥çœ‹å‡ºä»–ä»¬éƒ½éå¸¸é‡è§†æ•°æ®çš„å¤šçº¿ç¨‹çš„è¯»å†™å®‰å…¨ï¼Œåœ¨åšæ·±åº¦ä¼˜åŒ–æ—¶å€™ï¼Œå› åœ°åˆ¶å®œï¼ŒåŠæ—¶æ¸…ç†ç¼“å­˜æ–‡ä»¶ã€‚</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Untold numbers of developers have hacked together an awkward, fragile system for network caching functionality, all because they werenâ€™t aware that NSURLCache could be setup in two lines and do it 100Ã— better. Even more developers have never known the benefits of network caching, and never attempted a solution, causing their apps to make untold numbers of unnecessary requests to the server.&lt;br&gt;æ— æ•°å¼€å‘è€…å°è¯•è‡ªå·±åšä¸€ä¸ªä¸‘é™‹è€Œè„†å¼±çš„ç³»ç»Ÿæ¥å®ç°ç½‘ç»œç¼“å­˜çš„åŠŸèƒ½ï¼Œæ®Šä¸çŸ¥NSURLCacheåªè¦ä¸¤è¡Œä»£ç å°±èƒ½æå®šï¼Œå¹¶ä¸”å¥½ä¸Š100å€ã€‚ç”šè‡³æ›´å¤šçš„å¼€å‘è€…æ ¹æœ¬ä¸çŸ¥é“ç½‘ç»œç¼“å­˜çš„å¥½å¤„ï¼Œä»æ¥æ²¡æœ‰å°è¯•è¿‡è§£å†³æ–¹æ¡ˆï¼Œå¯¼è‡´ä»–ä»¬çš„Appå‘æœåŠ¡å™¨å‘å‡ºæ— æ•°ä¸å¿…è¦çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ç»„ä»¶åŒ–é‡åˆ°çš„é—®é¢˜</title>
    <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/11/28/%E7%BB%84%E4%BB%B6%E5%8C%96%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/11/28/ç»„ä»¶åŒ–é‡åˆ°çš„é—®é¢˜/</id>
    <published>2018-11-28T12:19:33.000Z</published>
    <updated>2018-11-28T08:27:53.181Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;&ensp;&ensp;æ¥å…¬å¸å¤§åŠå¹´æ—¶é—´äº†ï¼Œä¸€ä¸ªäººæç»„ä»¶åŒ–ä¸è½»æ¾ï¼Œå…ˆæ¥çœ‹çœ‹<code>podfile</code>ï¼Œä¸šåŠ¡åŠŸèƒ½éƒ½å·²ç»æ‹†åˆ†æˆäº†ä¸€ä¸ªç»„ä»¶ï¼Œç°åœ¨ä¸»å·¥ç¨‹å°±æ˜¯ä¸€ä¸ªç©ºå£³å­ï¼Œæ‰€æœ‰çš„ä¸šåŠ¡åœºæ™¯éƒ½åœ¨ç»„ä»¶åŒ–åŒ…é‡Œé¢ã€‚ç°åœ¨æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨ç»„ä»¶åŒ–è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">source &apos;https://git.XXX.com/products/paas-app-ios-spec.git&apos;</span><br><span class="line">source &apos;https://github.com/CocoaPods/Specs.git&apos;</span><br><span class="line"># platform :ios, &apos;8.0&apos;</span><br><span class="line"></span><br><span class="line">target &apos;YYPaas&apos; do</span><br><span class="line">pod &apos;PaasBaseComponent&apos;, &apos;~&gt; 1.0.30&apos;</span><br><span class="line"></span><br><span class="line">#pod &apos;PaasUMComponent&apos;, &apos;~&gt; 1.0.1&apos;</span><br><span class="line">pod &apos;PaasAddressComponent&apos;, &apos;~&gt; 1.0.7&apos;</span><br><span class="line">pod &apos;PaasThemeBuildStyleComponent&apos;, &apos;~&gt; 1.0.1&apos;</span><br><span class="line">pod &apos;PaasUMBuildStyleComponent&apos;, &apos;~&gt; 1.0.15&apos;</span><br><span class="line">pod &apos;PaasCollectionComponent&apos;, &apos;~&gt; 1.0.1&apos;</span><br><span class="line">pod &apos;PaasFootprintComponent&apos;, &apos;~&gt; 1.0.2&apos;</span><br><span class="line">pod &apos;PaasIntegralComponent&apos;, &apos;~&gt; 1.0.4&apos;</span><br><span class="line">pod &apos;PaasUserInfoComponent&apos;, &apos;~&gt; 1.0.1&apos;</span><br><span class="line">pod &apos;PaasSettingComponent&apos;, &apos;~&gt; 1.0.3&apos;</span><br><span class="line">pod &apos;PaasOrderComponent&apos;, &apos;~&gt; 1.0.5&apos;</span><br><span class="line">pod &apos;PaasAfterSaleComponent&apos;, &apos;~&gt; 1.0.1&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#use_frameworks!</span><br><span class="line"></span><br><span class="line"># Pods for YYPaas</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºç§æœ‰åº“æ²¡æœ‰é€šè¿‡è¿œç«¯æ ¡éªŒé—®é¢˜"><a href="#åˆ›å»ºç§æœ‰åº“æ²¡æœ‰é€šè¿‡è¿œç«¯æ ¡éªŒé—®é¢˜" class="headerlink" title="åˆ›å»ºç§æœ‰åº“æ²¡æœ‰é€šè¿‡è¿œç«¯æ ¡éªŒé—®é¢˜"></a>åˆ›å»ºç§æœ‰åº“æ²¡æœ‰é€šè¿‡è¿œç«¯æ ¡éªŒé—®é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod spec lint --sources=&apos;https://git.xxxx.com/products/paas-app-ios-spec.git,https://github.com/CocoaPods/Specs&apos; --use-libraries --allow-warnings --verbose</span><br></pre></td></tr></table></figure><p>&ensp;&ensp;&ensp;&ensp;ä¸€èˆ¬åˆ›å»ºç§æœ‰åº“çš„æ—¶å€™ï¼Œæœ¬åœ°æ ¡éªŒéƒ½èƒ½é€šè¿‡ï¼Œä½†æ˜¯è¿œç«¯æ ¡éªŒé€šä¸è¿‡ï¼ŒæŠ¥é”™ä¸‹å›¾çš„é”™è¯¯<br><img src="https://upload-images.jianshu.io/upload_images/1487718-bf702de090b61f32.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="pod spec lint æŠ¥é”™.png"></p><p>&ensp;&ensp;&ensp;&ensp;ä¸Šç½‘æŸ¥åŸå› æ˜¯ä¸Šä¼ çš„åŒ…è¿‡å¤§ï¼Œ<code>http</code>çš„å¤´éƒ¨é”™è¯¯å¯¼è‡´ã€‚åæ¥ä¿®æ”¹<code>postBuffer</code>æ”¹ä¸º50Mï¼Œ100Méƒ½ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸èµ·ä½œç”¨ã€‚åæ¥é€šè¿‡ä¿®æ”¹ç§æœ‰åº“çš„<code>.podspec</code>æ–‡ä»¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>&ensp;&ensp;&ensp;&ensp;<strong>æœ¬åœ°æ ¡éªŒæŒ‡å®š<code>source</code>è·¯å¾„ä¸º<code>https</code></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.source           = &#123; :git =&gt; &apos;https://git.xxx.com/yuyi/PaasAddressComponent.git&apos;, :tag =&gt; s.version.to_s &#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;<strong>æäº¤ä»£ç è‡³è¿œç«¯åä¿®æ”¹<code>source</code>ä¸º<code>ssh</code>æ–¹å¼</strong>ï¼Œç„¶åè¿›è¡Œ<code>pod spec lint</code>å’Œ<code>pod repo push</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.source           = &#123; :git =&gt; &apos;ssh://git@git.xxx.com:3589/yuyi/PaasAddressComponent.git&apos;, :tag =&gt; s.version.to_s &#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;<strong><code>pod repo push</code> æ“ä½œåè¦è®°ä½æŠŠ<code>s.source</code>çš„å¼•å…¥æ–¹å¼æ”¹ä¸º<code>https</code>ï¼Œä¸ç„¶é€šè¿‡ä¸äº†æœ¬åœ°æ ¡éªŒã€‚</strong><br>&ensp;&ensp;&ensp;&ensp;ç§æœ‰åº“éƒ½æ‰˜ç®¡åˆ°å…¬å¸çš„<code>gitlab</code>ä¸Šé¢ï¼Œç°åœ¨è¿˜æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æƒ³åº”è¯¥æ˜¯å…¬å¸<code>gitLab</code>è®¾ç½®çš„é—®é¢˜ï¼Œæ¯•ç«Ÿåœ¨åŒæ ·çš„ç§æœ‰åº“æ‰˜ç®¡åœ¨<code>https://gitee.com/</code>æˆ–è€…è‡ªå·±çš„<code>gitlab</code>è´¦å·éƒ½æ²¡æœ‰å‡ºç°è¿‡åŒæ ·çš„é—®é¢˜ã€‚</p><h2 id="èµ„æºæ–‡ä»¶çš„å¼•ç”¨é—®é¢˜"><a href="#èµ„æºæ–‡ä»¶çš„å¼•ç”¨é—®é¢˜" class="headerlink" title="èµ„æºæ–‡ä»¶çš„å¼•ç”¨é—®é¢˜"></a>èµ„æºæ–‡ä»¶çš„å¼•ç”¨é—®é¢˜</h2><p>&ensp;&ensp;&ensp;&ensp;æ­å»ºé¡µé¢çš„æ—¶å€™éƒ½æ˜¯ç”¨<code>Masonry</code>ä»£ç å¸ƒå±€ï¼Œæ²¡æœ‰ç”¨<code>xib</code>æ–‡ä»¶ã€‚è¿™é‡Œçš„èµ„æºæ–‡ä»¶è‡ªå‰©ä¸‹å›¾ç‰‡èµ„æºäº†ã€‚<br>&ensp;&ensp;&ensp;&ensp;å‡å¦‚ä¸åœ¨ç»„ä»¶ä¸­ï¼Œå›¾ç‰‡èµ„æºäº¤ç»™<code>Assets.xcassets</code>æ¥ç®¡ç†ï¼Œå¼•ç”¨ç›´æ¥é€šè¿‡<code>[UIImage imageNamed:@&quot;paas_nodata_placeholder&quot;]</code>ã€‚<br>&ensp;&ensp;&ensp;&ensp;ç°åœ¨æ²¡æœ‰å•ç‹¬çš„ç»„ä»¶åŒ…çš„å›¾ç‰‡èµ„æºå°±ä¸ä¼šæ”¾åœ¨<code>Assets.xcassets</code>ï¼Œè€Œæ˜¯é€šè¿‡æ”¾åœ¨ç»„ä»¶<code>Assets</code>ç›®å½•ä¸‹æ¥ç®¡ç†ï¼Œå¼•ç”¨æ–¹å¼ä¹Ÿå˜æˆäº†<code>[UIImage imageWithContentsOfFile:path]</code>ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">+ (UIImage *)imageWithPaasComponentType:(PaasComponentType)type </span><br><span class="line">                          WithClassName:(Class)className</span><br><span class="line">                               WithName:(NSString *)imageName</span><br><span class="line">&#123;</span><br><span class="line">    NSBundle * bundle = [NSBundle bundleForClass:className];</span><br><span class="line">    NSString * componentName;</span><br><span class="line">    switch (type) &#123;</span><br><span class="line">        case PaasComponentType_Base:</span><br><span class="line">            componentName = @&quot;PaasBaseComponent&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case PaasComponentType_UM:</span><br><span class="line">            componentName = @&quot;PaasUMComponent&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case PaasComponentType_Address:</span><br><span class="line">            componentName = @&quot;PaasAddressComponent&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case PaasComponentType_BuildUM:</span><br><span class="line">            componentName = @&quot;PaasUMBuildStyleComponent&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case PaasComponentType_Collection:</span><br><span class="line">            componentName = @&quot;PaasCollectionComponent&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case PaasComponentType_Footprint:</span><br><span class="line">            componentName = @&quot;PaasFootprintComponent&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case PaasComponentType_Integral:</span><br><span class="line">            componentName = @&quot;PaasIntegralComponent&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case PaasComponentType_UserInfo:</span><br><span class="line">            componentName = @&quot;PaasUserInfoComponent&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case PaasComponentType_Setting:</span><br><span class="line">            componentName = @&quot;PaasSettingComponent&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case PaasComponentType_Order:</span><br><span class="line">            componentName = @&quot;PaasOrderComponent&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case PaasComponentType_AfterSale:</span><br><span class="line">            componentName = @&quot;PaasAfterSaleComponent&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case PaasComponentType_Evaluation:</span><br><span class="line">            componentName = @&quot;PaasEvaluationComponent&quot;;</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    NSString * resource = [NSString stringWithFormat:@&quot;%@.bundle/%@.png&quot;,componentName,[self addSuffixWithImageName:imageName]];</span><br><span class="line">    NSString * path = [bundle pathForResource:resource ofType:nil];</span><br><span class="line">    return [UIImage imageWithContentsOfFile:path];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (NSString *)addSuffixWithImageName:(NSString *)imageName</span><br><span class="line">&#123;</span><br><span class="line">    NSString * fileName;</span><br><span class="line">    if ([UIScreen mainScreen].scale == 3)</span><br><span class="line">    &#123;</span><br><span class="line">        fileName = [NSString stringWithFormat:@&quot;%@@3x&quot;,imageName];</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        fileName = [NSString stringWithFormat:@&quot;%@@2x&quot;,imageName];</span><br><span class="line">    &#125;</span><br><span class="line">    return fileName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;é¦–å…ˆæ ¹æ®<code>className</code>æ¥ç¡®å®šæ‰€åœ¨çš„<code>Bundle</code>ï¼Œç„¶åæ ¹æ®<code>PaasComponentType</code>æ¥ç¡®å®šæ‰€åœ¨çš„ç»„ä»¶åç§°ï¼Œæœ€åç”¨<code>[UIScreen mainScreen].scale</code>æ¥ç¡®å®šæ˜¯ç”¨<code>@2x</code>å›¾ç‰‡è¿˜æ˜¯<code>@3x</code>å›¾ç‰‡ã€‚</p><p>&ensp;&ensp;&ensp;&ensp;<code>podspec</code>åŠ å…¥å›¾ç‰‡æ–‡ä»¶<br><img src="https://upload-images.jianshu.io/upload_images/1487718-ea2dd7c4fe907f65.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç»„ä»¶åŒ–å›¾ç‰‡å¼•å…¥æ–¹å¼.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s.resource_bundles = &#123;</span><br><span class="line">&apos;PaasAddressComponent&apos; =&gt; [&apos;PaasAddressComponent/Assets/*.png&apos;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»„ä»¶ä¹‹é—´çš„é€šè®¯é—®é¢˜"><a href="#ç»„ä»¶ä¹‹é—´çš„é€šè®¯é—®é¢˜" class="headerlink" title="ç»„ä»¶ä¹‹é—´çš„é€šè®¯é—®é¢˜"></a>ç»„ä»¶ä¹‹é—´çš„é€šè®¯é—®é¢˜</h2><p>&ensp;&ensp;&ensp;&ensp;æˆ‘åœ¨æ‹†åˆ†è®¢å•ç»„ä»¶å’Œå”®åç»„ä»¶ä¹‹å‰ï¼Œè®¢å•è¯¦æƒ…æ˜¯è¿™æ ·è·³è½¬åˆ°ç”³è¯·å”®åçš„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RefundViewController * vc = [[RefundViewController alloc]init];</span><br><span class="line">vc.FmodelArray = self.modelArray</span><br><span class="line">[self.navigationController pushViewController:vc animated:YES];</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;<code>OrderShopGoodsModel</code>æ˜¯å•†å“çš„<code>model</code> ï¼Œ<code>self.modelArray</code>æ˜¯å•†å“è¯¦æƒ…å­˜æ”¾<code>OrderShopGoodsModel</code>çš„é›†åˆï¼Œ<code>RefundViewController</code>å¯¹å¤–æš´éœ²äº†ä¸€ä¸ª<code>FmodelArray</code>æ•°ç»„ï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯<code>OrderShopGoodsModel</code>é›†åˆã€‚<br>&ensp;&ensp;&ensp;&ensp;åæ¥ä¸ºäº†è§£è€¦ï¼Œåˆ›å»ºäº†<code>RefundShopGoodsModel</code>ï¼Œ<code>OrderShopGoodsModel</code>å’Œ<code>RefundShopGoodsModel</code>æ˜¯æ²¡æœ‰ä»»ä½•åŒºåˆ«çš„ï¼Œéƒ½æ˜¯ç”¨æ¥å­˜æ”¾å•†å“çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ <code>idã€nameã€skuã€imageUrlã€price</code>ç­‰ã€‚<code>converRefundGoodsModelWithArray</code>ç”¨æ¥æŠŠ<code>OrderShopGoodsModel</code>è½¬åŒ–æˆ<code>RefundShopGoodsModel</code>ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vc.FmodelArray = [self converRefundGoodsModelWithArray:self.modelArray];</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;è¿™æ ·æ²¡æœ‰æ ¹æœ¬è§£å†³è§£è€¦é—®é¢˜ï¼ŒæŠŠè½¬æ¢<code>Model</code>çš„ä»£ç æ”¾åœ¨è®¢å•è¯¦æƒ…ï¼Œè®¢å•è¯¦æƒ…è¿˜éœ€è¦ä¾èµ–<code>RefundShopGoodsModel</code>ï¼ŒåŒæ ·æŠŠè½¬æ¢çš„ä»£ç æ”¾åœ¨ç”³è¯·å”®åï¼Œå”®åæ¨¡å—è¿˜è¦ä¾èµ–<code>OrderShopGoodsModel</code>ã€‚<br>&ensp;&ensp;&ensp;&ensp;<strong>ä¸ºäº†è§£å†³æ¨¡å—ä¹‹é—´é€šè®¯çš„å‚æ•°é—®é¢˜ï¼Œæ˜¯ä¸èƒ½ç”¨<code>Model</code>æ¥ä¼ é€’çš„ï¼Œå¦åˆ™æ— æ³•è§£å†³ä¾èµ–é—®é¢˜</strong>ã€‚æœ€åçš„åšæ³•æ˜¯<code>RefundViewController</code>æš´éœ²å‡ºä¸€ä¸ªå­—å…¸<code>Fparams</code>ç”¨æ¥æ¥æ”¶å‚æ•°ã€‚<code>Fparams</code>æ˜¯æœªç»è½¬åŒ–åŸå§‹å•†å“æ•°æ®ã€‚ç„¶åœ¨<code>RefundViewController</code>å†…å†™æ–¹æ³•å°†å­—å…¸è½¬ä¸ºç›¸åº”çš„æ¨¡å‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vc.Fparams = self.refundParams;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;é…åˆä¸­é—´ä»¶CTMediatorè·¯ç”±è·³è½¬å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UIViewController * vc = [[CTMediator sharedInstance] CTMediator_RefundViewControllerWithValue:self.refundParams];</span><br><span class="line">[self.navigationController pushViewController:vc animated:YES];</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;æ¥å…¬å¸å¤§åŠå¹´æ—¶é—´äº†ï¼Œä¸€ä¸ªäººæç»„ä»¶åŒ–ä¸è½»æ¾ï¼Œå…ˆæ¥çœ‹çœ‹&lt;code&gt;podfile&lt;/code&gt;ï¼Œä¸šåŠ¡åŠŸèƒ½éƒ½å·²ç»æ‹†åˆ†æˆäº†ä¸€ä¸ªç»„ä»¶ï¼Œç°åœ¨ä¸»å·¥ç¨‹å°±æ˜¯ä¸€ä¸ªç©ºå£³å­ï¼Œæ‰€æœ‰çš„ä¸šåŠ¡åœºæ™¯éƒ½åœ¨ç»„ä»¶åŒ–åŒ…é‡Œé¢ã€‚ç°åœ¨æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨ç»„ä»¶åŒ–è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Runtimeæ¶ˆæ¯è½¬å‘åŠå…¶åº”ç”¨</title>
    <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/10/30/Runtime%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/"/>
    <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/10/30/Runtimeæ¶ˆæ¯è½¬å‘åŠå…¶åº”ç”¨/</id>
    <published>2018-10-30T11:39:40.000Z</published>
    <updated>2018-10-30T07:58:06.354Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;ä¹‹å‰å†™è¿‡æ–‡ç« <a href="https://ios-misaki.github.io/iOS-Misaki.github.io/2018/01/08/Runtime%E7%9A%84%E5%B8%B8%E8%A7%81%E7%94%A8%E6%B3%95/" target="_blank" rel="noopener">Runtimeçš„å¸¸è§ç”¨æ³•</a>é‡Œé¢æœ‰ä»‹ç»è¿‡åˆ©ç”¨<code>Objective-C</code>çš„<code>Runtime</code>ç‰¹æ€§æ¥ç»™<code>Category</code>ç”Ÿæˆå±æ€§ã€å®ç°æ–¹æ³•äº¤æ¢å’Œç»™<code>Model</code>èµ‹å€¼ã€‚ä»Šå¤©æ•´ç†ä¸€ä¸‹<code>Objective-C</code>æ¶ˆæ¯ä¼ é€’å’Œæ¶ˆæ¯è½¬å‘æœºåˆ¶ä»¥åŠæ¥é˜²æ­¢åº”ç”¨é—ªé€€çš„é—®é¢˜ã€‚</p><a id="more"></a><h2 id="æ¶ˆæ¯ä¼ é€’"><a href="#æ¶ˆæ¯ä¼ é€’" class="headerlink" title="æ¶ˆæ¯ä¼ é€’"></a>æ¶ˆæ¯ä¼ é€’</h2><p>&ensp;&ensp;æ‰“å¼€#import&lt;objc/runtime.h&gt;æ–‡ä»¶ï¼Œçœ‹åˆ°<code>struct objc_class</code>çš„å®šä¹‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">struct objc_class &#123;</span><br><span class="line">    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line"></span><br><span class="line">#if !__OBJC2__</span><br><span class="line">    Class _Nullable super_class                              OBJC2_UNAVAILABLE;</span><br><span class="line">    const char * _Nonnull name                               OBJC2_UNAVAILABLE;</span><br><span class="line">    long version                                             OBJC2_UNAVAILABLE;</span><br><span class="line">    long info                                                OBJC2_UNAVAILABLE;</span><br><span class="line">    long instance_size                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    struct objc_ivar_list * _Nullable ivars                  OBJC2_UNAVAILABLE;</span><br><span class="line">    struct objc_method_list * _Nullable * _Nullable methodLists                    OBJC2_UNAVAILABLE;</span><br><span class="line">    struct objc_cache * _Nonnull cache                       OBJC2_UNAVAILABLE;</span><br><span class="line">    struct objc_protocol_list * _Nullable protocols          OBJC2_UNAVAILABLE;</span><br><span class="line">#endif</span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;<strong>ç»“æ„ä½“ä¸­æœ‰å¾ˆå¤šå˜é‡ï¼Œåˆ†åˆ«æ˜¯çˆ¶ç±»çš„æŒ‡é’ˆã€ç±»çš„åå­—ã€ç±»çš„ç‰ˆæœ¬ã€å®ä¾‹å¤§å°ã€å˜é‡åˆ—è¡¨ã€æ–¹æ³•åˆ—è¡¨ã€æ–¹æ³•ç¼“å­˜ã€åè®®åˆ—è¡¨ã€‚ä¸€ä¸ªç±»å¯¹è±¡å°±æ˜¯ä¸€ä¸ªç»“æ„ä½“<code>struct objc_class</code>  ï¼Œè¿™ä¸ªç»“æ„ä½“å­˜æ”¾çš„æ•°æ®ç§°ä¸º<code>metadata(å…ƒæ•°æ®)</code>ï¼Œç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡æ˜¯ä¸€ä¸ªisaæŒ‡é’ˆï¼ŒisaæŒ‡é’ˆæŒ‡å‘<code>metaclassï¼ˆå…ƒç±»ï¼‰</code>ã€‚</strong></p><p>&ensp;&ensp;åœ¨çœ‹çœ‹<code>Method</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Method(objc_method)</span><br><span class="line">struct objc_method &#123;</span><br><span class="line">    SEL _Nonnull method_name                                 OBJC2_UNAVAILABLE;</span><br><span class="line">    char * _Nullable method_types                            OBJC2_UNAVAILABLE;</span><br><span class="line">    IMP _Nonnull method_imp                                  OBJC2_UNAVAILABLE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;è¿™ä¸ªå°±æ˜¯å¹³å¸¸ä½¿ç”¨çš„å‡½æ•°ï¼Œèƒ½å¤Ÿç‹¬ç«‹å®Œæˆä¸€ä¸ªåŠŸèƒ½çš„ä¸€æ®µä»£ç </p><ul><li><code>SEL method_name</code> æ–¹æ³•å</li><li><code>char* method_types</code>æ–¹æ³•ç±»å‹</li><li><code>IMP method_imp</code> æ–¹æ³•å®ç°çš„æŒ‡é’ˆ</li><li><code>SEL</code>å’Œ<code>IMP</code>éƒ½æ˜¯Methodçš„å±æ€§</li></ul><p>&ensp;&ensp;ä¸€èˆ¬OCä¸­å‡½æ•°è°ƒç”¨ä¾‹å¦‚ <code>[obj dosomthing]</code>éƒ½ä¼šè¢«ç¼–è¯‘å™¨è½¬ä¹‰æˆ<code>objc_msgsend(obj,dosomething)</code>,<code>obj</code>å°±æ˜¯å¯¹è±¡å®ä¾‹ï¼Œ<code>dosomething</code>æ˜¯<code>SEL</code>ç±»å‹ã€‚<code>Runtime</code>çš„æ‰§è¡Œçš„æµç¨‹æ˜¯</p><ul><li>1.é€šè¿‡<code>obj</code>çš„<code>isa</code>æŒ‡é’ˆæ‰¾åˆ°ä»–çš„<code>class</code>ï¼Œç„¶ååœ¨<code>class</code>ä¸­çš„<code>objc_cache</code>ä¸­æŸ¥æ‰¾æ–¹æ³•</li><li>2.å‡å¦‚æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±å»<code>objc_method_list</code>ä¸­æŸ¥æ‰¾å¯¹åº”çš„æ–¹æ³•</li><li>3.å¦‚æœåœ¨<code>class</code>ä¸­ç§æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ–¹æ³•ï¼Œåˆ™ä¼šç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼Œåœ¨<code>çˆ¶ç±»ï¼ˆsuper_classï¼‰</code>é‡å¤æ­¥éª¤1ã€2ã€‚</li><li>4.å‡å¦‚ä¸€ç›´æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œé€šå¸¸ä¼š<code>crash</code>å¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œåœ¨æŠ›å‡ºå¼‚å¸¸å‰ä¼šæ‰§è¡Œæ¶ˆæ¯è½¬å‘ã€‚</li></ul><h2 id="æ¶ˆæ¯è½¬å‘"><a href="#æ¶ˆæ¯è½¬å‘" class="headerlink" title="æ¶ˆæ¯è½¬å‘"></a>æ¶ˆæ¯è½¬å‘</h2><p>&ensp;&ensp;å‘ç”Ÿæ¶ˆæ¯è½¬å‘ï¼Œè¿˜æœ‰ä¸‰æ¬¡æœºä¼šï¼Œå‡å¦‚éƒ½å¤±è´¥äº†å°±ä¼šæ‰§è¡Œ<code>doesNotRecognizeSelectorï¼š</code>æŠ¥é”™<code>unrecognized selector</code>ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/1487718-574c486162950666.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS æ¶ˆæ¯è½¬å‘æµç¨‹å›¾.png"></p><h3 id="åŠ¨æ€æ–¹æ³•è§£æ"><a href="#åŠ¨æ€æ–¹æ³•è§£æ" class="headerlink" title="åŠ¨æ€æ–¹æ³•è§£æ"></a>åŠ¨æ€æ–¹æ³•è§£æ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[self performSelector:@selector(testMethod:) withObject:@&quot;something&quot;];</span><br></pre></td></tr></table></figure><p>&ensp;&ensp;æˆ‘åœ¨<code>ViewController</code>é‡Œé¢è°ƒç”¨<code>testMethod</code>æ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰åœ¨<code>ViewController</code>ç”³æ˜è¿™ä¸ªæ–¹æ³•ï¼Œè¿è¡Œèµ·æ¥è‚¯å®šæ˜¯å´©æºƒçš„ã€‚<br>åœ¨è¿è¡Œæ—¶ï¼Œå¦‚æœæ‰¾ä¸åˆ°è¦æ‰§è¡Œçš„æ–¹æ³•ï¼Œä¼šé¦–å…ˆæ‰§è¡Œ<code>resolveClassMethod:</code>æˆ–è€…<code>resolveInstanceMethodï¼š</code>ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - æ·»åŠ çš„IMP</span><br><span class="line">void myMethod(id self, SEL cmd, id value)</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;,value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ‰¾ä¸åˆ°å¯¹è±¡æ–¹æ³•æ—¶å€™è°ƒç”¨</span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    if (sel == @selector(testMethod:))</span><br><span class="line">    &#123;</span><br><span class="line">        class_addMethod([self class],sel,(IMP)myMethod,&quot;v@:@&quot;);</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        return [super resolveInstanceMethod:sel];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ‰¾ä¸åˆ°ç±»æ–¹æ³•æ—¶è°ƒç”¨</span><br><span class="line">+ (BOOL)resolveClassMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    return [super resolveClassMethod:sel];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;å½“<code>ViewController</code>å¯¹è±¡æ‰¾ä¸åˆ°<code>testMethod</code>æ–¹æ³•ï¼Œé¦–å…ˆè°ƒç”¨<code>resolveInstanceMethod</code>è¿›è¡Œæ‹¦æˆªè¡¥æ•‘ã€‚åˆ¤æ–­<code>ViewController</code>æ‰¾ä¸åˆ°çš„æ–¹æ³•æ˜¯å¦ä¸º<code>testMethod</code><br>å¦‚æœæ˜¯<code>testMethod</code>ï¼Œè°ƒç”¨<code>class_addMethod</code>ä¸º<code>ViewController</code>åŠ¨æ€çš„æ·»åŠ <code>testMethod</code>æ–¹æ³•ã€‚<br><code>class_addMethod</code>çš„å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯</p><ul><li>åŠ¨æ€æ·»åŠ æ–¹æ³•çš„ç±»</li><li>åŠ¨æ€æ·»åŠ çš„æ–¹æ³•</li><li>æ–¹æ³•å®ç°</li><li>å‚æ•°ç±»å‹<br>&ensp;&ensp;è¿™é‡Œå‡å¦‚è¯´æƒ³åœ¨<code>resolveClassMethod</code>åŠ¨æ€çš„æ·»åŠ ç±»æ–¹æ³•ï¼Œ<code>class_addMethod</code>çš„ç¬¬ä¸€å‚æ•°æ›¿æ¢æˆ<code>[self superClass]</code>å³å¯ã€‚</li></ul><h3 id="å¤‡ç”¨æ¥æ”¶è€…"><a href="#å¤‡ç”¨æ¥æ”¶è€…" class="headerlink" title="å¤‡ç”¨æ¥æ”¶è€…"></a>å¤‡ç”¨æ¥æ”¶è€…</h3><p>&ensp;&ensp;å‡å¦‚æ²¡æœ‰åœ¨<code>resolveInstanceMethod</code>é‡Œé¢åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œè¿˜æ˜¯ä¼šå´©æºƒï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦å¦å¤–ä¸€ä¸ªå¯¹è±¡æ¥æ¥æ”¶è¿™ä¸ªæ¶ˆæ¯ã€‚æ–°å»ºä¸€ä¸ª<code>BackupViewController</code>ç±»ï¼Œç„¶åè®©<code>BackupViewController</code>å»æ‰§è¡Œ<code>testMethod</code>æ–¹æ³•ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@implementation BackupViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    // Do any additional setup after loading the view.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)testMethod:(NSString *)str</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;,str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - æ‰¾ä¸åˆ°å¯¹è±¡æ–¹æ³•æ—¶å€™è°ƒç”¨</span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    return [super resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ‰¾ä¸åˆ°ç±»æ–¹æ³•æ—¶è°ƒç”¨</span><br><span class="line">+ (BOOL)resolveClassMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    return [super resolveClassMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - å¯»æ‰¾å¤‡ç”¨æ¥æ”¶è€…</span><br><span class="line">- (id)forwardingTargetForSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    BackupViewController * backup = [[BackupViewController alloc] init];</span><br><span class="line">    if ([backup respondsToSelector:@selector(testMethod:)])</span><br><span class="line">    &#123;</span><br><span class="line">        return backup;</span><br><span class="line">    &#125;</span><br><span class="line">    return [super forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&ensp;&ensp;è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œæ—¢ç„¶è‡ªå·±ä¸èƒ½åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œé‚£å°±è®©å…¶ä»–çš„å¯¹è±¡æ¥æ¥æ”¶è¿™ä¸ªæ¶ˆæ¯ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå¤‡ç”¨è€…ä¸èƒ½æ˜¯<code>self</code>æœ¬èº«ï¼Œå¦åˆ™ä¼šé™·å…¥å¾ªç¯ä¸­ã€‚</p><h3 id="å®Œæ•´æ¶ˆæ¯è½¬å‘"><a href="#å®Œæ•´æ¶ˆæ¯è½¬å‘" class="headerlink" title="å®Œæ•´æ¶ˆæ¯è½¬å‘"></a>å®Œæ•´æ¶ˆæ¯è½¬å‘</h3><p>&ensp;&ensp;å‡å¦‚ä¸åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œä¹Ÿä¸è½¬å‘ç»™å¤‡ç”¨æ¥æ”¶è€…ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å®Œæ•´æ¶ˆæ¯è½¬å‘<code>NSInvocation</code>æ¥å¤„ç†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - ViewControlleræ‰¾ä¸åˆ°æ–¹æ³•çš„å®ç°ç­¾åï¼Œéœ€è¦ç»™aSelectoræ–°å»ºæ–¹æ³•ç­¾åï¼Œåœ¨äº¤ç»™Backupå¤„ç†</span><br><span class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    NSMethodSignature * signature = [super methodSignatureForSelector:aSelector];</span><br><span class="line">    if (!signature)</span><br><span class="line">    &#123;</span><br><span class="line">        signature = [BackupViewController instanceMethodSignatureForSelector:aSelector];</span><br><span class="line">    &#125;</span><br><span class="line">    return signature;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ–¹æ³•ç­¾ååè¿›å…¥forwardInvocationæ–¹æ³•</span><br><span class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation</span><br><span class="line">&#123;</span><br><span class="line">    SEL sel = anInvocation.selector;</span><br><span class="line">    BackupViewController * backup = [[BackupViewController alloc] init];</span><br><span class="line">    if ([backup respondsToSelector:sel])</span><br><span class="line">    &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:backup];</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        [self doesNotRecognizeSelector:sel];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;é¦–å…ˆåˆ›å»º<code>NSInvocation</code>å¯¹è±¡ï¼ŒæŠŠå°šæœªå¤„ç†çš„é‚£æ¡æ¶ˆæ¯æœ‰å…³çš„å…¨éƒ¨ç»†èŠ‚å°è£…äºè¿™ä¸ª<code>NSInvocation</code>å¯¹è±¡ä¸­ã€‚æ­¤å¯¹è±¡ä¸­åŒ…å«é€‰æ‹©å­ï¼ˆ<code>selector</code>ï¼‰ã€ç›®æ ‡ï¼ˆ<code>target</code>ï¼‰åŠå‚æ•°ã€‚åœ¨è§¦å‘<code>NSInvocation</code>å¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨<code>forwardInvocation</code>æ¥è½¬å‘æ¶ˆæ¯ï¼Œå¦‚æœå‘ç°è°ƒç”¨æ“ä½œä¸ç”±æœ¬ç±»æ¥å¤„ç†ï¼Œåˆ™éœ€è¦æ²¿ç€ç»§æ‰¿ä½“ç³»ï¼Œè°ƒç”¨çˆ¶ç±»çš„åŒåæ–¹æ³•ï¼Œä¸€ç›´åˆ°<code>NSObject</code>ç±»ï¼Œè°ƒç”¨<code>doesNotRecognizeSelector</code>æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œæ¶ˆæ¯è½¬å‘ç»“æŸã€‚</p><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><p>&ensp;&ensp;åœ¨è¿™é‡Œæ¶ˆæ¯è½¬å‘ä¸‰ä¸ªæ­¥éª¤ä¸­ï¼Œç¬¬ä¸€æ­¥<code>resolveInstanceMethod</code>å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯éœ€è¦åœ¨å½“å‰å¯¹è±¡æ·»åŠ ä¸å­˜åœ¨çš„æ–¹æ³•ã€‚ç¬¬ä¸‰æ­¥ï¼Œä¼šå¯¼è‡´æ¶ˆæ¯æµè½¬çš„å‘¨æœŸå˜é•¿ï¼Œè¿˜ä¼šäº§ç”Ÿ<code>NSInvocation</code>ï¼Œå¢åŠ é¢å¤–çš„å¼€é”€ã€‚æ‰€ä»¥åœ¨åº”ç”¨ä¸­ï¼Œåœ¨ç¬¬äºŒæ­¥å¤„ç†æ¶ˆæ¯é˜²æ­¢åº”ç”¨é—ªé€€ã€‚<br>&ensp;&ensp;<strong>å¯ä»¥åŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªç±»ï¼ŒåŠ¨æ€çš„ç»™è¯¥ç±»æ·»åŠ å¯¹åº”çš„<code>Selector</code>,é€šè¿‡ä¸€ä¸ªé€šç”¨çš„è¿”å›0çš„å‡½æ•°æ¥å®ç°æ”¹<code>SEL</code>çš„<code>IMP</code>ã€‚ç„¶åå°†æ¶ˆæ¯è½¬å‘åˆ°è¿™ä¸ªç±»ä¸Šã€‚</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;ForwardingTarget.h&quot;</span><br><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line"></span><br><span class="line">@implementation ForwardingTarget</span><br><span class="line"></span><br><span class="line">id ForwardingTarget_dynamicMethod(id self, SEL _cmd)</span><br><span class="line">&#123;</span><br><span class="line">    return [NSNull null];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    class_addMethod([self class], sel, (IMP)ForwardingTarget_dynamicMethod, &quot;@@:&quot;);</span><br><span class="line">    return [super resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)forwardingTargetForSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    id result = [super forwardingTargetForSelector:aSelector];</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    id result = [super methodSignatureForSelector:aSelector];</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation</span><br><span class="line">&#123;</span><br><span class="line">    [super forwardInvocation:anInvocation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)doesNotRecognizeSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    [super doesNotRecognizeSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#import &quot;NSObject+DoesNotRecognizeSelectorExtension.h&quot;</span><br><span class="line"></span><br><span class="line">#import &quot;ForwardingTarget.h&quot;</span><br><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line"></span><br><span class="line">static ForwardingTarget * _target = nil;</span><br><span class="line"></span><br><span class="line">@implementation NSObject (DoesNotRecognizeSelectorExtension)</span><br><span class="line"></span><br><span class="line">+ (void)load</span><br><span class="line">&#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        _target = [ForwardingTarget new];;</span><br><span class="line">        not_recognize_selector_classMethodSwizzle([self class], @selector(forwardingTargetForSelector:), @selector(doesnot_recognize_selector_swizzleForwardingTargetForSelector:));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (id)doesnot_recognize_selector_swizzleForwardingTargetForSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    id result = [self doesnot_recognize_selector_swizzleForwardingTargetForSelector:aSelector];</span><br><span class="line">    if (result)</span><br><span class="line">    &#123;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return _target;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - private method</span><br><span class="line"></span><br><span class="line">BOOL not_recognize_selector_classMethodSwizzle(Class aClass, SEL originalSelector, SEL swizzleSelector)</span><br><span class="line">&#123;</span><br><span class="line">    Method originalMethod = class_getInstanceMethod(aClass, originalSelector);</span><br><span class="line">    Method swizzleMethod = class_getInstanceMethod(aClass, swizzleSelector);</span><br><span class="line">    BOOL didAddMethod = class_addMethod(aClass,originalSelector,method_getImplementation(swizzleMethod),method_getTypeEncoding(swizzleMethod));</span><br><span class="line">    if (didAddMethod)</span><br><span class="line">    &#123;</span><br><span class="line">        class_replaceMethod(aClass,swizzleSelector,method_getImplementation(originalMethod),method_getTypeEncoding(originalMethod));</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        method_exchangeImplementations(originalMethod, swizzleMethod);</span><br><span class="line">    &#125;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p><strong>å‚è€ƒ<br><a href="https://yq.aliyun.com/articles/348673" target="_blank" rel="noopener">iOS unrecognized selector crash è‡ªä¿®å¤æŠ€æœ¯å®ç°ä¸åŸç†è§£æ</a><br><a href="https://neyoufan.github.io/2017/01/13/ios/BayMax_HTSafetyGuard/" target="_blank" rel="noopener">å¤§ç™½å¥åº·ç³»ç»Ÿâ€“iOS APPè¿è¡Œæ—¶Crashè‡ªåŠ¨ä¿®å¤ç³»ç»Ÿ</a></strong></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;ä¹‹å‰å†™è¿‡æ–‡ç« &lt;a href=&quot;https://ios-misaki.github.io/iOS-Misaki.github.io/2018/01/08/Runtime%E7%9A%84%E5%B8%B8%E8%A7%81%E7%94%A8%E6%B3%95/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Runtimeçš„å¸¸è§ç”¨æ³•&lt;/a&gt;é‡Œé¢æœ‰ä»‹ç»è¿‡åˆ©ç”¨&lt;code&gt;Objective-C&lt;/code&gt;çš„&lt;code&gt;Runtime&lt;/code&gt;ç‰¹æ€§æ¥ç»™&lt;code&gt;Category&lt;/code&gt;ç”Ÿæˆå±æ€§ã€å®ç°æ–¹æ³•äº¤æ¢å’Œç»™&lt;code&gt;Model&lt;/code&gt;èµ‹å€¼ã€‚ä»Šå¤©æ•´ç†ä¸€ä¸‹&lt;code&gt;Objective-C&lt;/code&gt;æ¶ˆæ¯ä¼ é€’å’Œæ¶ˆæ¯è½¬å‘æœºåˆ¶ä»¥åŠæ¥é˜²æ­¢åº”ç”¨é—ªé€€çš„é—®é¢˜ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>TransitionAnimation è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»</title>
    <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/08/04/TransitionAnimation-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB/"/>
    <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/08/04/TransitionAnimation-è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»/</id>
    <published>2018-08-04T12:40:27.000Z</published>
    <updated>2018-08-04T14:53:14.814Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;&ensp;&ensp;åœ¨<code>iOS 7</code>ä¹‹åï¼Œè‹¹æœå°±å¼€æ”¾äº†è‡ªå®šä¹‰è½¬åœºçš„ç›¸å…³<code>api</code>ï¼Œç°åœ¨éƒ½å¿«<code>iOS 12</code>äº†ï¼Œä¸€ç›´éƒ½æ²¡æœ‰å¥½å¥½ç ”ç©¶è½¬åœºåŠ¨ç”»ï¼Œä¸€ä¸ªæ˜¯ä¹‹å‰æ²¡æœ‰é‡è§†ï¼Œè§‰å¾—èŠ±é‡Œèƒ¡å“¨çš„ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æ‰€åšçš„é¡¹ç›®ä¸­æ²¡æœ‰è¿™æ ·çš„è½¬åœºåŠ¨ç”»éœ€æ±‚ã€‚è¿™é‡Œè¯´çš„è½¬åœºåŠ¨ç”»å’Œä¸Šä¸€ç¯‡<a href="https://ios-misaki.github.io/iOS-Misaki.github.io/2018/07/26/CAAnimation%20%E7%B3%BB%E5%88%97%E5%8A%A8%E7%94%BB/" target="_blank" rel="noopener">CAAnimation ç³»ç»ŸåŠ¨ç”»</a>ä¸­<code>CATransition</code>åŠ¨ç”»ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œä¸Šä¸€ç¯‡æŒ‡çš„æ˜¯å•ä¸ªViewçš„è½¬åœºç‰¹æ•ˆï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯æ•´ä¸ªæ§åˆ¶å™¨çš„è½¬åœºç‰¹æ•ˆã€‚å…¶å®å†™ä¸Šç¯‡æ–‡ç« çš„ç›®å‰ä¹Ÿæ˜¯ä¸ºä»Šå¤©æ‰“ä¸‹é“ºå«ï¼Œå¤æ‚çš„è½¬åœºæ•ˆæœä¹Ÿæ˜¯ç”±å•ä¸ªåŠ¨ç”»æ¥ç»„æˆçš„ã€‚</p><a id="more"></a><p><img src="https://yuyiios-work.oss-cn-shanghai.aliyuncs.com/%E5%8D%9A%E5%AE%A2/TransitionAnimation%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB/%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB%E7%B1%BB%E5%9B%BE.png" alt="è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»ç±»å›¾"></p><p>&ensp;&ensp;&ensp;&ensp;ç”±å›¾ä¸­å¯ä»¥çœ‹å‡ºè¦å®Œæˆè‡ªå®šä¹‰è½¬åœºåŠ¨ç”»ï¼Œå¿…é¡»éµä»<code>UIViewControllerAnimatedTransitioning</code>åè®®ï¼Œåè®®ä¸­æœ‰ä¸¤ä¸ªå¿…é¡»å®ç°çš„æ–¹æ³•ä¸€ä¸ªæ˜¯è¿”å›è½¬åœºæ—¶é—´ï¼Œä¸€ä¸ªæ˜¯å…·ä½“è½¬åœºçš„å®ç°ã€‚æ–‡ç« ä¼šç»“åˆ5ä¸ªæœ€å¸¸ç”¨çš„åŠ¨ç”»åœºæ™¯æ¥è¯´æ˜è½¬åœºåŠ¨ç”»ã€‚</p><p>&ensp;&ensp;&ensp;&ensp;å…ˆæ¥çœ‹çœ‹ç½‘æ˜“ä¸¥é€‰Appçš„è½¬åœºæ•ˆæœï¼Œå¯ä»¥çœ‹å‡ºå½“å‰é¡µé¢æƒ³è¦<code>Push</code>å…¶ä»–çš„é¡µé¢çš„æ—¶å€™ï¼Œå½“å‰é¡µé¢ä¼šä¸‹æ²‰åŒæ—¶å…¶ä»–é¡µé¢ä»å³è¾¹å¹³ç§»è‡³å·¦è¾¹ã€‚<code>Present</code>é¡µé¢çš„æ—¶å€™ï¼Œå½“å‰é¡µé¢ä¹Ÿä¼šä¸‹æ²‰ï¼Œç›®æ ‡è§†å›¾ä»åº•éƒ¨å¼¹å‡ºã€‚<br><img src="https://yuyiios-work.oss-cn-shanghai.aliyuncs.com/%E5%8D%9A%E5%AE%A2/TransitionAnimation%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB/%E7%BD%91%E6%98%93%E4%B8%A5%E9%80%89Push%E5%92%8CPop%E5%8A%A8%E7%94%BB.gif" alt="ç½‘æ˜“ä¸¥é€‰Pushå’ŒPopåŠ¨ç”».gif"></p><p><img src="https://yuyiios-work.oss-cn-shanghai.aliyuncs.com/%E5%8D%9A%E5%AE%A2/TransitionAnimation%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB/%E7%BD%91%E6%98%93%E4%B8%A5%E9%80%89Present%E5%92%8CDismiss%E5%8A%A8%E7%94%BB.gif" alt="ç½‘æ˜“ä¸¥é€‰Presentå’ŒDismissåŠ¨ç”».gif"></p><p>&ensp;&ensp;&ensp;&ensp;æ¥çœ‹ä»£ç ï¼Œåœ¨<code>ViewController</code>é‡Œé¢æœ‰ä¸¤ä¸ªæŒ‰é’®ï¼Œåˆ†åˆ«æ˜¯<code>Push</code>å‡º<code>SecondVC</code>å’Œ<code>Present</code>å‡º<code>ThirdVC</code>ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (IBAction)pushBtnClick:(id)sender</span><br><span class="line">&#123;</span><br><span class="line">    SecondViewController * vc = [[SecondViewController alloc] init];</span><br><span class="line">    [self.navigationController pushViewController:vc animated:YES];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (IBAction)presentBtnClick:(id)sender</span><br><span class="line">&#123;</span><br><span class="line">    ThirdViewController * vc = [[ThirdViewController alloc] init];</span><br><span class="line">    [self presentViewController:vc animated:YES completion:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Pushå’ŒPopåŠ¨ç”»"><a href="#Pushå’ŒPopåŠ¨ç”»" class="headerlink" title="Pushå’ŒPopåŠ¨ç”»"></a>Pushå’ŒPopåŠ¨ç”»</h2><h3 id="UIViewControllerAnimatedTransitioningåè®®"><a href="#UIViewControllerAnimatedTransitioningåè®®" class="headerlink" title="UIViewControllerAnimatedTransitioningåè®®"></a>UIViewControllerAnimatedTransitioningåè®®</h3><p>&ensp;&ensp;&ensp;&ensp;è¿™é‡Œæ–°å»ºä¸€ä¸ª<code>AnimatedTransitioningObject</code>ç±»ï¼Œç„¶åè¦éµå¾ª<code>UIViewControllerAnimatedTransitioning</code>åè®®ã€‚è¿™ä¸ªä¸ºäº†æ–¹ä¾¿ï¼ŒæŠŠ<code>Pushã€Popã€Presentã€Dismiss</code>è¿™å››ä¸ªæ•ˆæœå†™åœ¨ä¸€èµ·ï¼Œç”¨æšä¸¾æ¥åŒºåˆ†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŠŠæ¯ç§åŠ¨ç”»æ•ˆæœå•ç‹¬ç”¨ä¸€ä¸ª<code>AnimatedTransitioningObject</code>ç±»æ¥å®ç°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger,TransitionAnimationObjectType) &#123;</span><br><span class="line">    TransitionAnimationObjectType_Push,</span><br><span class="line">    TransitionAnimationObjectType_Pop,</span><br><span class="line">    TransitionAnimationObjectType_present,</span><br><span class="line">    TransitionAnimationObjectType_Dismiss</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@interface TransitionAnimationObject : NSObject &lt;UIViewControllerAnimatedTransitioning&gt;</span><br><span class="line"></span><br><span class="line">@property (nonatomic,assign) TransitionAnimationObjectType type;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithTransitionAnimationObjectType:(TransitionAnimationObjectType)type;</span><br><span class="line"></span><br><span class="line">+ (instancetype)initWithTransitionAnimationObjectType:(TransitionAnimationObjectType)type;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;æ¥çœ‹çœ‹ä¸¤ä¸ªå¿…é¡»å®ç°çš„æ–¹æ³•ï¼Œåœ¨è¿”å›è½¬åœºæ—¶é—´é‡Œä¹Ÿå¯ä»¥æ ¹æ®<code>type</code>æ¥è¿”å›ä¸åŒçš„åŠ¨ç”»æ—¶é—´ï¼Œè¿™é‡Œç»Ÿä¸€è¿”å›0.5ç§’ã€‚<code>pushAnimateTransition</code>é‡Œé¢å®ç°<code>Push</code>æ•ˆæœè½¬åœºã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (NSTimeInterval)transitionDuration:(id&lt;UIViewControllerContextTransitioning&gt;)transitionContext</span><br><span class="line">&#123;</span><br><span class="line">    return 0.5;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)animateTransition:(id&lt;UIViewControllerContextTransitioning&gt;)transitionContext</span><br><span class="line">&#123;</span><br><span class="line">    switch (_type) &#123;</span><br><span class="line">        case TransitionAnimationObjectType_Push:</span><br><span class="line">            [self pushAnimateTransition:transitionContext];</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        case TransitionAnimationObjectType_Pop:</span><br><span class="line">            [self popAnimateTransition:transitionContext];</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        case TransitionAnimationObjectType_present:</span><br><span class="line">            [self presentAnimateTransition:transitionContext];</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        case TransitionAnimationObjectType_Dismiss:</span><br><span class="line">            [self dismissAnimateTransition:transitionContext];</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="Pushå®ç°"><a href="#Pushå®ç°" class="headerlink" title="Pushå®ç°"></a>Pushå®ç°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">- (void)pushAnimateTransition:(id&lt;UIViewControllerContextTransitioning&gt;)transitionContext</span><br><span class="line">&#123;</span><br><span class="line">    //è·å–ç›®æ ‡View(secondVC.view) å’Œ æ¥æºView(ViewController.view)</span><br><span class="line">    UIView * toView = [transitionContext viewForKey:UITransitionContextToViewKey];</span><br><span class="line">    UIView * fromView = [transitionContext viewForKey:UITransitionContextFromViewKey];</span><br><span class="line"></span><br><span class="line">    //è¿™é‡Œæˆªå›¾åšåŠ¨ç”» éšè—æ¥æºView</span><br><span class="line">    UIView * tempView = [fromView snapshotViewAfterScreenUpdates:NO];</span><br><span class="line">    fromView.hidden = YES;</span><br><span class="line"></span><br><span class="line">    //å°†éœ€è¦åšè½¬åœºçš„ViewæŒ‰ç…§é¡ºåºæ·»åŠ åˆ°è½¬åœºå®¹å™¨ä¸­</span><br><span class="line">    UIView * containerView = [transitionContext containerView];</span><br><span class="line">    [containerView addSubview:tempView];</span><br><span class="line">    [containerView addSubview:toView];</span><br><span class="line"></span><br><span class="line">    CGFloat width = containerView.frame.size.width;</span><br><span class="line">    CGFloat height = containerView.frame.size.height;</span><br><span class="line"></span><br><span class="line">    //è®¾ç½®ç›®æ ‡Viewçš„åˆå§‹ä½ç½®</span><br><span class="line">    toView.frame = CGRectMake(width, 0, width, height);</span><br><span class="line"></span><br><span class="line">    //å¼€å§‹åšåŠ¨ç”»</span><br><span class="line">    NSTimeInterval duration = [self transitionDuration:transitionContext];</span><br><span class="line">    [UIView animateWithDuration:duration animations:^&#123;</span><br><span class="line">        tempView.transform = CGAffineTransformMakeScale(0.9, 0.9);</span><br><span class="line">        toView.transform = CGAffineTransformMakeTranslation(-width, 0);</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        //è¿™é‡Œè¦æ ‡è®°è½¬åœºæˆåŠŸ å‡å¦‚ä¸æ ‡è®° ç³»ç»Ÿä¼šè®¤ä¸ºè¿˜åœ¨è½¬åœºä¸­ æ— æ³•äº¤äº’</span><br><span class="line">        [transitionContext completeTransition:![transitionContext transitionWasCancelled]];</span><br><span class="line"></span><br><span class="line">        //è½¬åœºå¤±è´¥ ä¹Ÿè¦åšç›¸åº”çš„å¤„ç†</span><br><span class="line">        if ([transitionContext transitionWasCancelled])</span><br><span class="line">        &#123;</span><br><span class="line">            fromView.hidden = NO;</span><br><span class="line">            [tempView removeFromSuperview];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Popå®ç°"><a href="#Popå®ç°" class="headerlink" title="Popå®ç°"></a>Popå®ç°</h3><p>&ensp;&ensp;&ensp;&ensp; <code>Push</code>å’Œ<code>Pop</code>æ˜¯ç›¸å¯¹çš„å…³ç³»ï¼Œæ‰€ä»¥åœ¨<code>Pop</code>åŠ¨ç”»ä¸­ï¼Œç›®æ ‡è§†å›¾å’Œæ¥æºè§†å›¾äº’æ¢èº«ä»½ï¼Œå®ç°ä¹Ÿæ˜¯ç”¨<code>CGAffineTransformIdentity</code>æ¥è¿˜åŸ<code>Push</code>åŠ¨ç”»å³å¯ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">- (void)popAnimateTransition:(id&lt;UIViewControllerContextTransitioning&gt;)transitionContext</span><br><span class="line">&#123;</span><br><span class="line">    //æ³¨æ„è¿™é‡Œæ˜¯è¿˜åŸ æ‰€ä»¥toViewå’ŒfromView èº«ä»½äº’æ¢äº† toViewæ˜¯ViewController.view</span><br><span class="line">    UIView * toView = [transitionContext viewForKey:UITransitionContextToViewKey];</span><br><span class="line">    UIView * fromView = [transitionContext viewForKey:UITransitionContextFromViewKey];</span><br><span class="line"></span><br><span class="line">    //è·å–ç›¸åº”çš„è§†å›¾</span><br><span class="line">    UIView * containerView = [transitionContext containerView];</span><br><span class="line">    UIView * tempView = [[containerView subviews] firstObject];</span><br><span class="line"></span><br><span class="line">    //åœ¨fromView ä¸‹é¢æ’å…¥toView ä¸ç„¶å›æ¥çš„æ—¶å€™å›é»‘å±</span><br><span class="line">    [containerView insertSubview:toView belowSubview:fromView];</span><br><span class="line"></span><br><span class="line">    //å°†åŠ¨ç”»ç›´æ¥è¿˜åŸå³å¯</span><br><span class="line">    NSTimeInterval duration = [self transitionDuration:transitionContext];</span><br><span class="line">    [UIView animateWithDuration:duration animations:^&#123;</span><br><span class="line">        tempView.transform = CGAffineTransformIdentity;</span><br><span class="line">        fromView.transform = CGAffineTransformIdentity;</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        //æ ‡è®°è½¬åœº</span><br><span class="line">        [transitionContext completeTransition:!transitionContext.transitionWasCancelled];</span><br><span class="line"></span><br><span class="line">        //è½¬åœºæˆåŠŸçš„å¤„ç†</span><br><span class="line">        if (![transitionContext transitionWasCancelled])</span><br><span class="line">        &#123;</span><br><span class="line">            [tempView removeFromSuperview];</span><br><span class="line">            toView.hidden = NO;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="UINavigationControllerDelegateä»£ç†æ–¹æ³•"><a href="#UINavigationControllerDelegateä»£ç†æ–¹æ³•" class="headerlink" title="UINavigationControllerDelegateä»£ç†æ–¹æ³•"></a>UINavigationControllerDelegateä»£ç†æ–¹æ³•</h3><p>&ensp;&ensp;&ensp;&ensp;å®Œæˆ<code>AnimatedTransitioningObject</code>ç±»åï¼Œå†è¿”å›<code>ViewController</code>ä¸­ï¼Œ<code>ViewController</code>è¦éµå¾ª<code>UINavigationBarDelegate</code>å’Œ<code>UIViewControllerTransitioningDelegate</code>ï¼ŒæŠŠ<code>SecondVC</code>çš„<code>transitioningDelegate</code>è®¾ç½®ä¸ºè‡ªå·±ã€‚ç„¶åæ ¹æ®ä¸åŒçš„<code>operation</code>ï¼Œæ¥è¿”å›ä¸åŒçš„åŠ¨ç”»å®ç°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@interface ViewController () &lt;UINavigationControllerDelegate,UIViewControllerTransitioningDelegate&gt;</span><br><span class="line"></span><br><span class="line">- (IBAction)pushBtnClick:(id)sender</span><br><span class="line">&#123;</span><br><span class="line">    SecondViewController * vc = [[SecondViewController alloc] init];</span><br><span class="line">    vc.transitioningDelegate = self;</span><br><span class="line">    [self.navigationController pushViewController:vc animated:YES];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Push &amp;&amp; Pop</span><br><span class="line">- (id &lt;UIViewControllerAnimatedTransitioning&gt;)navigationController:(UINavigationController *)navigationController</span><br><span class="line">animationControllerForOperation:(UINavigationControllerOperation)operation</span><br><span class="line">fromViewController:(UIViewController *)fromVC</span><br><span class="line">toViewController:(UIViewController *)toVC</span><br><span class="line">&#123;</span><br><span class="line">    if (operation == UINavigationControllerOperationPush)</span><br><span class="line">    &#123;</span><br><span class="line">        return [TransitionAnimationObject initWithTransitionAnimationObjectType:TransitionAnimationObjectType_Push];</span><br><span class="line">    &#125;</span><br><span class="line">    else if (operation == UINavigationControllerOperationPop)</span><br><span class="line">    &#123;</span><br><span class="line">        return [TransitionAnimationObject initWithTransitionAnimationObjectType:TransitionAnimationObjectType_Pop];</span><br><span class="line">    &#125;</span><br><span class="line">    return nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;çœ‹çœ‹å®ç°æ•ˆæœ<br><img src="https://yuyiios-work.oss-cn-shanghai.aliyuncs.com/%E5%8D%9A%E5%AE%A2/TransitionAnimation%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB/Push%E5%92%8CPop%E6%95%88%E6%9E%9C.gif" alt="Pushå’ŒPopæ•ˆæœ.gif"></p><h2 id="PresentåŠ¨ç”»å’ŒDismissåŠ¨ç”»"><a href="#PresentåŠ¨ç”»å’ŒDismissåŠ¨ç”»" class="headerlink" title="PresentåŠ¨ç”»å’ŒDismissåŠ¨ç”»"></a>PresentåŠ¨ç”»å’ŒDismissåŠ¨ç”»</h2><h3 id="Presentå®ç°"><a href="#Presentå®ç°" class="headerlink" title="Presentå®ç°"></a>Presentå®ç°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- (void)presentAnimateTransition:(id&lt;UIViewControllerContextTransitioning&gt;)transitionContext</span><br><span class="line">&#123;</span><br><span class="line">    //è·å–ç›®æ ‡View(ThirdVC.view) å’Œ æ¥æºView(ViewController.view)</span><br><span class="line">    UIView * toView = [transitionContext viewForKey:UITransitionContextToViewKey];</span><br><span class="line">    UIView * fromView = [transitionContext viewForKey:UITransitionContextFromViewKey];</span><br><span class="line"></span><br><span class="line">    //æˆªå›¾åšåŠ¨ç”»</span><br><span class="line">    UIView * tempView = [fromView snapshotViewAfterScreenUpdates:NO];</span><br><span class="line">    tempView.frame = fromView.frame;</span><br><span class="line">    fromView.hidden = YES;</span><br><span class="line"></span><br><span class="line">    //æŒ‰ç…§é¡ºåºå‡å¦‚è½¬åœºåŠ¨ç”»å®¹å™¨ä¸­</span><br><span class="line">    UIView * containerView = [transitionContext containerView];</span><br><span class="line">    [containerView addSubview:tempView];</span><br><span class="line">    [containerView addSubview:toView];</span><br><span class="line"></span><br><span class="line">    CGFloat width = containerView.frame.size.width;</span><br><span class="line">    CGFloat height = containerView.frame.size.height;</span><br><span class="line"></span><br><span class="line">    //è®¾ç½®toViewçš„åˆå§‹åŒ–ä½ç½® åœ¨å±å¹•åº•éƒ¨</span><br><span class="line">    toView.frame = CGRectMake(0, height, width, 400);</span><br><span class="line"></span><br><span class="line">    //åšè½¬åœºåŠ¨ç”»</span><br><span class="line">    NSTimeInterval duration = [self transitionDuration:transitionContext];</span><br><span class="line">    [UIView animateWithDuration:duration delay:0 usingSpringWithDamping:0.55 initialSpringVelocity:1 options:0 animations:^&#123;</span><br><span class="line">        tempView.transform = CGAffineTransformMakeScale(0.9, 0.9);</span><br><span class="line">        toView.transform = CGAffineTransformMakeTranslation(0, -400);</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        //è½¬åœºç»“æŸåä¸€å®šè¦æ ‡è®° å¦åˆ™ä¼šè®¤ä¸ºè¿˜åœ¨è½¬åœº æ— æ³•äº¤äº’</span><br><span class="line">        [transitionContext completeTransition:![transitionContext transitionWasCancelled]];</span><br><span class="line">        if ([transitionContext transitionWasCancelled])</span><br><span class="line">        &#123;</span><br><span class="line">            //è½¬åœºå¤±è´¥</span><br><span class="line">            fromView.hidden = NO;</span><br><span class="line">            [tempView removeFromSuperview];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Dismisså®ç°"><a href="#Dismisså®ç°" class="headerlink" title="Dismisså®ç°"></a>Dismisså®ç°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (void)dismissAnimateTransition:(id&lt;UIViewControllerContextTransitioning&gt;)transitionContext</span><br><span class="line">&#123;</span><br><span class="line">    //dismissçš„æ—¶å€™ fromVCå’ŒtoVCèº«ä»½å€’è¿‡æ¥äº†</span><br><span class="line">    UIView * toView = [transitionContext viewForKey:UITransitionContextToViewKey];</span><br><span class="line">    UIView * fromView = [transitionContext viewForKey:UITransitionContextFromViewKey];</span><br><span class="line"></span><br><span class="line">    //containerViewé‡Œé¢çš„é¡ºåºä¹Ÿå€’è¿‡æ¥äº† æˆªå›¾åœ¨æœ€ä¸Šé¢</span><br><span class="line">    UIView * containerView = [transitionContext containerView];</span><br><span class="line">    UIView * tempView = [[containerView subviews] firstObject];</span><br><span class="line"></span><br><span class="line">    //åšè¿˜åŸåŠ¨ç”»å°±å¯ä»¥äº†</span><br><span class="line">    NSTimeInterval duration = [self transitionDuration:transitionContext];</span><br><span class="line"></span><br><span class="line">    [UIView animateWithDuration:duration delay:0 usingSpringWithDamping:0.55 initialSpringVelocity:1 options:0 animations:^&#123;</span><br><span class="line">        tempView.transform = CGAffineTransformIdentity;</span><br><span class="line">        fromView.transform = CGAffineTransformIdentity;</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        //è½¬åœºç»“æŸåä¸€å®šè¦æ ‡è®° å¦åˆ™ä¼šè®¤ä¸ºè¿˜åœ¨è½¬åœº æ— æ³•äº¤äº’</span><br><span class="line">        [transitionContext completeTransition:![transitionContext transitionWasCancelled]];</span><br><span class="line">        if (![transitionContext transitionWasCancelled])</span><br><span class="line">        &#123;</span><br><span class="line">            //è½¬åœºæˆåŠŸ</span><br><span class="line">            toView.hidden = NO;</span><br><span class="line">            [tempView removeFromSuperview];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="UIViewControllerTransitioningDelegateä»£ç†æ–¹æ³•"><a href="#UIViewControllerTransitioningDelegateä»£ç†æ–¹æ³•" class="headerlink" title="UIViewControllerTransitioningDelegateä»£ç†æ–¹æ³•"></a>UIViewControllerTransitioningDelegateä»£ç†æ–¹æ³•</h3><p>&ensp;&ensp;&ensp;&ensp;å›åˆ°<code>ViewController</code>ï¼ŒæŠŠ<code>ThirdVC</code>çš„<code>transitioningDelegate</code>è®¾ç½®ä¸ºè‡ªå·±,ç„¶ååœ¨ä»£ç†æ–¹æ³•ä¸­è‡ªå®šç±»å‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (IBAction)presentBtnClick:(id)sender</span><br><span class="line">&#123;</span><br><span class="line">    ThirdViewController * vc = [[ThirdViewController alloc] init];</span><br><span class="line">    vc.transitioningDelegate = self;</span><br><span class="line">    [self presentViewController:vc animated:YES completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Present &amp;&amp; Dismiss</span><br><span class="line">- (id &lt;UIViewControllerAnimatedTransitioning&gt;)animationControllerForPresentedController:(UIViewController *)presented presentingController:(UIViewController *)presenting sourceController:(UIViewController *)source</span><br><span class="line">&#123;</span><br><span class="line">    return [TransitionAnimationObject initWithTransitionAnimationObjectType:TransitionAnimationObjectType_present];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id &lt;UIViewControllerAnimatedTransitioning&gt;)animationControllerForDismissedController:(UIViewController *)dismissed</span><br><span class="line">&#123;</span><br><span class="line">    return [TransitionAnimationObject initWithTransitionAnimationObjectType:TransitionAnimationObjectType_Dismiss];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æ‰‹åŠ¿åŠ¨ç”»"><a href="#æ‰‹åŠ¿åŠ¨ç”»" class="headerlink" title="æ‰‹åŠ¿åŠ¨ç”»"></a>æ‰‹åŠ¿åŠ¨ç”»</h2><h3 id="UIPercentDrivenInteractiveTransitionåˆ›å»ºæ‰‹åŠ¿ç±»"><a href="#UIPercentDrivenInteractiveTransitionåˆ›å»ºæ‰‹åŠ¿ç±»" class="headerlink" title="UIPercentDrivenInteractiveTransitionåˆ›å»ºæ‰‹åŠ¿ç±»"></a>UIPercentDrivenInteractiveTransitionåˆ›å»ºæ‰‹åŠ¿ç±»</h3><p>&ensp;&ensp;&ensp;&ensp;æ–°å»ºä¸€ä¸ªæ‰‹åŠ¿ç±»<code>GestureObject</code>ç»§æ‰¿è‡ª<code>UIPercentDrivenInteractiveTransition</code>ï¼Œ<code>addGestureToViewController</code>æ˜¯ç»™ç›®æ ‡æ§åˆ¶å™¨æ·»åŠ æ‰‹åŠ¿ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface GestureObject : UIPercentDrivenInteractiveTransition</span><br><span class="line"></span><br><span class="line">//åˆ¤æ–­æ˜¯äº¤äº’çš„æ‰‹åŠ¿</span><br><span class="line">@property (nonatomic,assign) BOOL interacting;</span><br><span class="line"></span><br><span class="line">- (void)addGestureToViewController:(UIViewController *)viewController;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;ç„¶åå†æ‰‹åŠ¿çš„çŠ¶æ€ä¹‹é—´æ¥åˆ¤æ–­æ˜¯å¦æ‰§è¡ŒåŠ¨ç”»ï¼Œè¿™é‡Œæ˜¯åˆ¤æ–­æ‰‹åŠ¿åç§»é‡è¶…è¿‡å±å¹•ä¸€åŠçš„é«˜åº¦å°±ç”Ÿæ•ˆï¼Œæ‰§è¡Œç›¸å…³åŠ¨ç”»ï¼Œå¦åˆ™è¿˜åŸåŠ¨ç”»ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">- (void)handleGesture:(UIPanGestureRecognizer *)ges</span><br><span class="line">&#123;</span><br><span class="line">    CGPoint point = [ges translationInView:ges.view];</span><br><span class="line"></span><br><span class="line">    switch (ges.state) &#123;</span><br><span class="line">        case UIGestureRecognizerStateBegan:</span><br><span class="line">        &#123;</span><br><span class="line">            self.interacting = YES;</span><br><span class="line">            [self.targetVC dismissViewControllerAnimated:YES completion:nil];</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        case UIGestureRecognizerStateChanged:</span><br><span class="line">        &#123;</span><br><span class="line">            CGFloat fraction = point.y / ges.view.frame.size.height;</span><br><span class="line">            //é™åˆ¶åœ¨0å’Œ1ä¹‹é—´</span><br><span class="line">            fraction = MAX(0.0, MIN(fraction, 1.0));</span><br><span class="line">            self.shouldComplete = fraction &gt; 0.5;</span><br><span class="line">            [self updateInteractiveTransition:fraction];</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        case UIGestureRecognizerStateEnded:</span><br><span class="line">        case UIGestureRecognizerStateCancelled:</span><br><span class="line">        &#123;</span><br><span class="line">            self.interacting = NO;</span><br><span class="line">            if (!self.shouldComplete || ges.state == UIGestureRecognizerStateCancelled)</span><br><span class="line">            &#123;</span><br><span class="line">                //è¿˜åŸåŠ¨ç”»</span><br><span class="line">                [self cancelInteractiveTransition];</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                //å®ŒæˆåŠ¨ç”»</span><br><span class="line">                [self finishInteractiveTransition];</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="UIViewControllerTransitioningDelegateä»£ç†æ–¹æ³•-1"><a href="#UIViewControllerTransitioningDelegateä»£ç†æ–¹æ³•-1" class="headerlink" title="UIViewControllerTransitioningDelegateä»£ç†æ–¹æ³•"></a>UIViewControllerTransitioningDelegateä»£ç†æ–¹æ³•</h3><p>&ensp;&ensp;&ensp;&ensp;å›åˆ°<code>ViewController</code>ä¸­ï¼Œåœ¨<code>Present</code>å‡º<code>ThirdVC</code>çš„æ—¶å€™æ·»åŠ æ‰‹åŠ¿ï¼Œåœ¨ä»£ç†æ–¹æ³•<code>interactionControllerForDismissal</code>ä¸­æŒ‡å®šæ‰‹åŠ¿ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (IBAction)presentBtnClick:(id)sender</span><br><span class="line">&#123;</span><br><span class="line">    ThirdViewController * vc = [[ThirdViewController alloc] init];</span><br><span class="line">    vc.transitioningDelegate = self;</span><br><span class="line">    [self.gestureObject addGestureToViewController:vc];</span><br><span class="line">    [self presentViewController:vc animated:YES completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id &lt;UIViewControllerInteractiveTransitioning&gt;)interactionControllerForDismissal:(id&lt;UIViewControllerAnimatedTransitioning&gt;)animator</span><br><span class="line">&#123;</span><br><span class="line">    return self.gestureObject.interacting ? self.gestureObject : nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>çœ‹çœ‹æ•ˆæœ<br><img src="https://yuyiios-work.oss-cn-shanghai.aliyuncs.com/%E5%8D%9A%E5%AE%A2/TransitionAnimation%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB/Present%E5%92%8CDismiss%E6%95%88%E6%9E%9C.gif" alt="Presentå’ŒDismissæ•ˆæœ.gif"></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>&ensp;&ensp;&ensp;&ensp; <code>Push</code>ã€<code>Pop</code>ã€<code>Present</code>ã€<code>Dismiss</code>ã€æ‰‹åŠ¿åŠ¨ç”»éƒ½è®²è§£å®Œäº†ï¼Œå¯ä»¥çœ‹å‡ºï¼Œè‡ªå®šä¹‰è½¬åœºå¤§è‡´çš„æ­¥éª¤æ˜¯</p><ul><li><strong>æ ¹æ®<code>viewForKey</code>æ¥è·å–è½¬åœºä¸Šä¸‹æ–‡</strong></li><li><strong>å°†è¦è½¬åœºçš„è§†å›¾åŠ å…¥è½¬åœºå®¹å™¨ä¸­</strong></li><li><strong>åšå‡ºè½¬åœºåŠ¨ç”»</strong></li><li><strong>æ ‡è®°è½¬åœºæˆåŠŸçš„çŠ¶æ€ï¼Œæ ¹æ®çŠ¶æ€åšç›¸åº”çš„å¤„ç†</strong></li></ul><p>&ensp;&ensp;&ensp;&ensp;ç†è§£äº†è¿™äº›ï¼Œå†å¤æ‚çš„è½¬åœºåŠ¨ç”»éƒ½èƒ½ä¸€æ­¥æ­¥åˆ†è§£å‡ºæ¥ï¼Œä¸‹é¢æ˜¯æ ¼ç“¦æ‹‰Appçš„è½¬åœºæ•ˆæœï¼Œç¬¬ä¸€æ¬¡çœ‹çš„æ—¶å€™ï¼Œè§‰å¾—å¾ˆé…·ç‚«ï¼Œç°åœ¨äº†è§£äº†è½¬åœºçš„æ ¸å¿ƒåï¼Œè§‰å¾—ä¸é‚£ä¹ˆéš¾äº†ï¼Œæœ‰æ—¶é—´å†æŠŠå®ƒçš„æ•ˆæœå†™å‡ºæ¥å§ã€‚<br><img src="https://yuyiios-work.oss-cn-shanghai.aliyuncs.com/%E5%8D%9A%E5%AE%A2/TransitionAnimation%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB/%E6%A0%BC%E7%93%A6%E6%8B%89%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB.gif" alt="æ ¼ç“¦æ‹‰è½¬åœºåŠ¨ç”».gif"></p><p><a href="https://github.com/iOS-Misaki/TransitionAnimation"><strong>æºç ï¼šTransitionAnimation</strong></a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;åœ¨&lt;code&gt;iOS 7&lt;/code&gt;ä¹‹åï¼Œè‹¹æœå°±å¼€æ”¾äº†è‡ªå®šä¹‰è½¬åœºçš„ç›¸å…³&lt;code&gt;api&lt;/code&gt;ï¼Œç°åœ¨éƒ½å¿«&lt;code&gt;iOS 12&lt;/code&gt;äº†ï¼Œä¸€ç›´éƒ½æ²¡æœ‰å¥½å¥½ç ”ç©¶è½¬åœºåŠ¨ç”»ï¼Œä¸€ä¸ªæ˜¯ä¹‹å‰æ²¡æœ‰é‡è§†ï¼Œè§‰å¾—èŠ±é‡Œèƒ¡å“¨çš„ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æ‰€åšçš„é¡¹ç›®ä¸­æ²¡æœ‰è¿™æ ·çš„è½¬åœºåŠ¨ç”»éœ€æ±‚ã€‚è¿™é‡Œè¯´çš„è½¬åœºåŠ¨ç”»å’Œä¸Šä¸€ç¯‡&lt;a href=&quot;https://ios-misaki.github.io/iOS-Misaki.github.io/2018/07/26/CAAnimation%20%E7%B3%BB%E5%88%97%E5%8A%A8%E7%94%BB/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CAAnimation ç³»ç»ŸåŠ¨ç”»&lt;/a&gt;ä¸­&lt;code&gt;CATransition&lt;/code&gt;åŠ¨ç”»ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œä¸Šä¸€ç¯‡æŒ‡çš„æ˜¯å•ä¸ªViewçš„è½¬åœºç‰¹æ•ˆï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯æ•´ä¸ªæ§åˆ¶å™¨çš„è½¬åœºç‰¹æ•ˆã€‚å…¶å®å†™ä¸Šç¯‡æ–‡ç« çš„ç›®å‰ä¹Ÿæ˜¯ä¸ºä»Šå¤©æ‰“ä¸‹é“ºå«ï¼Œå¤æ‚çš„è½¬åœºæ•ˆæœä¹Ÿæ˜¯ç”±å•ä¸ªåŠ¨ç”»æ¥ç»„æˆçš„ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CAAnimation ç³»åˆ—åŠ¨ç”»</title>
    <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/07/26/CAAnimation%20%E7%B3%BB%E5%88%97%E5%8A%A8%E7%94%BB/"/>
    <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/07/26/CAAnimation ç³»åˆ—åŠ¨ç”»/</id>
    <published>2018-07-26T02:20:39.000Z</published>
    <updated>2018-07-26T14:58:08.355Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;&ensp;&ensp;æœ‰äººé—®æˆ‘ä¸ºä»€ä¹ˆè¦å†™åšå®¢ï¼Œå¿…é¡»è¦æ‰¿è®¤ï¼Œç°åœ¨ç½‘ä¸Šä¸€å¤§æ¨çš„ä¼˜ç§€æ•™ç¨‹å’Œç°æˆçš„Demoï¼Œè‡ªå·±å†™çš„æ²¡æœ‰åˆ«äººå¥½ï¼Œæœ‰äº›åœ°æ–¹æ ¹æœ¬ä¸å¤Ÿæ·±å…¥ï¼Œä½†æ˜¯çœ‹åˆ«äººå†™æ–‡ç« ã€å†™ä»£ç å’Œè‡ªå·±å†™å®Œå…¨æ˜¯ä¸¤ä»¶äº‹ï¼Œä»£ç çœ‹çœ‹å°±èƒ½æ‡‚ï¼Œä½†æ˜¯è‡ªå·±è¿‡ä¸€éï¼Œå°è±¡æ›´æ·±ï¼Œæ¶ˆåŒ–çš„ä¹Ÿå°±æ›´å½»åº•ã€‚å¯¹äºiOSåŠ¨ç”» ï¼Œä¸€ç›´éƒ½æ²¡æœ‰ç³»ç»ŸåŒ–çš„å­¦ä¹ ï¼Œåªæœ‰ç”¨çš„æ—¶å€™æ‰ä¼šæŸ¥æŸ¥apiï¼Œä¹‹å‰å†™è¿‡ä¸€ç¯‡<a href="https://www.jianshu.com/p/92ac22afeeef" target="_blank" rel="noopener">çº¢åŒ…é›¨</a>çš„æ–‡ç« ï¼Œç”¨çš„æ˜¯å…³é”®å¸§åŠ¨ç”»ï¼Œæ²¡æœ‰åœ¨ç»§ç»­ä¸‹å»ã€‚å¦ä¸€ä¸ªå°±æ˜¯åœ¨6æœˆä»½é¢è¯•çš„æ—¶å€™ï¼Œæœ‰ä¸¤ä¸ªé¢è¯•å®˜éƒ½é—®åˆ°äº†åŸºç¡€åŠ¨ç”»ï¼Œå½“æ—¶ä¹Ÿå›ç­”çš„ä¸å¥½ï¼Œç°åœ¨è¯¦ç»†åœ°æ¢³ç†ä¸€éã€‚ç°é˜¶æ®µï¼Œå…ˆæŠŠ<code>Core Animation</code>å¼„æ¸…æ¥šï¼Œä»¥åå†ä¸‹æ²‰åˆ°<code>OpenGL</code>å’Œ<code>CoreGraphics</code>ã€‚</p><a id="more"></a><h2 id="CAAnimationç»§æ‰¿å…³ç³»"><a href="#CAAnimationç»§æ‰¿å…³ç³»" class="headerlink" title="CAAnimationç»§æ‰¿å…³ç³»"></a>CAAnimationç»§æ‰¿å…³ç³»</h2><p>&ensp;&ensp;&ensp;&ensp;å¼•ç”¨å®˜æ–¹æ–‡æ¡£ï¼š</p><blockquote><p>Core Animation provides high frame rates and smooth animations without burdening the CPU and slowing down your app. Most of the work required to draw each frame of an animation is done for you. You configure animation parameters such as the start and end points, and Core Animation does the rest, handing off most of the work to dedicated graphics hardware, to accelerate rendering. For more details, see <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40004514" target="_blank" rel="noopener">Core Animation Programming Guide</a>.</p></blockquote><p>&ensp;&ensp;&ensp;&ensp;<code>Core Animation</code>æä¾›äº†é«˜å¸§ç‡å’Œæµç•…çš„åŠ¨ç”»ï¼Œè€Œä¸ä¼šåŠ é‡CPUè´Ÿæ‹…ï¼Œä¹Ÿä¸ä¼šå‡æ…¢åº”ç”¨ç¨‹åºçš„é€Ÿåº¦ã€‚ä½ å¯ä»¥é…ç½®åŠ¨ç”»å‚æ•°ï¼Œå¦‚èµ·å§‹ç‚¹å’Œç»“æŸç‚¹ï¼Œ<code>Core animation</code>å®Œæˆå…¶ä½™éƒ¨åˆ†ï¼Œå°†å¤§éƒ¨åˆ†å·¥ä½œäº¤ç»™ä¸“ç”¨çš„å›¾å½¢ç¡¬ä»¶ï¼Œä»¥åŠ é€Ÿæ¸²æŸ“ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/1487718-98d399ad7b624a91.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="CAAnimationç±»å›¾.jpg"></p><p>&ensp;&ensp;&ensp;&ensp;å¯¹äº<code>CAAnimation</code>,æ˜¯æ ¸å¿ƒåŠ¨ç”»åŸºç¡€ç±»ï¼Œä¸ç›´æ¥ä½¿ç”¨ï¼Œä¸€èˆ¬ç”¨å®ƒçš„å­ç±»ã€‚<code>CAAnimation</code>æœ‰ä¸‰ä¸ªå­ç±»<code>CAPropertyAnimationã€CATransitionã€CAAnimationGroup</code>ã€‚ç¬¬äºŒä¸ª<code>CATransition</code>æ˜¯è½¬åœºåŠ¨ç”»ï¼Œç¬¬ä¸‰ä¸ª<code>CAAnimationGroup</code>æ˜¯åŠ¨ç”»ç»„ã€‚ç¬¬ä¸€ä¸ª<code>CAPropertyAnimation</code>åˆåˆ†ä¸ºä¸¤ä¸ªå­ç±»<code>CABasicAnimationã€CAKeyframeAnimation</code>ã€‚<code>CAKeyframeAnimation</code>æ˜¯å…³é”®å¸§åŠ¨ç”»ã€‚<code>CABasicAnimation</code>ä¸‹é¢è¿˜æœ‰ä¸ªå­ç±»<code>CASpringAnimation</code>æ˜¯å¼¹ç°§åŠ¨ç”»ã€‚</p><p>&ensp;&ensp;&ensp;&ensp;<code>CAPropertyAnimation</code>é€šè¿‡<code>animationWithKeyPath</code>æ¥åˆ›å»ºåŠ¨ç”»ï¼Œå¯ä»¥çœ‹çœ‹æœ‰å“ªäº›å±æ€§å¯ä»¥åˆ›å»ºåŠ¨ç”»ã€‚è¯¦è§<a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/AnimatableProperties/AnimatableProperties.html#//apple_ref/doc/uid/TP40004514-CH11-SW2" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">anchorPoint</span><br><span class="line">backgroundColor</span><br><span class="line">backgroundFilters</span><br><span class="line">borderColor</span><br><span class="line">borderWidth</span><br><span class="line">bounds</span><br><span class="line">compositingFilter</span><br><span class="line">contents</span><br><span class="line">contentsRect</span><br><span class="line">cornerRadius</span><br><span class="line">doubleSided</span><br><span class="line">filters</span><br><span class="line">frame</span><br><span class="line">hidden</span><br><span class="line">mask</span><br><span class="line">masksToBounds</span><br><span class="line">opacity</span><br><span class="line">position</span><br><span class="line">shadowColor</span><br><span class="line">shadowOffset</span><br><span class="line">shadowOpacity</span><br><span class="line">shadowPath</span><br><span class="line">shadowRadius</span><br><span class="line">sublayers</span><br><span class="line">sublayerTransform</span><br><span class="line">transform</span><br><span class="line">zPosition</span><br></pre></td></tr></table></figure><hr><h2 id="CAKeyframeAnimation-å…³é”®å¸§åŠ¨ç”»"><a href="#CAKeyframeAnimation-å…³é”®å¸§åŠ¨ç”»" class="headerlink" title="CAKeyframeAnimation å…³é”®å¸§åŠ¨ç”»"></a>CAKeyframeAnimation å…³é”®å¸§åŠ¨ç”»</h2><p>&ensp;&ensp;&ensp;&ensp;å¯ä»¥ä½¿ç”¨ç»§æ‰¿çš„<code>animationWithKeyPath:</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ª<code>CAKeyframeAnimation</code>å¯¹è±¡ï¼Œå¹¶æŒ‡å®šè¦åœ¨å±‚ä¸ŠåŠ¨ç”»çš„å±æ€§çš„å…³é”®è·¯å¾„ã€‚ç„¶åå¯ä»¥æŒ‡å®šç”¨äºæ§åˆ¶æ—¶é—´å’ŒåŠ¨ç”»è¡Œä¸ºçš„å…³é”®å¸§å€¼ã€‚å¯¹äºå¤§å¤šæ•°åŠ¨ç”»ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å€¼å’Œ<code>keyTimes</code>å±æ€§æŒ‡å®šå…³é”®å¸§å€¼ã€‚åœ¨åŠ¨ç”»æœŸé—´ï¼Œ<code>Core animation</code>é€šè¿‡åœ¨æ‚¨æä¾›çš„å€¼ä¹‹é—´æ’å…¥æ¥ç”Ÿæˆä¸­é—´å€¼ã€‚å½“åŠ¨ç”»ä¸€ä¸ªåæ ‡ç‚¹(ä¾‹å¦‚layerçš„ä½ç½®)çš„å€¼æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šè¯¥ç‚¹çš„è·¯å¾„ï¼Œè€Œä¸æ˜¯å•ç‹¬çš„å€¼ã€‚åŠ¨ç”»çš„èŠ‚å¥ç”±ä½ æä¾›çš„æ—¶é—´ä¿¡æ¯æ§åˆ¶ã€‚</p><h3 id="é‡è¦å±æ€§"><a href="#é‡è¦å±æ€§" class="headerlink" title="é‡è¦å±æ€§"></a>é‡è¦å±æ€§</h3><table><thead><tr><th>å±æ€§</th><th style="text-align:center">æè¿° </th></tr></thead><tbody><tr><td>values</td><td style="text-align:center">ç”¨æ¥å­˜æ”¾å…³é”®å¸§çš„æ•°ç»„</td></tr><tr><td>path</td><td style="text-align:center">åŸºäºç‚¹çš„å±æ€§çš„è·¯å¾„ã€‚</td></tr><tr><td>keyTimes</td><td style="text-align:center">å¯¹åº”å…³é”®å¸§æ®µçš„æ—¶é—´ç‚¹çš„NSNumberæ•°ç»„</td></tr><tr><td>timingFunctions</td><td style="text-align:center">å…³é”®å¸§åŠ¨ç”»èŠ‚å¥çš„æ•°ç»„ï¼Œæ¯”å¦‚å¿«è¿›æ…¢å‡ºã€æ…¢è¿›å¿«å‡ºç­‰</td></tr><tr><td>calculationMode</td><td style="text-align:center">ç¡®å®šæ²¿è·¯å¾„åŠ¨ç”»çš„å¯¹è±¡æ˜¯å¦æ—‹è½¬ä»¥åŒ¹é…è·¯å¾„åˆ‡çº¿</td></tr><tr><td>tensionValues</td><td style="text-align:center">å®šä¹‰æ›²çº¿çš„ç´§å¯†æ€§çš„NSNumberæ•°ç»„</td></tr><tr><td>continuityValues</td><td style="text-align:center">å®šä¹‰æ—¶é—´æ›²çº¿é”è§’çš„NSNumberæ•°ç»„</td></tr><tr><td>biasValues</td><td style="text-align:center">å®šä¹‰æ›²çº¿ç›¸å¯¹äºæ§åˆ¶ç‚¹çš„ä½ç½®çš„NSNumberæ•°ç»„</td></tr><tr><td>Rotation Mode Values</td><td style="text-align:center">rotationModeå±æ€§ä½¿ç”¨è¿™äº›å¸¸é‡</td></tr><tr><td>Value calculation modes</td><td style="text-align:center">calculationModeå±æ€§ä½¿ç”¨è¿™äº›å¸¸é‡</td></tr></tbody></table><h3 id="æ•ˆæœä»£ç "><a href="#æ•ˆæœä»£ç " class="headerlink" title="æ•ˆæœä»£ç "></a>æ•ˆæœä»£ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - æŒ‡å®škeyPathä¸ºpositionï¼Œé€šè¿‡Valuesæ¥åˆ›å»ºå…³é”®å¸§åŠ¨ç”»</span><br><span class="line">- (void)CAKeyframeAnimationWithValues</span><br><span class="line">&#123;</span><br><span class="line">    CGFloat margin = 50.f;</span><br><span class="line"></span><br><span class="line">    CAKeyframeAnimation * animation = [CAKeyframeAnimation animation];</span><br><span class="line">    animation.keyPath = @&quot;position&quot;;</span><br><span class="line">    NSValue * value0 = [NSValue valueWithCGPoint:CGPointMake(margin, margin)];</span><br><span class="line">    NSValue * value1 = [NSValue valueWithCGPoint:CGPointMake(margin, SCREENHEIGHT - margin)];</span><br><span class="line">    NSValue * value2 = [NSValue valueWithCGPoint:CGPointMake(SCREENWIDTH - margin, SCREENHEIGHT - margin)];</span><br><span class="line">    NSValue * value3 = [NSValue valueWithCGPoint:CGPointMake(SCREENWIDTH - margin, margin)];</span><br><span class="line">    NSValue * value4 = [NSValue valueWithCGPoint:CGPointMake(margin, margin)];</span><br><span class="line">    animation.values = @[value0,value1,value2,value3,value4];</span><br><span class="line"></span><br><span class="line">    //å½“æˆ‘ä»¬åŠ¨ç”»å®Œæˆæ—¶,å¦‚æœå¸Œæœ›åŠ¨ç”»å°±è‡ªåŠ¨ç§»é™¤çš„è¯,æˆ‘ä»¬å¯ä»¥è®¾ç½®æ­¤å±æ€§ä¸ºYES,é»˜è®¤å€¼ä¸ºYES</span><br><span class="line">    animation.fillMode = kCAFillModeForwards;</span><br><span class="line">    animation.removedOnCompletion = NO;</span><br><span class="line">    animation.duration = 4;</span><br><span class="line">    animation.repeatCount = MAXFLOAT;</span><br><span class="line">    //å¿«å…¥å¿«å‡º</span><br><span class="line">    animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</span><br><span class="line">    [self.pointView.layer addAnimation:animation forKey:@&quot;position.values&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æŒ‡å®škeyPathä¸ºpositionï¼Œé€šè¿‡pathè·¯å¾„æ¥åˆ›å»ºå…³é”®å¸§åŠ¨ç”»</span><br><span class="line">- (void)CAKeyframeAnimationWithPath</span><br><span class="line">&#123;</span><br><span class="line">    CGFloat margin = 50.f;</span><br><span class="line"></span><br><span class="line">    CAKeyframeAnimation * animation = [CAKeyframeAnimation animation];</span><br><span class="line">    animation.keyPath = @&quot;position&quot;;</span><br><span class="line"></span><br><span class="line">    CGMutablePathRef path = CGPathCreateMutable();</span><br><span class="line">    CGPathAddRect(path, NULL, CGRectMake(margin, margin, SCREENWIDTH - margin * 2, SCREENHEIGHT - margin * 2));</span><br><span class="line">    animation.path = path;</span><br><span class="line">    CGPathRelease(path);</span><br><span class="line"></span><br><span class="line">    animation.fillMode = kCAFillModeForwards;</span><br><span class="line">    animation.removedOnCompletion = NO;</span><br><span class="line">    animation.duration = 4;</span><br><span class="line">    animation.repeatCount = MAXFLOAT;</span><br><span class="line">    NSMutableArray * timingFunctionArray = [NSMutableArray new];</span><br><span class="line">    for (NSInteger i = 0 ; i &lt; 5 ; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        //æ¯ä¸€æ®µéƒ½æ˜¯å¿«å‡ºæ•ˆæœ</span><br><span class="line">        CAMediaTimingFunction * timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseOut];</span><br><span class="line">        [timingFunctionArray addObject:timingFunction];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    animation.timingFunctions = timingFunctionArray;</span><br><span class="line">    [self.pointView.layer addAnimation:animation forKey:@&quot;position.path&quot;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><p><img src="https://upload-images.jianshu.io/upload_images/1487718-9916176ef3035803.gif?imageMogr2/auto-orient/strip" alt="CAKeyframeAnimation.gif"></p><p>&ensp;&ensp;&ensp;&ensp;éœ€è¦æ³¨æ„çš„æ˜¯removedOnCompletionè®¾ç½®ä¸ºNOçš„æ—¶å€™ï¼Œä¸éœ€è¦layerçš„æ—¶å€™è¦æ ¹æ®keyæ‰‹åŠ¨ç§»é™¤åŠ¨ç”»ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[self.pointView.layer removeAnimationForKey:@&quot;position.values&quot;];</span><br><span class="line">[self.pointView.layer removeAnimationForKey:@&quot;position.path&quot;];</span><br></pre></td></tr></table></figure></p><hr><h2 id="CATransition-è½¬åœºåŠ¨ç”»"><a href="#CATransition-è½¬åœºåŠ¨ç”»" class="headerlink" title="CATransition è½¬åœºåŠ¨ç”»"></a>CATransition è½¬åœºåŠ¨ç”»</h2><p>&ensp;&ensp;&ensp;&ensp;<code>CATransition</code>çš„çˆ¶ç±»æ˜¯<code>CAAnimation</code>ï¼Œå’Œ<code>CAPropertyAnimation</code>ã€<code>CAAnimationGroup</code>åŒçº§ã€‚<code>CATransition</code>æ˜¯ç”¨æ¥è§†å›¾çš„è½¬åœºåŠ¨ç”»ã€‚</p><blockquote><p>You can transition between a layerâ€™s states by creating and adding a <a href="apple-reference-documentation://hckyNQAwLg" target="_blank" rel="noopener">CATransition</a> object to it. The default transition is a cross fade, but you can specify different effects from a set of predefined transitions.</p></blockquote><h3 id="é‡è¦å±æ€§-1"><a href="#é‡è¦å±æ€§-1" class="headerlink" title="é‡è¦å±æ€§"></a>é‡è¦å±æ€§</h3><table><thead><tr><th>å±æ€§</th><th style="text-align:center">æè¿° </th></tr></thead><tbody><tr><td>startProgress</td><td style="text-align:center">æ•´ä¸ªå˜å½¢æ¥æ”¶çš„èµ·ç‚¹</td></tr><tr><td>endProgress</td><td style="text-align:center">æ•´ä¸ªå˜å½¢æ¥æ”¶çš„ç»ˆç‚¹</td></tr><tr><td>type</td><td style="text-align:center">æŒ‡å®šè½¬æ¢ç±»å‹</td></tr><tr><td>subtype</td><td style="text-align:center">è½¬æ¢æ–¹å‘çš„å­ç±»å‹</td></tr><tr><td>filter</td><td style="text-align:center">æä¾›è½¬æ¢çš„å›¾åƒè¿‡æ»¤å™¨å¯¹è±¡</td></tr><tr><td>Common Transition Types</td><td style="text-align:center">æŒ‡å®šå¯ä»¥ä¸typeå±æ€§ä¸€èµ·ä½¿ç”¨çš„è½¬æ¢ç±»å‹çš„å¸¸é‡</td></tr><tr><td>Common Transition Subtypes</td><td style="text-align:center">æŒ‡å®šå¯ä»¥ä¸subtypeå±æ€§ä¸€èµ·ä½¿ç”¨çš„è½¬æ¢ç±»å‹çš„å¸¸é‡</td></tr></tbody></table><h3 id="æ•ˆæœä»£ç -1"><a href="#æ•ˆæœä»£ç -1" class="headerlink" title="æ•ˆæœä»£ç "></a>æ•ˆæœä»£ç </h3><p>&ensp;&ensp;&ensp;&ensp;å…¶ä¸­<code>type</code>å’Œ<code>subtype</code>æœ‰å®˜æ–¹æŒ‡å®šçš„ç±»å‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/* Common transition types. */</span><br><span class="line"></span><br><span class="line">CA_EXTERN NSString * const kCATransitionFade</span><br><span class="line">CA_AVAILABLE_STARTING (10.5, 2.0, 9.0, 2.0);</span><br><span class="line">CA_EXTERN NSString * const kCATransitionMoveIn</span><br><span class="line">CA_AVAILABLE_STARTING (10.5, 2.0, 9.0, 2.0);</span><br><span class="line">CA_EXTERN NSString * const kCATransitionPush</span><br><span class="line">CA_AVAILABLE_STARTING (10.5, 2.0, 9.0, 2.0);</span><br><span class="line">CA_EXTERN NSString * const kCATransitionReveal</span><br><span class="line">CA_AVAILABLE_STARTING (10.5, 2.0, 9.0, 2.0);</span><br><span class="line"></span><br><span class="line">/* Common transition subtypes. */</span><br><span class="line"></span><br><span class="line">CA_EXTERN NSString * const kCATransitionFromRight</span><br><span class="line">CA_AVAILABLE_STARTING (10.5, 2.0, 9.0, 2.0);</span><br><span class="line">CA_EXTERN NSString * const kCATransitionFromLeft</span><br><span class="line">CA_AVAILABLE_STARTING (10.5, 2.0, 9.0, 2.0);</span><br><span class="line">CA_EXTERN NSString * const kCATransitionFromTop</span><br><span class="line">CA_AVAILABLE_STARTING (10.5, 2.0, 9.0, 2.0);</span><br><span class="line">CA_EXTERN NSString * const kCATransitionFromBottom</span><br><span class="line">CA_AVAILABLE_STARTING (10.5, 2.0, 9.0, 2.0);</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;è¿˜æœ‰å‡ ç§æ•ˆæœæ˜¯ç§æœ‰APIï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾ä¸åˆ°ï¼Œ<strong>æ…ç”¨</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Cube,                     //ç«‹ä½“</span><br><span class="line">SuckEffect,               //å®å¸</span><br><span class="line">OglFlip,                  //ç¿»è½¬</span><br><span class="line">RippleEffect,             //æ³¢çº¹</span><br><span class="line">PageCurl,                 //ç¿»é¡µ</span><br><span class="line">PageUnCurl,               //åç¿»é¡µ</span><br><span class="line">CameraIrisHollowOpen,     //å¼€é•œå¤´</span><br><span class="line">CameraIrisHollowClose,    //å…³é•œå¤´</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;è¿™é‡Œå†™äº†ä¸€ä¸ªä¾‹å­ï¼Œæœ‰12ç§<code>type</code>è½¬åœºæ•ˆæœå’Œ4ç§<code>subtype</code>è½¬åœºæ–¹å‘ï¼Œç”¨æšä¸¾æ¥å°è£…ä¸€ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger,CATransactionType) &#123;</span><br><span class="line">    CATransactionType_Fade = 0,                 //é»˜è®¤</span><br><span class="line">    CATransactionType_MoveIn,                   //è¦†ç›–</span><br><span class="line">    CATransactionType_Push,                     //æ¨å…¥</span><br><span class="line">    CATransactionType_Reveal,                   //æ­å¼€</span><br><span class="line"></span><br><span class="line">    CATransactionType_Cube,                     //ç«‹ä½“</span><br><span class="line">    CATransactionType_SuckEffect,               //å®å¸</span><br><span class="line">    CATransactionType_OglFlip,                  //ç¿»è½¬</span><br><span class="line">    CATransactionType_RippleEffect,             //æ³¢çº¹</span><br><span class="line">    CATransactionType_PageCurl,                 //ç¿»é¡µ</span><br><span class="line">    CATransactionType_PageUnCurl,               //åç¿»é¡µ</span><br><span class="line">    CATransactionType_CameraIrisHollowOpen,     //å¼€é•œå¤´</span><br><span class="line">    CATransactionType_CameraIrisHollowClose,    //å…³é•œå¤´</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">- (void)CATransitionWithType:(NSString *)type WithSubtype:(NSString *)subtype</span><br><span class="line">&#123;</span><br><span class="line">    CATransition * animation = [CATransition animation];</span><br><span class="line">    animation.duration = 2.f;</span><br><span class="line">    animation.type = type;</span><br><span class="line">    animation.subtype = subtype;</span><br><span class="line">    animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</span><br><span class="line">    [self.view.layer addAnimation:animation forKey:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)btnClick:(UIButton *)sender</span><br><span class="line">&#123;</span><br><span class="line">    UIButton * lastBtn;</span><br><span class="line">    NSInteger index = sender.tag - 100;</span><br><span class="line">    if (index &gt; 11)</span><br><span class="line">    &#123;</span><br><span class="line">        lastBtn = (UIButton *)[self.view viewWithTag:_subtype + 100];</span><br><span class="line">        [lastBtn setBackgroundImage:[self createImageWithColor:self.subtypeNormalColor] forState:UIControlStateNormal];</span><br><span class="line">        [sender setBackgroundImage:[self createImageWithColor:self.subtypeSelectedColor] forState:UIControlStateNormal];</span><br><span class="line">        _subtype = index;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        lastBtn = (UIButton *)[self.view viewWithTag:_transactionType + 100];</span><br><span class="line">        [lastBtn setBackgroundImage:[self createImageWithColor:self.typeNormalColor] forState:UIControlStateNormal];</span><br><span class="line">        [sender setBackgroundImage:[self createImageWithColor:self.typeSelectedColor] forState:UIControlStateNormal];</span><br><span class="line">        _transactionType = index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    NSString * subtypeString ;</span><br><span class="line"></span><br><span class="line">    switch (_subtype % 4) &#123;</span><br><span class="line">        case 0:</span><br><span class="line">            subtypeString = kCATransitionFromTop;</span><br><span class="line">            break;</span><br><span class="line">        case 1:</span><br><span class="line">            subtypeString = kCATransitionFromBottom;</span><br><span class="line">            break;</span><br><span class="line">        case 2:</span><br><span class="line">            subtypeString = kCATransitionFromLeft;</span><br><span class="line">            break;</span><br><span class="line">        case 3:</span><br><span class="line">            subtypeString = kCATransitionFromRight;</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    switch (_transactionType) &#123;</span><br><span class="line">        case CATransactionType_Fade:</span><br><span class="line">            [self CATransitionWithType:kCATransitionFade WithSubtype:subtypeString];</span><br><span class="line">            break;</span><br><span class="line">        case CATransactionType_MoveIn:</span><br><span class="line">            [self CATransitionWithType:kCATransitionMoveIn WithSubtype:subtypeString];</span><br><span class="line">            break;</span><br><span class="line">        case CATransactionType_Push:</span><br><span class="line">            [self CATransitionWithType:kCATransitionPush WithSubtype:subtypeString];</span><br><span class="line">            break;</span><br><span class="line">        case CATransactionType_Reveal:</span><br><span class="line">            [self CATransitionWithType:kCATransitionReveal WithSubtype:subtypeString];</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        case CATransactionType_Cube:</span><br><span class="line">            [self CATransitionWithType:@&quot;cube&quot; WithSubtype:subtypeString];</span><br><span class="line">            break;</span><br><span class="line">        case CATransactionType_SuckEffect:</span><br><span class="line">            [self CATransitionWithType:@&quot;suckEffect&quot; WithSubtype:subtypeString];</span><br><span class="line">            break;</span><br><span class="line">        case CATransactionType_OglFlip:</span><br><span class="line">            [self CATransitionWithType:@&quot;oglFlip&quot; WithSubtype:subtypeString];</span><br><span class="line">            break;</span><br><span class="line">        case CATransactionType_RippleEffect:</span><br><span class="line">            [self CATransitionWithType:@&quot;rippleEffect&quot; WithSubtype:subtypeString];</span><br><span class="line">            break;</span><br><span class="line">        case CATransactionType_PageCurl:</span><br><span class="line">            [self CATransitionWithType:@&quot;pageCurl&quot; WithSubtype:subtypeString];</span><br><span class="line">            break;</span><br><span class="line">        case CATransactionType_PageUnCurl:</span><br><span class="line">            [self CATransitionWithType:@&quot;pageUnCurl&quot; WithSubtype:subtypeString];</span><br><span class="line">            break;</span><br><span class="line">        case CATransactionType_CameraIrisHollowOpen:</span><br><span class="line">            [self CATransitionWithType:@&quot;cameraIrisHollowOpen&quot; WithSubtype:subtypeString];</span><br><span class="line">            break;</span><br><span class="line">        case CATransactionType_CameraIrisHollowClose:</span><br><span class="line">            [self CATransitionWithType:@&quot;cameraIrisHollowClose&quot; WithSubtype:subtypeString];</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static NSInteger i = 0;</span><br><span class="line">    self.bgView.image = i % 2 ? [UIImage imageNamed:@&quot;æ‹‰å§†.jpeg&quot;] :[UIImage imageNamed:@&quot;è•¾å§†.jpeg&quot;];</span><br><span class="line">    i ++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ•ˆæœå›¾-1"><a href="#æ•ˆæœå›¾-1" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><p><img src="https://upload-images.jianshu.io/upload_images/1487718-1a8800f104907166.gif?imageMogr2/auto-orient/strip" alt="CATransition1.gif"><br><img src="https://upload-images.jianshu.io/upload_images/1487718-1da95c682f270d71.gif?imageMogr2/auto-orient/strip" alt="CATransition2.gif"></p><hr><h2 id="CAAnimationGroup-åŠ¨ç”»ç»„"><a href="#CAAnimationGroup-åŠ¨ç”»ç»„" class="headerlink" title="CAAnimationGroup åŠ¨ç”»ç»„"></a>CAAnimationGroup åŠ¨ç”»ç»„</h2><p>&ensp;&ensp;&ensp;&ensp;åˆ†ç»„åŠ¨ç”»åœ¨<code>CAAnimationGroup</code>å®ä¾‹æŒ‡å®šçš„æ—¶é—´ä¸­è¿è¡Œã€‚åˆ†ç»„åŠ¨ç”»çš„æŒç»­æ—¶é—´ä¸ä¼šè¢«ç¼©æ”¾åˆ°ä»–ä»¬çš„<code>CAAnimationGroup</code>çš„æŒç»­æ—¶é—´ã€‚ç›¸åï¼ŒåŠ¨ç”»è¢«å‰ªåˆ‡åˆ°åŠ¨ç”»ç»„çš„æŒç»­æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåŠ¨ç”»ç»„ä¸­åˆ†ç»„çš„10ç§’åŠ¨ç”»ï¼ŒæŒç»­æ—¶é—´ä¸º5ç§’ï¼Œåªæ˜¾ç¤ºåŠ¨ç”»çš„å‰5ç§’ã€‚</p><h3 id="æ•ˆæœä»£ç -2"><a href="#æ•ˆæœä»£ç -2" class="headerlink" title="æ•ˆæœä»£ç "></a>æ•ˆæœä»£ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - ä¸€ä¸ªçº¢åŒ…é›¨çš„ä¾‹å­</span><br><span class="line">- (void)showRain</span><br><span class="line">&#123;</span><br><span class="line">    UIImageView * imageV = [UIImageView new];</span><br><span class="line">    imageV.image = [UIImage imageNamed:@&quot;page&quot;];</span><br><span class="line">    imageV.frame = CGRectMake(0, 0, 50 , 50 );</span><br><span class="line"></span><br><span class="line">    CALayer * layer = [CALayer layer];</span><br><span class="line">    layer.bounds = imageV.frame;</span><br><span class="line">    layer.contents = (id)imageV.image.CGImage;</span><br><span class="line">    layer.anchorPoint = CGPointMake(0, 0);</span><br><span class="line">    layer.position = CGPointMake(0, 0);</span><br><span class="line">    [self.view.layer addSublayer:layer];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    [self addAnimationWithLayer:layer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)addAnimationWithLayer:(CALayer *)layer</span><br><span class="line">&#123;</span><br><span class="line">    int height = [UIScreen mainScreen].bounds.size.height;</span><br><span class="line">    int width = [UIScreen mainScreen].bounds.size.height;</span><br><span class="line"></span><br><span class="line">    CAKeyframeAnimation * moveAnimation = [CAKeyframeAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">    NSValue * A = [NSValue valueWithCGPoint:CGPointMake(arc4random() % width, 0)];</span><br><span class="line">    NSValue * B = [NSValue valueWithCGPoint:CGPointMake(arc4random() % width, height + 100)];</span><br><span class="line">    moveAnimation.values = @[A,B];</span><br><span class="line">    moveAnimation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionLinear];</span><br><span class="line"></span><br><span class="line">    CAKeyframeAnimation * tranAnimation = [CAKeyframeAnimation animationWithKeyPath:@&quot;transform&quot;];</span><br><span class="line">    CATransform3D r0 = CATransform3DMakeRotation(M_PI/180 * (arc4random() % 360 ) , 0, 0, -1);</span><br><span class="line">    CATransform3D r1 = CATransform3DMakeRotation(M_PI/180 * (arc4random() % 360 ) , 0, 0, -1);</span><br><span class="line">    tranAnimation.values = @[[NSValue valueWithCATransform3D:r0],[NSValue valueWithCATransform3D:r1]];</span><br><span class="line">    tranAnimation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</span><br><span class="line"></span><br><span class="line">    CAAnimationGroup * group = [[CAAnimationGroup alloc] init];</span><br><span class="line">    group.duration = arc4random() % 200 / 100.0 + 3.5;</span><br><span class="line">    group.fillMode = kCAFillModeForwards;</span><br><span class="line">    group.removedOnCompletion = NO;</span><br><span class="line">    group.animations = @[moveAnimation,tranAnimation];</span><br><span class="line">    [layer addAnimation:group forKey:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœå›¾-2"><a href="#æ•ˆæœå›¾-2" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><p><img src="https://upload-images.jianshu.io/upload_images/1487718-fbc767740432f20c.gif?imageMogr2/auto-orient/strip" alt="CAAnimationGroup.gif"></p><hr><h2 id="CASpringAnimation-å¼¹ç°§åŠ¨ç”»"><a href="#CASpringAnimation-å¼¹ç°§åŠ¨ç”»" class="headerlink" title="CASpringAnimation å¼¹ç°§åŠ¨ç”»"></a>CASpringAnimation å¼¹ç°§åŠ¨ç”»</h2><p>&ensp;&ensp;&ensp;&ensp;<code>CASpringAnimation</code>çš„çˆ¶ç±»æ˜¯<code>CABasicAnimation</code>, <code>CABasicAnimation</code>å¯ä»¥çœ‹æˆæ˜¯åªæœ‰å¤´å°¾æœ‰å€¼çš„å…³é”®å¸§åŠ¨ç”»ã€‚</p><blockquote><p>You would typically use a spring animation to animate a layerâ€™s position so that it appears to be pulled towards a target by a spring. The further the layer is from the target, the greater the acceleration towards it is.<br>CASpringAnimation allows control over physically based attributes such as the springâ€™s damping and stiffness.</p></blockquote><p>&ensp;&ensp;&ensp;&ensp;<code>CASpringAnimation</code>æ˜¯åŸºäºç‰©ç†çš„å±æ€§æ§åˆ¶ï¼Œæ¯”å¦‚å¼¹ç°§çš„é˜»å°¼å’Œåˆšåº¦ã€‚</p><h3 id="é‡è¦å±æ€§-2"><a href="#é‡è¦å±æ€§-2" class="headerlink" title="é‡è¦å±æ€§"></a>é‡è¦å±æ€§</h3><table><thead><tr><th>å±æ€§</th><th style="text-align:center">æè¿° </th></tr></thead><tbody><tr><td>damping</td><td style="text-align:center">å®šä¹‰å¼¹ç°§è¿åŠ¨å¦‚ä½•å—åˆ°é˜»å°¼çš„å½±å“</td></tr><tr><td>initialVelocity</td><td style="text-align:center">åˆé€Ÿåº¦</td></tr><tr><td>mass</td><td style="text-align:center">è¿æ¥åˆ°å¼¹ç°§æœ«ç«¯çš„ç‰©ä½“çš„è´¨é‡</td></tr><tr><td>settlingDuration</td><td style="text-align:center">é¢„ä¼°é™æ­¢æ—¶é—´</td></tr><tr><td>stiffness</td><td style="text-align:center">å¼¹ç°§åˆšåº¦ç³»æ•°</td></tr></tbody></table><h3 id="æ•ˆæœä»£ç -3"><a href="#æ•ˆæœä»£ç -3" class="headerlink" title="æ•ˆæœä»£ç "></a>æ•ˆæœä»£ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">- (void)btnClick:(UIButton *)sender</span><br><span class="line">&#123;</span><br><span class="line">    //frameå±æ€§ä¸å¯åŠ¨ç”»åŒ– åªèƒ½é€šè¿‡ bounds å’Œ positionå®Œæˆ</span><br><span class="line">    CASpringAnimation * animation = [CASpringAnimation animationWithKeyPath:@&quot;bounds&quot;];</span><br><span class="line"></span><br><span class="line">    //è´¨é‡ï¼Œå½±å“å›¾å±‚è¿åŠ¨æ—¶çš„å¼¹ç°§æƒ¯æ€§ï¼Œè´¨é‡è¶Šå¤§ï¼Œå¼¹ç°§æ‹‰ä¼¸å’Œå‹ç¼©çš„å¹…åº¦è¶Šå¤§</span><br><span class="line">    animation.mass = self.massSlider.value;</span><br><span class="line"></span><br><span class="line">    //åˆšåº¦ç³»æ•°(åŠ²åº¦ç³»æ•°/å¼¹æ€§ç³»æ•°)ï¼Œåˆšåº¦ç³»æ•°è¶Šå¤§ï¼Œå½¢å˜äº§ç”Ÿçš„åŠ›å°±è¶Šå¤§ï¼Œè¿åŠ¨è¶Šå¿«</span><br><span class="line">    animation.stiffness = self.stiffnessSlider.value;</span><br><span class="line"></span><br><span class="line">    //é˜»å°¼ç³»æ•°ï¼Œé˜»æ­¢å¼¹ç°§ä¼¸ç¼©çš„ç³»æ•°ï¼Œé˜»å°¼ç³»æ•°è¶Šå¤§ï¼Œåœæ­¢è¶Šå¿«</span><br><span class="line">    animation.damping = self.dampingSlider.value;</span><br><span class="line"></span><br><span class="line">    //åˆå§‹é€Ÿç‡ï¼ŒåŠ¨ç”»è§†å›¾çš„åˆå§‹é€Ÿåº¦å¤§å°;é€Ÿç‡ä¸ºæ­£æ•°æ—¶ï¼Œé€Ÿåº¦æ–¹å‘ä¸è¿åŠ¨æ–¹å‘ä¸€è‡´ï¼Œé€Ÿç‡ä¸ºè´Ÿæ•°æ—¶ï¼Œé€Ÿåº¦æ–¹å‘ä¸è¿åŠ¨æ–¹å‘ç›¸å</span><br><span class="line">    animation.initialVelocity = self.velocitySlider.value;</span><br><span class="line"></span><br><span class="line">    animation.duration = 3.f;</span><br><span class="line">    animation.fromValue =  [NSValue valueWithCGRect:CGRectMake(0, 0, 80, 100)];</span><br><span class="line">    animation.toValue = [NSValue valueWithCGRect:CGRectMake(0, 0, 80, 240)];</span><br><span class="line">    animation.removedOnCompletion = NO;</span><br><span class="line">    animation.fillMode = kCAFillModeForwards;</span><br><span class="line">    animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</span><br><span class="line">    [self.baseView.layer addAnimation:animation forKey:nil];</span><br><span class="line"></span><br><span class="line">    CASpringAnimation * animation1 = [CASpringAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">    animation1.duration = 3.f;</span><br><span class="line">    animation1.fromValue = [NSValue valueWithCGPoint:CGPointMake(SCREENWIDTH / 2 , 250)];</span><br><span class="line">    animation1.toValue = [NSValue valueWithCGPoint:CGPointMake(SCREENWIDTH / 2 , 250 - 70)];</span><br><span class="line">    animation1.removedOnCompletion = NO;</span><br><span class="line">    animation1.fillMode = kCAFillModeForwards;</span><br><span class="line">    [self.baseView.layer addAnimation:animation1 forKey:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœå›¾-3"><a href="#æ•ˆæœå›¾-3" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><p><img src="https://upload-images.jianshu.io/upload_images/1487718-ae46d1313229aaa6.gif?imageMogr2/auto-orient/strip" alt="CASpringAnimation.gif"></p><hr><h3 id="UIViewçš„å¼¹ç°§åŠ¨ç”»"><a href="#UIViewçš„å¼¹ç°§åŠ¨ç”»" class="headerlink" title="UIViewçš„å¼¹ç°§åŠ¨ç”»"></a>UIViewçš„å¼¹ç°§åŠ¨ç”»</h3><p>å¦å¤–åœ¨çœ‹çœ‹<code>cell</code>ä¸Šç”¨<code>UIView Block</code>å¼¹ç°§åŠ¨ç”»çš„ç‰¹æ•ˆ</p><h4 id="æ•ˆæœä»£ç -4"><a href="#æ•ˆæœä»£ç -4" class="headerlink" title="æ•ˆæœä»£ç "></a>æ•ˆæœä»£ç </h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ (void)animateWithDuration:(NSTimeInterval)duration</span><br><span class="line">                      delay:(NSTimeInterval)delay</span><br><span class="line">     usingSpringWithDamping:(CGFloat)dampingRatio</span><br><span class="line">      initialSpringVelocity:(CGFloat)velocity</span><br><span class="line">                    options:(UIViewAnimationOptions)options</span><br><span class="line">                 animations:(void (^)(void))animations</span><br><span class="line">                 completion:(void (^ __nullable)(BOOL finished))completion NS_AVAILABLE_IOS(7_0);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- (void)cellAnimation</span><br><span class="line">&#123;</span><br><span class="line">    [self.springTableView reloadData];</span><br><span class="line"></span><br><span class="line">    NSArray * cellArrays = self.springTableView.visibleCells;</span><br><span class="line">    CGFloat height = self.springTableView.bounds.size.height;</span><br><span class="line"></span><br><span class="line">    for (UITableView * cell in cellArrays)</span><br><span class="line">    &#123;</span><br><span class="line">        cell.transform = CGAffineTransformMakeTranslation(-SCREENWIDTH, height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (NSInteger i = 0 ; i &lt; cellArrays.count ; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        UITableViewCell * cell = (UITableViewCell *)cellArrays[i];</span><br><span class="line">        [UIView animateWithDuration:1.5</span><br><span class="line">                              delay:0.05 * i</span><br><span class="line">             usingSpringWithDamping:0.8</span><br><span class="line">              initialSpringVelocity:0</span><br><span class="line">                            options:0 animations:^&#123;</span><br><span class="line">                    cell.transform = CGAffineTransformMakeTranslation(0, 0);</span><br><span class="line">            &#125; completion:nil];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ•ˆæœå›¾-4"><a href="#æ•ˆæœå›¾-4" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h4><p><img src="https://upload-images.jianshu.io/upload_images/1487718-0a62c12dc5195c94.gif?imageMogr2/auto-orient/strip" alt="CellSpringAnimation.gif"></p><p><a href="https://github.com/iOS-Misaki/CAAnimation"><strong>æºç : CAAnimation</strong></a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;æœ‰äººé—®æˆ‘ä¸ºä»€ä¹ˆè¦å†™åšå®¢ï¼Œå¿…é¡»è¦æ‰¿è®¤ï¼Œç°åœ¨ç½‘ä¸Šä¸€å¤§æ¨çš„ä¼˜ç§€æ•™ç¨‹å’Œç°æˆçš„Demoï¼Œè‡ªå·±å†™çš„æ²¡æœ‰åˆ«äººå¥½ï¼Œæœ‰äº›åœ°æ–¹æ ¹æœ¬ä¸å¤Ÿæ·±å…¥ï¼Œä½†æ˜¯çœ‹åˆ«äººå†™æ–‡ç« ã€å†™ä»£ç å’Œè‡ªå·±å†™å®Œå…¨æ˜¯ä¸¤ä»¶äº‹ï¼Œä»£ç çœ‹çœ‹å°±èƒ½æ‡‚ï¼Œä½†æ˜¯è‡ªå·±è¿‡ä¸€éï¼Œå°è±¡æ›´æ·±ï¼Œæ¶ˆåŒ–çš„ä¹Ÿå°±æ›´å½»åº•ã€‚å¯¹äºiOSåŠ¨ç”» ï¼Œä¸€ç›´éƒ½æ²¡æœ‰ç³»ç»ŸåŒ–çš„å­¦ä¹ ï¼Œåªæœ‰ç”¨çš„æ—¶å€™æ‰ä¼šæŸ¥æŸ¥apiï¼Œä¹‹å‰å†™è¿‡ä¸€ç¯‡&lt;a href=&quot;https://www.jianshu.com/p/92ac22afeeef&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;çº¢åŒ…é›¨&lt;/a&gt;çš„æ–‡ç« ï¼Œç”¨çš„æ˜¯å…³é”®å¸§åŠ¨ç”»ï¼Œæ²¡æœ‰åœ¨ç»§ç»­ä¸‹å»ã€‚å¦ä¸€ä¸ªå°±æ˜¯åœ¨6æœˆä»½é¢è¯•çš„æ—¶å€™ï¼Œæœ‰ä¸¤ä¸ªé¢è¯•å®˜éƒ½é—®åˆ°äº†åŸºç¡€åŠ¨ç”»ï¼Œå½“æ—¶ä¹Ÿå›ç­”çš„ä¸å¥½ï¼Œç°åœ¨è¯¦ç»†åœ°æ¢³ç†ä¸€éã€‚ç°é˜¶æ®µï¼Œå…ˆæŠŠ&lt;code&gt;Core Animation&lt;/code&gt;å¼„æ¸…æ¥šï¼Œä»¥åå†ä¸‹æ²‰åˆ°&lt;code&gt;OpenGL&lt;/code&gt;å’Œ&lt;code&gt;CoreGraphics&lt;/code&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOS ç»„ä»¶åŒ–å®è·µè®°å½•</title>
    <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/07/15/iOS-%E7%BB%84%E4%BB%B6%E5%8C%96%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/"/>
    <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/07/15/iOS-ç»„ä»¶åŒ–å®è·µè®°å½•/</id>
    <published>2018-07-15T03:41:54.000Z</published>
    <updated>2018-07-27T03:44:24.320Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;&ensp;&ensp;ä¹‹å‰ï¼Œå†™è¿‡æ–‡ç« <a href="https://ios-misaki.github.io/iOS-Misaki.github.io/2018/07/01/CocoaPod-%E5%88%9B%E5%BB%BA%E7%A7%81%E6%9C%89%E5%BA%93/" target="_blank" rel="noopener">CocoaPodåˆ›å»ºç§æœ‰åº“</a>è®°å½•åˆ›å»ºç§æœ‰åº“ï¼Œä½†æ˜¯å‘ç°åˆ›å»ºPaasé¡¹ç›®çš„åŸºç¡€åº“çš„æ—¶å€™ï¼Œæ²¡æœ‰é‚£ä¹ˆç®€å•ï¼ŒåŸºç¡€åº“ä¸­åˆåˆ†ä¸ºç½‘ç»œè¯·æ±‚ã€æ•°æ®å­˜å‚¨ã€UIåŠŸèƒ½ç»„ä»¶ã€åŸºç±»ç­‰ã€‚å¥½åƒä¸€ä¸ª<code>Spec</code>ä¸å¤Ÿï¼Œéš¾é“æˆ‘è¦åˆ›å»ºå¤šä¸ªå•ç‹¬çš„ç§æœ‰åº“ä¹ˆï¼Ÿ<br><a id="more"></a><br><img src="https://upload-images.jianshu.io/upload_images/1487718-c1b6e8d8f12ffce9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="AFNetworking.png"></p><p>&ensp;&ensp;&ensp;&ensp;å†çœ‹çœ‹<code>AFNetworking</code>çš„ç»“æ„ï¼Œå‘ç°ç”¨<code>Subspecs</code>å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ¯ä¸ª<code>Subspecs</code>å¯ä»¥å•ç‹¬ä¾èµ–ç¬¬ä¸‰æ–¹åº“ï¼Œä¹Ÿå¯ä»¥ä¾èµ–å…¶ä»–çš„<code>Subspecs</code>ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯æ¯ä¸ª<code>Subspecs</code>åªèƒ½å•å‘ä¾èµ–ï¼Œä¸èƒ½äº’ç›¸ä¾èµ–ã€‚å‡å¦‚ç†Ÿæ‚‰<code>ruby</code>çš„è¯­æ³•ï¼Œ<code>Subspecs</code>çš„æ ¼å¼å¾ˆå®¹æ˜“ä¹¦å†™ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/1487718-a80a0e21b60e7e02.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Networkå­æ¨¡å—.png"></p><p>&ensp;&ensp;&ensp;&ensp;æ‹¿ç½‘ç»œæ¨¡å—ä¸¾ä¾‹ï¼Œä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“æ˜¯<code>YTKNetwork</code>ï¼Œè¿˜ä¾èµ–åŸºç¡€åº“ä¸­å·¥å…·åº“ã€æ•°æ®å­˜å‚¨åº“ã€UIåŠŸèƒ½ç»„ä»¶ã€‚ï¼ˆè¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆä¼šä¾èµ–å…¶ä»–çš„åº“ï¼Œæ¯ä¸ªç½‘ç»œè¯·æ±‚çš„<code>header</code>é‡Œé¢éƒ½è¦å¡å…¥å‰ä¸€ä¸ªè¯·æ±‚çš„<code>response</code>é‡Œé¢çš„ä¸œè¥¿,è¯·æ±‚å‰å’Œå›è°ƒé‡Œé¢æ˜¾ç¤º<code>HUD</code>ï¼Œ<code>HUD</code>æ˜¯UIåŠŸèƒ½ç»„ä»¶çš„ä¸œè¥¿ï¼‰ã€‚å®Œæ•´çš„<code>podSpec</code>æ ¼å¼å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">Pod::Spec.new do |s|</span><br><span class="line">s.name             = &apos;YYPaasBaseLib&apos;</span><br><span class="line">s.version          = &apos;0.1.8&apos;</span><br><span class="line">s.summary          = &apos;Paaså¹³å°çš„åŸºç¡€åº“&apos;</span><br><span class="line"></span><br><span class="line">s.description      = &lt;&lt;-DESC</span><br><span class="line">TODO: Add long description of the pod here.</span><br><span class="line">DESC</span><br><span class="line"></span><br><span class="line">s.homepage         = &apos;https://git.qianjiangcloud.com/products/paas-app-ios-plugin&apos;</span><br><span class="line">s.license          = &#123; :type =&gt; &apos;MIT&apos;, :file =&gt; &apos;LICENSE&apos; &#125;</span><br><span class="line">s.author           = &#123; &apos;yuyiios@163.com&apos; =&gt; &apos;yuyiios@163.com&apos; &#125;</span><br><span class="line">s.source           = &#123; :git =&gt; &apos;https://git.qianjiangcloud.com/products/paas-app-ios-plugin.git&apos;, :tag =&gt; s.version.to_s &#125;</span><br><span class="line"></span><br><span class="line">s.ios.deployment_target = &apos;8.0&apos;</span><br><span class="line"></span><br><span class="line">s.subspec &apos;Category&apos; do |category|</span><br><span class="line">category.source_files = &apos;YYPaasBaseLib/Classes/Category/*.&#123;h,m&#125;&apos;</span><br><span class="line">category.public_header_files = &apos;YYPaasBaseLib/Classes/Category/*.h&apos;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">s.subspec &apos;DataStore&apos; do |dataStore|</span><br><span class="line">dataStore.source_files = &apos;YYPaasBaseLib/Classes/DataStore/*.&#123;h,m&#125;&apos;</span><br><span class="line">dataStore.public_header_files = &apos;YYPaasBaseLib/Classes/DataStore/*.h&apos;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">s.subspec &apos;Tool&apos; do |tool|</span><br><span class="line">tool.source_files = &apos;YYPaasBaseLib/Classes/Tool/*.&#123;h,m&#125;&apos;</span><br><span class="line">tool.public_header_files = &apos;YYPaasBaseLib/Classes/Tool/*.h&apos;</span><br><span class="line"></span><br><span class="line">tool.dependency &apos;YYModel&apos;, &apos;~&gt; 1.0.4&apos;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">s.subspec &apos;UI&apos; do |ui|</span><br><span class="line">ui.source_files = &apos;YYPaasBaseLib/Classes/UI/*.&#123;h,m&#125;&apos;</span><br><span class="line">ui.public_header_files = &apos;YYPaasBaseLib/Classes/UI/*.h&apos;</span><br><span class="line"></span><br><span class="line">ui.dependency &apos;Masonry&apos;, &apos;~&gt; 1.1.0&apos;</span><br><span class="line">ui.dependency &apos;MJRefresh&apos;, &apos;~&gt; 3.1.15.3&apos;</span><br><span class="line">ui.dependency &apos;MBProgressHUD&apos;, &apos;~&gt; 1.1.0&apos;</span><br><span class="line">ui.dependency &apos;IQKeyboardManager&apos;, &apos;~&gt; 6.0.4&apos;</span><br><span class="line">ui.dependency &apos;SDWebImage&apos;, &apos;~&gt; 4.4.1&apos;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">s.subspec &apos;View&apos; do |view|</span><br><span class="line">view.source_files = &apos;YYPaasBaseLib/Classes/View/*.&#123;h,m&#125;&apos;</span><br><span class="line">view.public_header_files = &apos;YYPaasBaseLib/Classes/View/*.h&apos;</span><br><span class="line">view.frameworks = &apos;WebKit&apos;</span><br><span class="line"></span><br><span class="line">view.dependency &apos;YYPaasBaseLib/Tool&apos;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">s.subspec &apos;Network&apos; do |network|</span><br><span class="line">network.source_files = &apos;YYPaasBaseLib/Classes/Network/*.&#123;h,m&#125;&apos;</span><br><span class="line">network.public_header_files = &apos;YYPaasBaseLib/Classes/Network/*.h&apos;</span><br><span class="line"></span><br><span class="line">network.dependency &apos;YTKNetwork&apos;, &apos;~&gt; 2.0.4&apos;</span><br><span class="line"></span><br><span class="line">network.dependency &apos;YYPaasBaseLib/Tool&apos;</span><br><span class="line">network.dependency &apos;YYPaasBaseLib/DataStore&apos;</span><br><span class="line">network.dependency &apos;YYPaasBaseLib/UI&apos;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">s.subspec &apos;Mediator&apos; do |mediator|</span><br><span class="line">mediator.source_files = &apos;YYPaasBaseLib/Classes/Mediator/*.&#123;h,m&#125;&apos;</span><br><span class="line">mediator.public_header_files = &apos;YYPaasBaseLib/Classes/Mediator/*.h&apos;</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">s.frameworks = &apos;UIKit&apos;, &apos;Foundation&apos;</span><br><span class="line">end</span><br></pre></td></tr></table></figure></p><p><img src="https://upload-images.jianshu.io/upload_images/1487718-23b181626f3d3b6d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="YYPaasBaseLib.png"></p><p>&ensp;&ensp;&ensp;&ensp;ä¸€å‘¨å‰ï¼Œå°±å·²ç»å®Œæˆé¡¹ç›®çš„åŸºç¡€åº“çš„åˆ›å»ºï¼Œå½“æ—¶æƒ³ç€çš„æ˜¯<strong>åŸºç¡€åº“å’Œä¸šåŠ¡è„±ç¦»</strong>ï¼Œä¸éœ€è¦å¤ªå¤§çš„æ”¹å˜ï¼Œä½†æ˜¯ä»å®é™…å¼€å‘æ¥çœ‹ï¼Œ<code>YYPaasBaseLib</code>å·²ç»ä»0.1.0ç‰ˆæœ¬æ›´æ–°åˆ°0.1.8ç‰ˆæœ¬ï¼Œå˜åŠ¨è¿˜æ˜¯æŒºå¤§çš„ã€‚å…³äºåŠŸèƒ½çš„åˆ’åˆ†ä¹Ÿæ˜¯è´¹äº†ä¸€ç•ªè„‘å­ï¼Œæœ€åä¹ŸæŠŠä¸­é—´å±‚<code>Mediator</code>æ”¾åœ¨åŸºç¡€æ¨¡å—é‡Œé¢ï¼ˆä¸­é—´å±‚+æ¨¡å—çš„<code>Category</code>å’Œæ¨¡å—çš„<code>Target</code>éƒ½æ”¾åœ¨å„è‡ªçš„ä¸šåŠ¡æ¨¡å—ä¸­ï¼‰ï¼Œæ”¾ç€è¿™é‡Œå…¶å®ä¸å¤ªå¥½ï¼Œä½†æ˜¯ç›®å‰æ²¡æœ‰æ‰¾åˆ°æ›´åˆé€‚çš„æ–¹å¼ã€‚</p><p>&ensp;&ensp;&ensp;&ensp;å…¶å®è¿˜æœ‰äº›ä¸œè¥¿å’ŒåŸºç¡€åº“ã€ä¸šåŠ¡æ¨¡å—éƒ½æœ‰è”ç³»ã€‚å¯¹äºè¿™å—çš„åˆ’åˆ†å¾ˆæ˜¯å¤´ç–¼ï¼Œæ¯”å¦‚<code>NSNotification</code>åç§°å’Œæ•°æ®å­˜å‚¨çš„é”®åï¼Œè¿˜æœ‰ç½‘ç»œè¯·æ±‚å…³äºä¸šåŠ¡æˆåŠŸå›è°ƒçš„å®šä¹‰ï¼Œæœ‰çš„æ˜¯æ ¹æ®æŸä¸ªå­—æ®µçš„å®šä¹‰ï¼Œæœ‰çš„æ˜¯åˆ¤æ–­æŸä¸ªå¯¹è±¡çš„æœ‰æ— æ¥çš„ã€‚æš‚ä¸”æŠŠè¿™äº›ä¸œè¥¿å«åšå¼±ä¸šåŠ¡å…³ç³»ï¼ŒæŠŠå¼±ä¸šåŠ¡å…³ç³»æ”¾å…¥åŸºç¡€æ¨¡å—æ˜¯ä¸åˆé€‚çš„ï¼Œå¯¹äºä¸åŒçš„ä¸šåŠ¡æ¨¡å—æˆ–è€…é¡¹ç›®ï¼Œå¼±ä¸šåŠ¡å…³ç³»éƒ½ä¸ä¸€æ ·ã€‚æ”¾å…¥å…·ä½“çš„ä¸šåŠ¡æ¨¡å—ä¹Ÿä¸åˆé€‚ï¼Œå†—ä½™å¤ªå¤§ã€‚åªèƒ½å•ç‹¬æŠ½å‡ºæ¥ä¸€ä¸ªå¼±ä¸šåŠ¡å…³ç³»ç»„ä»¶ï¼Œé‚£ä¹ˆä¾èµ–å…³ç³»åº”è¯¥æ˜¯è¿™æ · <strong>ä¸šåŠ¡ç»„ä»¶â€“&gt; å¼±ä¸šåŠ¡ç»„ä»¶â€“&gt;åŸºç¡€ç»„ä»¶</strong>ã€‚æƒ³å¿«é€Ÿæ–°å»ºä¸€ä¸ªAPPçš„è¯ï¼Œè¦åŒæ—¶æ›¿æ¢å¼±ä¸šåŠ¡ç»„ä»¶å’Œéƒ¨åˆ†ä¸šåŠ¡ç»„ä»¶ã€‚</p><p>&ensp;&ensp;&ensp;&ensp;<strong>ç»„ä»¶åŒ–ä¸æ˜¯ä¸€è¹´è€Œå°±ï¼Œéœ€è¦æ…¢æ…¢çš„æ‘¸ç´¢ã€‚</strong>ç°åœ¨APPåˆšèµ·æ­¥ï¼Œæ¨¡å—è¿˜æ¯”è¾ƒå°‘ï¼Œç¼–è¯‘çš„æ—¶é—´æ¯”è¾ƒå¿«ï¼Œå±äºå¯æ¥å—èŒƒå›´å†…ï¼ŒåæœŸæ¨¡å—æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œç¼–è¯‘æ—¶é—´ä¼šå¢åŠ ï¼Œè€Œä¸”æ¨¡å—æˆç†Ÿä¸éœ€è¦åšå¤§é‡ä¿®æ”¹ï¼Œé‚£ä¸ªæ—¶å€™å†è€ƒè™‘äºŒè¿›åˆ¶åŒ–ï¼ŒæŠŠç»„ä»¶çš„æºç è½¬æ¢æˆé™æ€åº“æˆ–è€…åŠ¨æ€åº“ï¼Œæ¥æé«˜ç¼–è¯‘é€Ÿåº¦ã€‚</p><p>&ensp;&ensp;&ensp;&ensp;iOSé¡¹ç›®æŒ‰ç…§æ¨¡å—åŒ–çš„æ–¹å¼æ¥å¼€å‘ï¼Œæ²¡æœ‰<code>tabBarController</code>,<code>RootController</code>ç›´æ¥æŒ‡å‘é¦–é¡µï¼Œé¦–é¡µæ˜¯ä¸€ä¸ª<code>WKWebView</code>ï¼Œä¸šåŠ¡å®ç°éƒ½åœ¨<code>WKWebView</code>é‡Œé¢ã€‚åŸç”Ÿçš„éƒ¨åˆ†è¿˜åŒ…æ‹¬ç™»å½•ã€æ³¨å†Œå’Œå¿˜è®°å¯†ç ã€‚<code>WkWebView</code>éœ€è¦<code>token</code>çš„æ—¶å€™ï¼ŒH5è°ƒç”¨åŸç”Ÿé¡µé¢å»ç™»å½•ï¼Œä»åå°æ‹¿åˆ°<code>token</code>åï¼Œæœ¬åœ°å­˜å‚¨ï¼Œç„¶åæ³¨å…¥<code>WKWebView</code>çš„<code>Cookie</code>é‡Œé¢ã€‚åé¢çš„å·¥ä½œæ˜¯å¼•å…¥æ”¯ä»˜ã€åŠ å…¥<code>tabBarController</code>,æŠŠH5çš„åŠŸèƒ½éƒ½å®ç°å‡ºæ¥ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/1487718-efcce8811cb63474.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åƒåŒ æ˜Ÿäº‘ä¸‹è½½äºŒç»´ç .png"></p><p>&ensp;&ensp;&ensp;&ensp;æœ€ååŠ ä¸€æ¡ç¡¬å¹¿ã€‚APPåœ¨å†…æµ‹é˜¶æ®µï¼Œç”¨ä¼ä¸šçº§è´¦å·æ‰“äº†ä¸€ä¸ª<code>.ipa</code>åŒ…ï¼Œä¸å¤§æ‰<strong>2.1M</strong>,æ”¾åœ¨äº†å…è´¹çš„è…¾è®¯äº‘ä¸Šé¢ï¼Œæ¬¢è¿æ‰«ç ä¸‹è½½ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;ä¹‹å‰ï¼Œå†™è¿‡æ–‡ç« &lt;a href=&quot;https://ios-misaki.github.io/iOS-Misaki.github.io/2018/07/01/CocoaPod-%E5%88%9B%E5%BB%BA%E7%A7%81%E6%9C%89%E5%BA%93/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CocoaPodåˆ›å»ºç§æœ‰åº“&lt;/a&gt;è®°å½•åˆ›å»ºç§æœ‰åº“ï¼Œä½†æ˜¯å‘ç°åˆ›å»ºPaasé¡¹ç›®çš„åŸºç¡€åº“çš„æ—¶å€™ï¼Œæ²¡æœ‰é‚£ä¹ˆç®€å•ï¼ŒåŸºç¡€åº“ä¸­åˆåˆ†ä¸ºç½‘ç»œè¯·æ±‚ã€æ•°æ®å­˜å‚¨ã€UIåŠŸèƒ½ç»„ä»¶ã€åŸºç±»ç­‰ã€‚å¥½åƒä¸€ä¸ª&lt;code&gt;Spec&lt;/code&gt;ä¸å¤Ÿï¼Œéš¾é“æˆ‘è¦åˆ›å»ºå¤šä¸ªå•ç‹¬çš„ç§æœ‰åº“ä¹ˆï¼Ÿ&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOS ç»„ä»¶åŒ–å°è¯•</title>
    <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/07/01/iOS-%E7%BB%84%E4%BB%B6%E5%8C%96%E5%B0%9D%E8%AF%95/"/>
    <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/07/01/iOS-ç»„ä»¶åŒ–å°è¯•/</id>
    <published>2018-07-01T03:23:54.000Z</published>
    <updated>2018-07-27T03:38:19.227Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;&ensp;&ensp;<code>ReactiveCocoa</code>åªæ›´æ–°äº†ä¸€ç¯‡ï¼Œå‰©ä¸‹ç»“åˆç™»å½•ä¾‹å­æ¥å®è·µ<code>MVVM</code>æš‚æ—¶æ²¡æœ‰æ—¶é—´ï¼Œè¿™å‘¨ç²¾åŠ›éƒ½æ”¾åœ¨äº†å…¬å¸é¡¹ç›®çš„ç»„ä»¶åŒ–ä¸Šé¢ï¼Œä»¥åæœ‰æ—¶é—´ä¼šæ…¢æ…¢è¡¥ä¸Šã€‚æ„Ÿè§‰æ¬ çš„å†å²å€ºå¥½å¤šã€‚</p><a id="more"></a><h2 id="ä¼ ç»Ÿæ¨¡å—çš„è€¦åˆ"><a href="#ä¼ ç»Ÿæ¨¡å—çš„è€¦åˆ" class="headerlink" title="ä¼ ç»Ÿæ¨¡å—çš„è€¦åˆ"></a>ä¼ ç»Ÿæ¨¡å—çš„è€¦åˆ</h2><p>&ensp;&ensp;&ensp;&ensp;å¯¹äºå¤§å‹é¡¹ç›®æ¥è¯´ï¼Œä¸šåŠ¡æ¨¡å—ä¹‹é—´çš„è€¦åˆåº¦éå¸¸å¤§ï¼Œå¾ˆéš¾ç»´æŠ¤ã€‚æ¨¡å—ä¹‹é—´ä¼šäº’ç›¸è°ƒç”¨ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/1487718-14005383adc14ecc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¼ ç»Ÿæ¨¡å—"></p><p>&ensp;&ensp;&ensp;&ensp;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªä¸­é—´å±‚ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/1487718-ed43c5ee1fb260b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¢åŠ ä¸­é—´å±‚"><br>&ensp;&ensp;&ensp;&ensp;ä½†æ˜¯æ¨¡å—å’Œä¸­é—´å±‚è¿˜æ˜¯äº’ç›¸ä¾èµ–ï¼Œä¹‹å‰è€¦åˆçš„é—®é¢˜è¿˜æ˜¯å­˜åœ¨ï¼Œè¦æ”¹è¿›çš„åœ°æ–¹æ˜¯æ¶ˆé™¤ä¸­é—´å±‚å¯¹ä¸šåŠ¡æ¨¡å—çš„ä¾èµ–ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/1487718-a1542a4366eedd5c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æœ€ç»ˆæ–¹æ¡ˆ"></p><h2 id="æ¨¡å—çš„åˆ’åˆ†"><a href="#æ¨¡å—çš„åˆ’åˆ†" class="headerlink" title="æ¨¡å—çš„åˆ’åˆ†"></a>æ¨¡å—çš„åˆ’åˆ†</h2><p>&ensp;&ensp;&ensp;&ensp;ç»„ä»¶åŒ–æ˜¯æŠŠæ¯ä¸ªæ¨¡å—ä½œä¸ºä¸€ä¸ªç»„ä»¶ï¼Œåœ¨ä¸»å·¥ç¨‹é‡Œé¢é›†æˆæ‰€æœ‰çš„ç»„ä»¶ã€‚å…³äºç”¨<code>CocoaPod</code>é›†æˆç§æœ‰åº“ï¼Œåœ¨ä¸Šç¯‡æ–‡ç« <a href="https://ios-misaki.github.io/iOS-Misaki.github.io/2018/07/01/CocoaPod-%E5%88%9B%E5%BB%BA%E7%A7%81%E6%9C%89%E5%BA%93/" target="_blank" rel="noopener">CocoaPodåˆ›å»ºç§æœ‰åº“</a>æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚<br>&ensp;&ensp;&ensp;&ensp;æ•´ä¸ªé¡¹ç›®ä¸­æ¨¡å—çš„åˆ’åˆ†æ˜¯åˆ†ä¸ºåŸºç¡€æ¨¡å—ã€ä¸­é—´å±‚å’Œä¸šåŠ¡æ¨¡å—ã€‚</p><ul><li>åŸºç¡€æ¨¡å—é‡Œé¢æ˜¯å’Œä¸šåŠ¡æ²¡æœ‰ä»»ä½•å…³è”çš„æ¨¡å—ï¼Œé‡Œé¢åŒ…æ‹¬ç½‘ç»œè¯·æ±‚ã€å›¾ç‰‡åŠ è½½ã€æ•°æ®å­˜å‚¨ã€é¡µé¢å¸ƒå±€è¿˜æœ‰å…¬å…±çš„å·¥å…·ç±»ç­‰ã€‚</li><li>ä¸šåŠ¡æ¨¡å—æ˜¯æŒ‰ç…§åŠŸèƒ½æ¥åˆ’åˆ†çš„ã€‚æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œæ¥ç¡®å®šé¢—ç²’åº¦çš„å¤§å°ï¼Œæ¯”å¦‚ç™»å½•æ³¨å†Œæ¨¡å—ã€ç”¨æˆ·ä¿¡æ¯æ¨¡å—ã€è´­ç‰©è½¦æ¨¡å—ã€è¯¦æƒ…æ¨¡å—ã€è®¢å•æ¨¡å—ç­‰ã€‚ä¸šåŠ¡æ¨¡å—æ˜¯è¦ä¾èµ–åŸºç¡€æ¨¡å—çš„ã€‚</li><li>ä¸­é—´å±‚ä¸ä¾èµ–ä¸šåŠ¡æ¨¡å—ï¼Œåªè´Ÿè´£è°ƒåº¦ä¸šåŠ¡æ¨¡å—ã€‚</li></ul><h2 id="æ¨¡å—ä¹‹é—´çš„é€šè®¯"><a href="#æ¨¡å—ä¹‹é—´çš„é€šè®¯" class="headerlink" title="æ¨¡å—ä¹‹é—´çš„é€šè®¯"></a>æ¨¡å—ä¹‹é—´çš„é€šè®¯</h2><p>&ensp;&ensp;&ensp;&ensp;æ¶ˆé™¤ä¸­é—´å±‚å¯¹ä¸šåŠ¡çš„ä¾èµ–ï¼Œæœ‰ä¸‰ç§æ–¹æ¡ˆã€‚</p><ul><li>è˜‘è‡è¡— <a href="https://link.jianshu.com/?t=https://github.com/mogujie/MGJRouter.git" target="_blank" rel="noopener">MGJRouter</a> <code>URL -&gt; block</code></li><li>åæ¥è˜‘è‡è¡—å¯¹è¿™ç§æ–¹æ¡ˆæå‡ºæ”¹è¿›<code>protocol -&gt; class</code></li><li>casatwyå¤§ç¥çš„ åŸºäº<a href="https://github.com/casatwy/CTMediator.git">CTMediator</a>çš„<code>Target -&gt; Action</code></li></ul><p>&ensp;&ensp;&ensp;&ensp;ä¸‹é¢é‡ç‚¹ä»‹ç»ç¬¬ä¸‰ç§æ–¹æ¡ˆã€‚æŠŠæ‰€æœ‰ç»„ä»¶çš„è°ƒç”¨éƒ½é€šè¿‡<code>category</code>çš„æ–¹å¼æš´éœ²å‡ºæ¥ï¼Œè°ƒç”¨æ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (id)performTarget:(NSString *)targetName action:(NSString *)actionName params:(NSDictionary *)params shouldCacheTarget:(BOOL)shouldCacheTarget;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;ç°åœ¨ä¸¾ä¸ªä¾‹å­ï¼Œé¦–é¡µè¦pushç™»å½•é¡µé¢ã€‚åœ¨ä¸­é—´å±‚æ–°å»ºä¸€ä¸ª<code>CTMediator</code>çš„åˆ†ç±»<code>CTMediator+UMAction</code>,æš´éœ²ä¸€ä¸ªæ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (UIViewController *)CTMediator_viewControllerForDetailWithValue:(NSString *)value;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;<code>Targe</code>tæ˜¯<code>UM</code>,<code>Action</code>çš„å¯¹è±¡æ˜¯<code>LoginViewController</code>ã€‚ç„¶åå†<code>UM</code>æ¨¡å—é‡Œé¢å»ºç«‹<code>Target_UM</code>æ–‡ä»¶ï¼Œæ¥å¤„ç†<code>LoginViewController</code>çš„å®ä¾‹åŒ–ã€‚åœ¨é¦–é¡µè°ƒç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UIViewController * vc = [[CTMediator sharedInstance] CTMediator_viewControllerForDetailWithValue:@&quot;æˆ‘æ˜¯æ ‡é¢˜&quot;];</span><br><span class="line">[self.navigationController presentViewController:vc animated:YES completion:nil];</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;å¯ä»¥çœ‹åˆ°é¦–é¡µå¹¶æ²¡æœ‰å¼•å…¥<code>LoginViewController</code>çš„å¤´æ–‡ä»¶ã€‚<code>CTMediator</code> å®é™…ä¸Šæ˜¯åŸºäº<code>Runtime</code>è¿›è¡Œç±»ååå°„ï¼Œå°†<code>CTMediator+UMAction</code>è°ƒç”¨ç”Ÿæˆä¸€ä¸ª<code>Target_UM</code>ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NSString *targetClassString = [NSString stringWithFormat:@&quot;Target_%@&quot;, targetName];</span><br><span class="line">NSString *actionString = [NSString stringWithFormat:@&quot;Action_%@:&quot;, actionName];</span><br><span class="line">Class targetClass;</span><br><span class="line"></span><br><span class="line">NSObject *target = self.cachedTarget[targetClassString];</span><br><span class="line">if (target == nil) &#123;</span><br><span class="line">targetClass = NSClassFromString(targetClassString);</span><br><span class="line">target = [[targetClass alloc] init];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SEL action = NSSelectorFromString(actionString);</span><br><span class="line">return [self safePerformAction:action target:target params:params];</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;<strong>æ‰€ä»¥æ¯æ·»åŠ ä¸€ä¸ªæ¨¡å—ï¼Œéƒ½è¦åœ¨ä¸­é—´å±‚å£°æ˜ä¸€ä¸ªåˆ†ç±»æ¥è°ƒç”¨ï¼ŒåŒæ—¶ä¹Ÿè¦åœ¨ç›¸åº”çš„æ¨¡å—å†…å»å®ç°è¿™ä¸ª<code>Target</code>ã€‚</strong></p><h2 id="å…³äºç»„ä»¶åŒ–çš„æ€è€ƒ"><a href="#å…³äºç»„ä»¶åŒ–çš„æ€è€ƒ" class="headerlink" title="å…³äºç»„ä»¶åŒ–çš„æ€è€ƒ"></a>å…³äºç»„ä»¶åŒ–çš„æ€è€ƒ</h2><p>&ensp;&ensp;&ensp;&ensp;å®æ–½ç»„ä»¶åŒ–çš„å¤§è‡´çš„æ­¥éª¤ï¼Œé¦–å…ˆæ˜¯æŠŠé¡¹ç›®è§£è€¦æ‹†åˆ†æˆä¸€ä¸ªä¸ªå•ç‹¬çš„ç»„ä»¶ï¼Œç„¶åå®ç°ç»„ä»¶é—´çš„é€šè®¯ã€‚</p><ul><li><p>ç»„ä»¶åŒ–çš„å¥½å¤„<br><strong>ç®€åŒ–äº†ä»£ç çš„æ•´ä½“ç»“æ„ï¼Œé™ä½äº†ç»´æŠ¤æˆæœ¬ï¼Œä¸åŒæ¨¡å—é€šè¿‡gitç®¡ç†ï¼Œå®ç°ç‰©ç†éš”ç¦»ï¼Œæé«˜ä»£ç çš„ç¨³å®šæ€§ï¼Œä¸ºæ¨¡å—çš„å¤ç”¨æä¾›äº†åŸºç¡€ï¼Œæœªæ¥å¯ä»¥çµæ´»çš„æ‰©å±•ä¸šåŠ¡ã€‚</strong></p></li><li><p>ç»„ä»¶åŒ–çš„ç¼ºç‚¹ã€‚<br><strong>å­¦ä¹ æˆæœ¬é«˜ï¼Œå¯¹å¼€å‘äººå‘˜æŒæ¡å„ç§å·¥å…·è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå…¥é—¨æ¯”è¾ƒå›°éš¾ï¼Œä¸ªäººå­¦ä¹ åˆ¶ä½œç§æœ‰åº“ï¼Œä¹Ÿæ˜¯è¸©äº†å¥½å¤šå‘ã€‚å‰æœŸåŸºä¸šåŠ¡æ²¡æœ‰å®ç°ï¼Œè¦æå‰è€ƒè™‘æ¨¡å—ä¹‹é—´çš„è§£è€¦ï¼Œè¿‡å¤šçš„å…³æ³¨ç»„ä»¶é—´çš„é€šè®¯ï¼Œå¿…ç„¶å¯¼è‡´å¼€å‘æ•ˆç‡çš„ä¸‹é™ã€‚</strong></p></li></ul><p>&ensp;&ensp;&ensp;&ensp;è¯´ä¸€ä¸‹é¡¹ç›®ï¼Œè„±ç¦»å®é™…é¡¹ç›®è°ˆæ¶æ„éƒ½æ˜¯æ‰¯æ·¡ã€‚ç›®å‰æ¥æ‰‹çš„é¡¹ç›®æ˜¯ä¸ªç”µå•†ç±»çš„é¡¹ç›®ï¼ŒiOS å’Œå®‰å“éƒ½è¿˜æ²¡æœ‰èµ·æ­¥ï¼Œwebå‰ç«¯å·²ç»å®ç°1.0ç‰ˆæœ¬ï¼ŒåŸºæœ¬çš„ç”µå•†çš„åŠŸèƒ½éƒ½å®ç°äº†ã€‚iOSé¡¹ç›®ç›®å‰å°±ä¸¤ä¸ªäººã€‚é¡¹ç›®æƒ³åšæˆä¸€ä¸ªæ¨¡æ¿ï¼Œç„¶åç»™ä¸åŒçš„å®¢æˆ·æä¾›å¯å®šåˆ¶åŒ–çš„åŠŸèƒ½ã€‚é¡¹ç›®ç®¡ç†äººå‘˜æƒ³æ¨è¡Œç»„ä»¶åŒ–ï¼Œè¿™å‘¨æˆ‘åœ¨å®è·µè¿™ä¸€æ–¹æ¡ˆçš„å¯è¡Œæ€§ã€‚<br>&ensp;&ensp;&ensp;&ensp;å¹¶ä¸æ˜¯æ‰€æœ‰é¡¹ç›®æ˜¯é€‚ç”¨äºç»„ä»¶åŒ–ã€‚å°±å¯¹äºç°åœ¨çš„é¡¹ç›®æ¥è¯´ï¼Œåªæœ‰ä¸¤ä¸ªå¼€å‘äººå‘˜ã€‚æˆ‘æ¥ç¡®å®šä»£ç è§„èŒƒï¼Œä¸å­˜åœ¨å¤šäººååŒå†²çªçš„æƒ…å†µã€‚äº§å“è™½ç„¶è¯´åç«¯æ¥å£å’Œwebå‰ç«¯éƒ½å®ç°äº†ï¼Œä½†æ˜¯iOSå’Œå®‰å“é¡¹ç›®éƒ½è¿˜æ²¡èµ·æ­¥ï¼Œå®ç°æœ€åŸºç¡€çš„ä¸šåŠ¡ï¼Œå¿«é€Ÿè¿­ä»£ä¸Šçº¿æ›´åŠ é‡è¦ï¼Œç°æœ‰MVCæˆ–è€…MVVMå°±è¶³å¤Ÿç°å®äº†ã€‚å½“å®ç°äº†åŸºç¡€ä¸šåŠ¡ï¼Œéœ€è¦æ›´å¤šå¯¹ç»†èŠ‚å…³æ³¨ï¼Œæ‰å·®ä¸å¤šè¦è€ƒè™‘ç»„ä»¶åŒ–ã€‚<br>&ensp;&ensp;&ensp;&ensp;ç»„ä»¶åŒ–é€‚åˆä¸šåŠ¡æˆç†Ÿä¸”ç¹æ‚ã€å¼€å‘äººå‘˜å¤šçš„å¤§å›¢é˜Ÿï¼Œå¯¹äºæˆ‘ä»¬ä¸¤äººä¸”è¿˜æ²¡æœ‰å¼€å¯é¡¹ç›®çš„å›¢é˜Ÿè‡³å°‘ç°åœ¨è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹æ¥è¯´æ˜¯ä¸åˆé€‚çš„ã€‚é€‚åˆé¡¹ç›®çš„æ¶æ„å°±æ˜¯å¥½æ¶æ„ï¼Œç»„ä»¶åŒ–æ˜¯å¥½æŠ€æœ¯ï¼Œä½†æ˜¯åœ¨ä¸åˆé€‚çš„æ—¶å€™ç›²ç›®è¿½æ±‚ç»„ä»¶åŒ–ï¼Œæ˜¯æœ¬æœ«å€’ç½®çš„ã€‚</p><p><strong>å‚è€ƒ :</strong><br><a href="https://casatwy.com/modulization_in_action.html" target="_blank" rel="noopener">åœ¨ç°æœ‰å·¥ç¨‹ä¸­å®æ–½åŸºäºCTMediatorçš„ç»„ä»¶åŒ–æ–¹æ¡ˆ</a><br><a href="https://casatwy.com/iOS-Modulization.html" target="_blank" rel="noopener">iOSåº”ç”¨æ¶æ„è°ˆ ç»„ä»¶åŒ–æ–¹æ¡ˆ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;&lt;code&gt;ReactiveCocoa&lt;/code&gt;åªæ›´æ–°äº†ä¸€ç¯‡ï¼Œå‰©ä¸‹ç»“åˆç™»å½•ä¾‹å­æ¥å®è·µ&lt;code&gt;MVVM&lt;/code&gt;æš‚æ—¶æ²¡æœ‰æ—¶é—´ï¼Œè¿™å‘¨ç²¾åŠ›éƒ½æ”¾åœ¨äº†å…¬å¸é¡¹ç›®çš„ç»„ä»¶åŒ–ä¸Šé¢ï¼Œä»¥åæœ‰æ—¶é—´ä¼šæ…¢æ…¢è¡¥ä¸Šã€‚æ„Ÿè§‰æ¬ çš„å†å²å€ºå¥½å¤šã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CocoaPod åˆ›å»ºç§æœ‰åº“</title>
    <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/07/01/CocoaPod-%E5%88%9B%E5%BB%BA%E7%A7%81%E6%9C%89%E5%BA%93/"/>
    <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/07/01/CocoaPod-åˆ›å»ºç§æœ‰åº“/</id>
    <published>2018-07-01T01:35:21.000Z</published>
    <updated>2018-07-27T03:35:42.215Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;&ensp;&ensp;åœ¨ç äº‘(<a href="https://gitee.com/yuyiios/events" target="_blank" rel="noopener">æˆ‘çš„ä¸ªäººä¸»é¡µ</a>)ä¸Šåˆ›å»ºä¸¤ä¸ªè¿œç¨‹ä»“åº“ï¼Œå…¶ä¸­<code>YYSpecs</code> ç”¨æ¥å­˜æ”¾æœ¬åœ°çš„<code>spec</code>,<code>YYToolProject</code>æ˜¯ç”¨æ¥å­˜æ”¾ç§æœ‰åº“ä»£ç çš„ã€‚</p><h2 id="åˆ›å»ºæœ¬åœ°ç´¢å¼•"><a href="#åˆ›å»ºæœ¬åœ°ç´¢å¼•" class="headerlink" title="åˆ›å»ºæœ¬åœ°ç´¢å¼•"></a>åˆ›å»ºæœ¬åœ°ç´¢å¼•</h2><p>&ensp;&ensp;&ensp;&ensp;é¦–å…ˆ è¿›å…¥<code>~/.cocoapods/repos</code>ç›®å½• æŸ¥çœ‹æœ‰ä¸€ä¸ª<code>master</code>çš„ç›®å½•ï¼Œ<code>master</code>å°±æ˜¯<code>cocoapod</code>å®˜ç½‘çš„ç´¢å¼•æºï¼Œç°åœ¨è¦åšçš„å°±æ˜¯åˆ›å»ºè‡ªå·±ç§æœ‰çš„<code>Spec Repo</code>.</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pod repo add [Private Repo Name] [GitHub HTTPS clone URL]</span><br><span class="line">pod repo add YYSpecs  https://gitee.com/yuyiios/YYSpecs.git</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/1487718-8a8184268cf14700.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="~:.cocoapods:reposç›®å½•.png"></p><p>&ensp;&ensp;&ensp;&ensp;ç„¶åå¯ä»¥çœ‹è§<code>master</code>æœ‰ä¸ªåŒçº§ç›®å½•<code>YYSpecs</code>ã€‚ç§æœ‰<code>Spec Repo</code>å°±åˆ›å»ºå®Œæˆäº†ã€‚</p><h2 id="åˆ›å»ºæœ¬åœ°lib"><a href="#åˆ›å»ºæœ¬åœ°lib" class="headerlink" title="åˆ›å»ºæœ¬åœ°lib"></a>åˆ›å»ºæœ¬åœ°lib</h2><p>&ensp;&ensp;&ensp;&ensp;è¿›å…¥æ¡Œé¢ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code>YYToolSet</code>çš„<code>pod</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod lib create YYToolSet</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;ä¼šæœ‰ä»¥ä¸‹æç¤ºï¼ŒæŒ‰ç…§é—®é¢˜å›ç­”å°±å¯ä»¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">To get you started we need to ask a few questions, this should only take a minute.</span><br><span class="line"></span><br><span class="line">If this is your first time we recommend running through with the guide: </span><br><span class="line">- https://guides.cocoapods.org/making/using-pod-lib-create.html</span><br><span class="line">( hold cmd and double click links to open in a browser. )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">What platform do you want to use?? [ iOS / macOS ]</span><br><span class="line">&gt; </span><br><span class="line">ios</span><br><span class="line">What language do you want to use?? [ Swift / ObjC ]</span><br><span class="line">&gt; ObjC</span><br><span class="line"></span><br><span class="line">Would you like to include a demo application with your library? [ Yes / No ]</span><br><span class="line">&gt; No</span><br><span class="line"></span><br><span class="line">Which testing frameworks will you use? [ Specta / Kiwi / None ]</span><br><span class="line">&gt; None</span><br><span class="line"></span><br><span class="line">Would you like to do view based testing? [ Yes / No ]</span><br><span class="line">&gt; No</span><br><span class="line"></span><br><span class="line">What is your class prefix?</span><br><span class="line">&gt; YY</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;åœ¨Finderä¸­ï¼Œå°†<code>/YYToolSet/Classes</code>ç›®å½•ä¸‹çš„<code>ReplaceMe.m</code>åˆ é™¤ æ›¿æ¢æˆè‡ªå·±çš„æ–‡ä»¶ï¼Œå¦‚å›¾ã€‚<img src="https://upload-images.jianshu.io/upload_images/1487718-465ead8a2f11b57d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ›¿æ¢æ‰ReplaceMeæ–‡ä»¶.png"><br>&ensp;&ensp;&ensp;&ensp;æ‰“å¼€å·¥ç¨‹ï¼ŒæŸ¥çœ‹<code>YYToolSet.podspec</code>æ–‡ä»¶</p><ul><li>s.version æ˜¯podçš„ç‰ˆæœ¬ä¿¡æ¯ è¿™ä¸ªåé¢æ‰“tagçš„æ—¶å€™ç”¨çš„åˆ°</li><li>s.summary æ˜¯ç®€çŸ­çš„æè¿°</li><li>s.source æ˜¯é¡¹ç›®è¿œç¨‹ä»“åº“çš„åœ°å€ï¼Œè¿™é‡Œä¸è¦ç”¨SSHï¼Œç”¨HTTPSã€‚</li><li>s.homepage æ˜¯é¡¹ç›®ä¸»é¡µåœ°å€ å°±æ˜¯HTTPSåœ°å€åé¢å»æ‰.git å°±å¯ä»¥</li><li>s.source_files æ˜¯é¡¹ç›®çš„æ–‡ä»¶ å°±æ˜¯åˆšæ‰æ›¿æ¢ReplaceMe.mçš„é‚£äº›æ–‡ä»¶ </li><li>s.resource_bundles æ˜¯èµ„æºæ–‡ä»¶</li><li>s.frameworks æ˜¯ç”¨åˆ°äº†ç³»ç»Ÿçš„å“ªäº›åº“ ä¾‹å¦‚UIKitã€Foundation</li><li>s.dependency æ˜¯ç”¨åˆ°å“ªäº›ç¬¬ä¸‰æ–¹åº“ æ¯”å¦‚AFNetworking æœ‰å¤šä¸ªå°±å†™å¤šä¸ªs.dependency</li><li>s.public_header_files é¡¹ç›®çš„å…¬å…±å¤´æ–‡ä»¶ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå½“å¼•å…¥Masonryã€YTKNetworkçš„æ—¶å€™ å¯ä»¥åˆ›å»ºä¸€ä¸ªheaderæ–‡ä»¶ï¼Œç„¶åå°†#import â€œMasonry.hâ€    #import â€œYTKNetwork.hâ€å†™å…¥è¿›å»</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/1487718-ed45e32c442d9704.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®æ–‡ä»¶.png"></p><h2 id="éªŒè¯æœ¬åœ°lib"><a href="#éªŒè¯æœ¬åœ°lib" class="headerlink" title="éªŒè¯æœ¬åœ°lib"></a>éªŒè¯æœ¬åœ°lib</h2><p>&ensp;&ensp;&ensp;&ensp;ä¿®æ”¹å®Œæˆåï¼Œåˆ‡æ¢åˆ°å¤–é¢çš„<code>YYToolSet</code>ç›®å½•ï¼ŒéªŒè¯<code>podspec</code>æ–‡ä»¶ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pod lib lint</span><br><span class="line">pod lib lint --verbose</span><br><span class="line">pod lib lint --allow-warnings</span><br><span class="line">pod lib lint --sources=https://gitee.com/yuyiios/YYSpecs.git</span><br><span class="line">pod lib lint --use-libraries</span><br></pre></td></tr></table></figure></p><ul><li>â€“verbose å‡å¦‚æœ‰error,æŸ¥çœ‹æŠ¥é”™ä¿¡æ¯</li><li>â€“allow-warnings å‡å¦‚æœ‰warningï¼Œå¯ä»¥é€šè¿‡æ¥å¿½ç•¥é”™è¯¯ä¿¡æ¯é€šè¿‡éªŒè¯ </li><li>â€“sources å‡å¦‚è¿™ä¸ªç§æœ‰åº“è¿˜ä¾èµ–å…¶ä»–çš„ç§æœ‰åº“ï¼Œä¸€å®šè¦æŒ‡å®šç§æœ‰åº“çš„ç´¢å¼•æºï¼ˆå°±æ˜¯æˆ‘ä¸Šæ–‡è¯´çš„YYSpecsçš„gitåœ°å€ï¼‰â€“sources=<a href="https://github.com/artsy/Specs,master">https://github.com/artsy/Specs,master</a></li><li>â€“use-libraries å¦‚æœç”¨äº†ç¬¬ä¸‰æ–¹çš„frameworkæˆ–è€…é™æ€åº“ï¼Œè¦åŠ ä¸Šã€‚</li></ul><h2 id="éªŒè¯æœ¬åœ°å’Œè¿œç«¯çš„pod"><a href="#éªŒè¯æœ¬åœ°å’Œè¿œç«¯çš„pod" class="headerlink" title="éªŒè¯æœ¬åœ°å’Œè¿œç«¯çš„pod"></a>éªŒè¯æœ¬åœ°å’Œè¿œç«¯çš„pod</h2><p>&ensp;&ensp;&ensp;&ensp;æœ¬åœ°æ ¡éªŒæˆåŠŸåï¼Œæ¨é€è‡³è¿œç«¯ï¼Œå°±æ˜¯<code>YYToolProject</code>çš„gitåœ°å€ã€‚è¿›å…¥å¤–é¢çš„<code>YYToolSet</code>ç›®å½•ã€‚æ‰§è¡Œå‘½ä»¤ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin [GitHub HTTPS clone URL]</span><br><span class="line">git remote add origin https://gitee.com/yuyiios/YYToolProject.git</span><br><span class="line">git pull origin master</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;æœ‰å†²çªå…ˆè§£å†³å†²çª<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &apos;fix&apos;</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;ç„¶åç»™<code>pod</code>æ‰“ä¸Šæ ‡ç­¾ï¼Œå¹¶ä¸”æ¨é€è‡³è¿œç«¯ï¼Œæ³¨æ„è¿™é‡Œçš„<code>tag</code>è¦å’Œ<code>podspec</code>æ–‡ä»¶é‡Œé¢çš„<code>s.version</code>å¯¹åº”èµ·æ¥ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git tag -m &apos;0.1.0æ ‡ç­¾&apos; -a 0.1.0</span><br><span class="line">git push --tags</span><br><span class="line">git tag //æŸ¥çœ‹æ ‡ç­¾</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;æ‰“å®Œæ ‡ç­¾åï¼Œæ‰§è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod spec lint</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;<code>pod lib lint</code>å’Œ<code>pod spec lint</code>çš„åŒºåˆ«æ˜¯å‰è€…åªä¼šæ£€éªŒæœ¬åœ°çš„<code>pod</code>,åè€…æ˜¯æœ¬åœ°å’Œè¿œç«¯éƒ½ä¼šæ£€éªŒï¼Œæ‰€ä»¥ä¹‹å‰ç”¨åˆ°çš„<code>--allow-warning  --sources --use-libraries</code> ç­‰å‘½ä»¤çš„è¿™é‡Œéƒ½è¦å¸¦ä¸Šã€‚</p><h2 id="æ¨é€è‡³ç´¢å¼•æºä»“åº“"><a href="#æ¨é€è‡³ç´¢å¼•æºä»“åº“" class="headerlink" title="æ¨é€è‡³ç´¢å¼•æºä»“åº“"></a>æ¨é€è‡³ç´¢å¼•æºä»“åº“</h2><p>&ensp;&ensp;&ensp;&ensp;è¿œç«¯å’Œæœ¬åœ°éƒ½æ ¡éªŒé€šè¿‡åå°±è¦å°†<code>YYToolSet.podspec</code>æ¨é€è‡³<code>YYSpecs</code>ä»“åº“ä¸­ æˆåŠŸåå»<code>~/.cocoapods/repos/YYSpecs</code> æœ‰ä¸ª<code>YYToolSet</code>ç›®å½• æœ‰ä¸ª0.1.0çš„ç‰ˆæœ¬ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pod repo push [Repoå] [podspec æ–‡ä»¶åå­—]</span><br><span class="line">pod repo push YYSpecs YYToolSet.podspec</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;æœ€åéªŒè¯ä¸€ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pod search YYToolSet </span><br><span class="line">-&gt; YYToolSet (0.1.0)</span><br><span class="line">å·¥å…·é›† YYToolSet.</span><br><span class="line">pod &apos;YYToolSet&apos;, &apos;~&gt; 0.1.0&apos;</span><br><span class="line">- Homepage: https://gitee.com/yuyiios/YYToolProject</span><br><span class="line">- Source:   https://gitee.com/yuyiios/YYToolProject.git</span><br><span class="line">- Versions: 0.1.0 [YYSpecs repo]</span><br><span class="line">(END)</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;æ–°å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼Œå¯¼å…¥ç§æœ‰åº“éªŒè¯ä¸€ä¸‹ï¼Œè¿™é‡Œä¸€å®šè¦å¸¦ä¸Š<code>source</code> å°±æ˜¯<code>YYToolSet</code>æ‰€åœ¨ç´¢å¼•æºçš„è¿œç«¯åœ°å€ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pod init </span><br><span class="line">vim Podfile</span><br><span class="line"></span><br><span class="line">source &apos;https://gitee.com/yuyiios/YYToolProject.git&apos;</span><br><span class="line"># platform :ios, &apos;9.0&apos;</span><br><span class="line"></span><br><span class="line">source &apos;https://gitee.com/yuyiios/YYSpecs.git&apos;</span><br><span class="line"># platform :ios, &apos;9.0&apos;</span><br><span class="line"></span><br><span class="line">target &apos;None&apos; do</span><br><span class="line">pod &apos;YYToolSet&apos;, &apos;~&gt; 0.1.0&apos;</span><br><span class="line"># use_frameworks!</span><br><span class="line"></span><br><span class="line"># Pods for None</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure></p><p><img src="https://upload-images.jianshu.io/upload_images/1487718-685e87a6ae906c0b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="éªŒè¯é€šè¿‡.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;åœ¨ç äº‘(&lt;a href=&quot;https://gitee.com/yuyiios/events&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æˆ‘çš„ä¸ªäººä¸»é¡µ&lt;/a&gt;)ä¸Šåˆ›å»ºä¸¤ä¸ªè¿œç¨‹ä»“åº“ï¼Œå…¶ä¸­&lt;code&gt;YYSpecs&lt;/code&gt; ç”¨æ¥å­˜æ”¾æœ¬åœ°çš„&lt;code&gt;spec&lt;/code&gt;,&lt;code&gt;YYToolProject&lt;/code&gt;æ˜¯ç”¨æ¥å­˜æ”¾ç§æœ‰åº“ä»£ç çš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åˆ›å»ºæœ¬åœ°ç´¢å¼•&quot;&gt;&lt;a href=&quot;#åˆ›å»ºæœ¬åœ°ç´¢å¼•&quot; class=&quot;headerlink&quot; title=&quot;åˆ›å»ºæœ¬åœ°ç´¢å¼•&quot;&gt;&lt;/a&gt;åˆ›å»ºæœ¬åœ°ç´¢å¼•&lt;/h2&gt;&lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;é¦–å…ˆ è¿›å…¥&lt;code&gt;~/.cocoapods/repos&lt;/code&gt;ç›®å½• æŸ¥çœ‹æœ‰ä¸€ä¸ª&lt;code&gt;master&lt;/code&gt;çš„ç›®å½•ï¼Œ&lt;code&gt;master&lt;/code&gt;å°±æ˜¯&lt;code&gt;cocoapod&lt;/code&gt;å®˜ç½‘çš„ç´¢å¼•æºï¼Œç°åœ¨è¦åšçš„å°±æ˜¯åˆ›å»ºè‡ªå·±ç§æœ‰çš„&lt;code&gt;Spec Repo&lt;/code&gt;.&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOS 8ç§ç»å…¸ç®—æ³•å¯è§†åŒ–</title>
    <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/04/18/iOS-8%E7%A7%8D%E7%BB%8F%E5%85%B8%E7%AE%97%E6%B3%95%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/04/18/iOS-8ç§ç»å…¸ç®—æ³•å¯è§†åŒ–/</id>
    <published>2018-04-18T15:32:26.000Z</published>
    <updated>2018-07-26T16:10:02.189Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;&ensp;&ensp;å…ˆçœ‹å›¾ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿å±•ç¤ºgifå›¾ç‰‡ï¼Œåœ¨å†’æ³¡æ’åºã€é€‰æ‹©æ’åºã€æ’å…¥æ’åºï¼Œè§†å›¾æ›´æ–°åœç•™çš„æ—¶é—´è®¾ç½®ä¸º0.001ç§’ï¼Œå…¶ä»–æ’åºè®¾ç½®è§†å›¾æ›´æ–°æ—¶é—´ä¸º0.003ç§’ã€‚</p><a id="more"></a><p><img src="https://upload-images.jianshu.io/upload_images/1487718-c67a8b114e5a12b8.gif?imageMogr2/auto-orient/strip" alt="0å†’æ³¡æ’åºï¼ˆ0.001sï¼‰.gif"></p><p><img src="https://upload-images.jianshu.io/upload_images/1487718-ab8a517890793cd8.gif?imageMogr2/auto-orient/strip" alt="1é€‰æ‹©æ’åºï¼ˆ0.001sï¼‰.gif"></p><p><img src="https://upload-images.jianshu.io/upload_images/1487718-94a562e4f40c9067.gif?imageMogr2/auto-orient/strip" alt="2æ’å…¥æ’åºï¼ˆ0.001sï¼‰.gif"></p><p><img src="https://upload-images.jianshu.io/upload_images/1487718-20d8e1c4744b3002.gif?imageMogr2/auto-orient/strip" alt="3å¿«é€Ÿæ’åºï¼ˆ0.003sï¼‰.gif"></p><p><img src="https://upload-images.jianshu.io/upload_images/1487718-2db8865d136d7b27.gif?imageMogr2/auto-orient/strip" alt="4å¸Œå°”æ’åºï¼ˆ0.003sï¼‰.gif"></p><p><img src="https://upload-images.jianshu.io/upload_images/1487718-92b55075ee71d41f.gif?imageMogr2/auto-orient/strip" alt="5å½’å¹¶æ’åºï¼ˆ0.003sï¼‰.gif"></p><p><img src="https://upload-images.jianshu.io/upload_images/1487718-f489ad65de02a3a1.gif?imageMogr2/auto-orient/strip" alt="6å †æ’åºï¼ˆ0.003sï¼‰.gif"></p><p><img src="https://upload-images.jianshu.io/upload_images/1487718-333d51fc00d19b26.gif?imageMogr2/auto-orient/strip" alt="7åŸºæ•°æ’åºï¼ˆ0.003sï¼‰.gif"></p><h2 id="ç®—æ³•å¤æ‚åº¦"><a href="#ç®—æ³•å¤æ‚åº¦" class="headerlink" title="ç®—æ³•å¤æ‚åº¦"></a>ç®—æ³•å¤æ‚åº¦</h2><p><img src="https://upload-images.jianshu.io/upload_images/1487718-3fe0a1205ccd214d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤æ‚åº¦.jpg"></p><h2 id="å¯è§†åŒ–"><a href="#å¯è§†åŒ–" class="headerlink" title="å¯è§†åŒ–"></a>å¯è§†åŒ–</h2><h3 id="é«˜åº¦å¯è§†åŒ–"><a href="#é«˜åº¦å¯è§†åŒ–" class="headerlink" title="é«˜åº¦å¯è§†åŒ–"></a>é«˜åº¦å¯è§†åŒ–</h3><p>&ensp;&ensp;&ensp;&ensp;é¦–å…ˆï¼Œç”¨è§†å›¾<code>SortView</code>çš„é«˜åº¦æ¥ä»£è¡¨éšæœºæ•°ï¼Œä¸ºäº†ä¾¿äºæŸ¥çœ‹ï¼Œæœ¬èº«çš„é¢œè‰²éšç€é«˜åº¦å˜åŒ–è€Œå˜åŒ–ï¼Œå¯¹å¤–æš´éœ²ä¸€ä¸ªæ›´æ”¹é«˜åº¦çš„æ–¹æ³•ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;SortView.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation SortView</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame</span><br><span class="line">&#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self)</span><br><span class="line">    &#123;</span><br><span class="line">        self.frame = frame;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    CGFloat y = self.superview.frame.size.height - self.frame.size.height;</span><br><span class="line"></span><br><span class="line">    CGRect frame = self.frame;</span><br><span class="line">    frame.origin.y = y;</span><br><span class="line">    self.frame = frame;</span><br><span class="line"></span><br><span class="line">    CGFloat weight = frame.size.height / self.superview.frame.size.height;</span><br><span class="line">    UIColor * color = [UIColor colorWithHue:weight saturation:1 brightness:1 alpha:1];</span><br><span class="line">    self.backgroundColor = color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)updateHeight:(CGFloat)height</span><br><span class="line">&#123;</span><br><span class="line">    CGRect temp = self.frame;</span><br><span class="line">    temp.size.height = height;</span><br><span class="line">    self.frame = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;ç„¶åå†ç”Ÿæˆéšæœºæ•°æ•°ç»„å’Œ<code>sortView</code>æ•°ç»„ä¸€ä¸€å¯¹åº”ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - ç”Ÿæˆéšæœºæ•°æ•°ç»„</span><br><span class="line">- (void)setup_random</span><br><span class="line">&#123;</span><br><span class="line">    for (NSInteger i = 0 ; i &lt; self.count ; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        int height = (int)(SCREENHEIGHT - 200);</span><br><span class="line">        NSInteger random = arc4random() % height;</span><br><span class="line">        NSNumber * num = [NSNumber numberWithInteger:random];</span><br><span class="line">        [self.randomArray addObject:num];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (void)addSortViews</span><br><span class="line">&#123;</span><br><span class="line">    for (NSInteger i = 0 ; i &lt; self.count ; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        CGFloat width = SCREENWIDTH / self.count;</span><br><span class="line">        SortView * sortView = [[SortView alloc]initWithFrame:CGRectMake(i * width, 0, width, [self.randomArray[i] integerValue])];</span><br><span class="line">        [self.containerView addSubview:sortView];</span><br><span class="line">        [self.sortViewArray addObject:sortView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ’åºäº¤æ¢å›è°ƒ"><a href="#æ’åºäº¤æ¢å›è°ƒ" class="headerlink" title="æ’åºäº¤æ¢å›è°ƒ"></a>æ’åºäº¤æ¢å›è°ƒ</h3><p>&ensp;&ensp;&ensp;&ensp;ç„¶ååœ¨æ’åºç±»ï¼Œå®šä¹‰ä¸€ä¸ªå›è°ƒ<code>SortObjectBlock</code>ï¼Œç”¨äºæ›´æ–°è§†å›¾çš„é«˜åº¦ã€‚<code>index</code>å‚æ•°æ˜¯åœ¨æ•°ç»„çš„ç´¢å¼•å€¼ï¼Œ<code>value</code>æ˜¯ç´¢å¼•å€¼å¯¹åº”å…ƒç´ è¦ä¿®æ”¹çš„é«˜åº¦ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typedef void(^SortObjectBlock)(NSInteger index,NSNumber * value);</span><br><span class="line"></span><br><span class="line">@interface SortObject : NSObject</span><br><span class="line"></span><br><span class="line">@property (nonatomic,copy) SortObjectBlock sortObjectBlock;</span><br></pre></td></tr></table></figure></p><h3 id="é˜»å¡æ—¶é—´å®Œæˆè§†è§‰æ•ˆæœ"><a href="#é˜»å¡æ—¶é—´å®Œæˆè§†è§‰æ•ˆæœ" class="headerlink" title="é˜»å¡æ—¶é—´å®Œæˆè§†è§‰æ•ˆæœ"></a>é˜»å¡æ—¶é—´å®Œæˆè§†è§‰æ•ˆæœ</h3><p><code>SortObjectBlock</code>åœ¨æ’åºçš„æ—¶å€™ï¼Œæ¥æ”¶å›è°ƒ,ä¸ºäº†æ–¹é¢è§‚å¯Ÿæ’åºçš„å˜åŒ–ï¼Œæ¯æ¬¡æ•°ç»„ä¸­æœ‰å€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™é˜»å¡çº¿ç¨‹0.001sã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (void)sort</span><br><span class="line">&#123;</span><br><span class="line">    SortObject *  sortObject = [SortObject new];</span><br><span class="line">    __weak typeof(self) weakSelf = self;</span><br><span class="line">    sortObject.sortObjectBlock = ^(NSInteger index,NSNumber * value)&#123;</span><br><span class="line">        [NSThread sleepForTimeInterval:0.001];</span><br><span class="line">        [weakSelf updateSortViewWithIndex:index widthValue:value];</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - æ›´æ–°è§†å›¾</span><br><span class="line">- (void)updateSortViewWithIndex:(NSInteger)index widthValue:(NSNumber *)value</span><br><span class="line">&#123;</span><br><span class="line">    __weak typeof(self) weakSelf = self;</span><br><span class="line"></span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        SortView * sortView = (SortView *)[weakSelf.sortViewArray objectAtIndex:index];</span><br><span class="line">        [sortView updateHeight:[value integerValue]];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="8ç§ç®—æ³•"><a href="#8ç§ç®—æ³•" class="headerlink" title="8ç§ç®—æ³•"></a>8ç§ç®—æ³•</h2><h3 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - å†’æ³¡</span><br><span class="line">- (NSMutableArray *)sort0:(NSMutableArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    for (NSInteger i = 0 ; i &lt; array.count ; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        for (NSInteger j = 0 ; j &lt; i ; j ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            if (array[i] &lt; array[j])</span><br><span class="line">            &#123;</span><br><span class="line">                if (_sortObjectBlock)</span><br><span class="line">                &#123;</span><br><span class="line">                    _sortObjectBlock(i,array[j]);</span><br><span class="line">                    _sortObjectBlock(j,array[i]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                [array exchangeObjectAtIndex:i withObjectAtIndex:j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return array.copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - é€‰æ‹©æ’åº</span><br><span class="line">- (NSMutableArray *)sort1:(NSMutableArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    for (NSInteger i = 0 ; i &lt; array.count ; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        for (NSInteger j = i + 1 ; j &lt; array.count ; j ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            if (array[i] &gt; array[j])</span><br><span class="line">            &#123;</span><br><span class="line">                if (_sortObjectBlock)</span><br><span class="line">                &#123;</span><br><span class="line">                    _sortObjectBlock(i,array[j]);</span><br><span class="line">                    _sortObjectBlock(j,array[i]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                [array exchangeObjectAtIndex:i withObjectAtIndex:j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return array.copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#pragma mark - æ’å…¥æ’åº</span><br><span class="line">- (NSMutableArray *)sort2:(NSMutableArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    for (NSInteger i = 0 ; i &lt; array.count ; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        NSNumber * temp = array[i];</span><br><span class="line">        for (NSInteger j = i - 1 ; j &gt;= 0 &amp;&amp; temp &lt; array[j] ; j -- )</span><br><span class="line">        &#123;</span><br><span class="line">            if (_sortObjectBlock)</span><br><span class="line">            &#123;</span><br><span class="line">                _sortObjectBlock(j,array[j + 1]);</span><br><span class="line">                _sortObjectBlock(j + 1,array[j]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            [array exchangeObjectAtIndex:j withObjectAtIndex:j + 1];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return array.copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h3><p>&ensp;&ensp;&ensp;&ensp;å¿«é€Ÿæ’åºæ˜¯å¯¹å†’æ³¡æ’åºçš„ä¸€ç§æ”¹è¿›ï¼Œé€šè¿‡ä¸€è¶Ÿæ’åºå°†è¦æ’åºçš„æ•°æ®åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½æ¯”å¦å¤–ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½è¦å°ï¼Œç„¶åå†æŒ‰æ­¤æ–¹æ³•å¯¹è¿™ä¸¤éƒ¨åˆ†æ•°æ®åˆ†åˆ«è¿›è¡Œå¿«é€Ÿæ’åºï¼Œæ•´ä¸ªæ’åºè¿‡ç¨‹å¯ä»¥é€’å½’è¿›è¡Œï¼Œä»¥æ­¤è¾¾åˆ°æ•´ä¸ªæ•°æ®å˜æˆæœ‰åºåºåˆ—ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - å¿«é€Ÿæ’åº</span><br><span class="line"></span><br><span class="line">- (NSMutableArray *)sort3:(NSMutableArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    [self quickSort:array leftIndex:0 rightIndex:array.count - 1];</span><br><span class="line">    return array.copy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)quickSort:(NSMutableArray *)array leftIndex:(NSInteger)left rightIndex:(NSInteger)right</span><br><span class="line">&#123;</span><br><span class="line">    if (left &lt; right)</span><br><span class="line">    &#123;</span><br><span class="line">        NSInteger temp = [self getMiddleIndex:array leftIndex:left rightIndex:right];</span><br><span class="line">        //é€’å½’å‰åŠéƒ¨åˆ†</span><br><span class="line">        [self quickSort:array leftIndex:left rightIndex:temp - 1];</span><br><span class="line">        //é€’å½’ååŠéƒ¨åˆ†</span><br><span class="line">        [self quickSort:array leftIndex:temp + 1 rightIndex:right];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å°†æ•°ç»„ä»¥ç¬¬ä¸€ä¸ªå€¼ä¸ºå‡†åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå‰åŠéƒ¨åˆ†æ¯”è¯¥å€¼è¦å°ï¼ŒååŠéƒ¨åˆ†æ¯”è¯¥å€¼è¦å¤§</span><br><span class="line">- (NSInteger)getMiddleIndex:(NSMutableArray *)array leftIndex:(NSInteger)left rightIndex:(NSInteger)right</span><br><span class="line">&#123;</span><br><span class="line">    NSNumber * temp = array[left];</span><br><span class="line">    while (left &lt; right) &#123;</span><br><span class="line">        while (left &lt; right &amp;&amp; temp &lt;= array[right]) &#123;</span><br><span class="line">            right -- ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (left &lt; right)</span><br><span class="line">        &#123;</span><br><span class="line">            if (_sortObjectBlock)</span><br><span class="line">            &#123;</span><br><span class="line">                _sortObjectBlock(left,array[right]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            array[left] = array[right];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        while (left &lt; right &amp;&amp; array[left] &lt;= temp) &#123;</span><br><span class="line">            left ++ ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (left &lt; right)</span><br><span class="line">        &#123;</span><br><span class="line">            if (_sortObjectBlock)</span><br><span class="line">            &#123;</span><br><span class="line">                _sortObjectBlock(right,array[left]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            array[right] = array[left];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (_sortObjectBlock)</span><br><span class="line">    &#123;</span><br><span class="line">        _sortObjectBlock(left,temp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    array[left] = temp;</span><br><span class="line"></span><br><span class="line">    return left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h3><p>&ensp;&ensp;&ensp;&ensp;å¸Œå°”æ’åºåˆå«ç¼©å°å¢é‡æ’åºï¼Œå±äºæ’å…¥æ’åºçš„ä¸€ç§ã€‚æŠŠè®°å½•æŒ‰ä¸‹æ ‡çš„ä¸€å®šå¢é‡åˆ†ç»„ï¼Œå¯¹æ¯ç»„ä½¿ç”¨ç›´æ¥æ’å…¥æ’åºç®—æ³•æ’åºï¼›éšç€å¢é‡é€æ¸å‡å°‘ï¼Œæ¯ç»„åŒ…å«çš„å…³é”®è¯è¶Šæ¥è¶Šå¤šï¼Œå½“å¢é‡å‡è‡³1æ—¶ï¼Œæ•´ä¸ªæ–‡ä»¶æ°è¢«åˆ†æˆä¸€ç»„ï¼Œç®—æ³•ä¾¿ç»ˆæ­¢ã€‚è¿™é‡Œå–å¾—çš„å¢é‡ä¸ºä¸€åŠã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - å¸Œå°”æ’åº</span><br><span class="line">- (NSMutableArray *)sort4:(NSMutableArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    for (NSInteger increment = array.count / 2 ; increment &gt; 0 ; increment /= 2 )</span><br><span class="line">    &#123;</span><br><span class="line">        for (NSInteger i = increment ; i &lt; array.count ; i ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            NSInteger j = i ;</span><br><span class="line">            for (; j - increment &gt;= 0 &amp;&amp; array[j] &lt; array[j-increment]; j -= increment)</span><br><span class="line">            &#123;</span><br><span class="line">                if (_sortObjectBlock)</span><br><span class="line">                &#123;</span><br><span class="line">                    _sortObjectBlock(j,array[j - increment]);</span><br><span class="line">                    _sortObjectBlock(j - increment,array[j]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                [array exchangeObjectAtIndex:j withObjectAtIndex:(j - increment)];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return array.copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h3><p>&ensp;&ensp;&ensp;&ensp;å½’å¹¶æ’åºæ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•,è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—ï¼›å³å…ˆä½¿æ¯ä¸ªå­åºåˆ—æœ‰åºï¼Œå†ä½¿å­åºåˆ—æ®µé—´æœ‰åºã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - å½’å¹¶æ’åº</span><br><span class="line"></span><br><span class="line">- (NSMutableArray *)sort5:(NSMutableArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    [self megerSortWithArray:array];</span><br><span class="line">    return array.copy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)megerSortWithArray:(NSMutableArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableArray * tempArray = [NSMutableArray arrayWithCapacity:1];</span><br><span class="line">    //å°†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æ”¾å…¥ä¸€ä¸ªæ•°ç»„ä¸­</span><br><span class="line">    for (NSNumber * num in array)</span><br><span class="line">    &#123;</span><br><span class="line">        NSMutableArray * subArray = [NSMutableArray array];</span><br><span class="line">        [subArray addObject:num];</span><br><span class="line">        [tempArray addObject:subArray];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å¯¹è¿™ä¸ªæ•°ç»„ä¸­çš„æ•°ç»„è¿›è¡Œåˆå¹¶ï¼Œç›´åˆ°åˆå¹¶å®Œæ¯•ä¸ºæ­¢</span><br><span class="line">    while (tempArray.count != 1) &#123;</span><br><span class="line">        NSInteger i = 0 ;</span><br><span class="line">        while (i &lt; tempArray.count - 1) &#123;</span><br><span class="line">            //å°†tempArray[i] å’Œ tempArray[i+1]åˆå¹¶</span><br><span class="line">            tempArray[i] = [self mergeArrayFirstList:tempArray[i] secondList:tempArray[i + 1]];</span><br><span class="line">            [tempArray removeObjectAtIndex:(i + 1)];</span><br><span class="line">            </span><br><span class="line">            for (NSInteger subIndex = 0 ; subIndex &lt; [tempArray[i] count]; subIndex ++)</span><br><span class="line">            &#123;</span><br><span class="line">                NSInteger index = [self countEndIndex:i SubItemIndex:subIndex TempArray:tempArray];</span><br><span class="line">                if (_sortObjectBlock)</span><br><span class="line">                &#123;</span><br><span class="line">                    _sortObjectBlock(index,tempArray[i][subIndex]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            i ++ ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    array = tempArray[0];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å°†ä¸¤ä¸ªæœ‰åºæ•°ç»„è¿›è¡Œåˆå¹¶,è¿”å›ä¸€ä¸ªæ’åºå¥½çš„æ•°ç»„</span><br><span class="line">- (NSArray *)mergeArrayFirstList:(NSArray *)array1 secondList:(NSArray *)array2</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableArray * resultArray = [NSMutableArray array];</span><br><span class="line">    NSInteger firstIndex = 0;</span><br><span class="line">    NSInteger secondIndex = 0;</span><br><span class="line">    while (firstIndex &lt; array1.count &amp;&amp; secondIndex &lt; array2.count) &#123;</span><br><span class="line">        if ([array1[firstIndex] integerValue] &lt; [array2[secondIndex] integerValue])</span><br><span class="line">        &#123;</span><br><span class="line">            [resultArray addObject:array1[firstIndex]];</span><br><span class="line">            firstIndex ++ ;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            [resultArray addObject:array2[secondIndex]];</span><br><span class="line">            secondIndex ++ ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    while (firstIndex &lt; array1.count) &#123;</span><br><span class="line">        [resultArray addObject:array1[firstIndex]];</span><br><span class="line">        firstIndex ++ ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    while (secondIndex &lt; array2.count) &#123;</span><br><span class="line">        [resultArray addObject:array2[secondIndex]];</span><br><span class="line">        secondIndex ++ ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return resultArray.copy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSInteger)countEndIndex:(NSInteger)endIndex SubItemIndex:(NSInteger)subItemIndex TempArray:(NSMutableArray *)tempArray</span><br><span class="line">&#123;</span><br><span class="line">    NSInteger sum = 0 ;</span><br><span class="line">    for (NSInteger i = 0 ; i &lt; endIndex ; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        sum += [tempArray[i] count];</span><br><span class="line">    &#125;</span><br><span class="line">    return sum + subItemIndex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h3><p>&ensp;&ensp;&ensp;&ensp;å®ƒæ˜¯é€‰æ‹©æ’åºçš„ä¸€ç§ã€‚å¯ä»¥åˆ©ç”¨æ•°ç»„çš„ç‰¹ç‚¹å¿«é€Ÿå®šä½æŒ‡å®šç´¢å¼•çš„å…ƒç´ ã€‚å †åˆ†ä¸ºå¤§æ ¹å †å’Œå°æ ¹å †ï¼Œæ˜¯å®Œå…¨äºŒå‰æ ‘ã€‚å¤§æ ¹å †çš„è¦æ±‚æ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½ä¸å¤§äºå…¶çˆ¶èŠ‚ç‚¹çš„å€¼ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - å †æ’åº</span><br><span class="line">- (NSMutableArray *)sort6:(NSMutableArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    return [self heapSort:array];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (NSMutableArray *)heapSort:(NSMutableArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableArray * list = [NSMutableArray arrayWithArray:array];</span><br><span class="line">    NSInteger endIndex = array.count - 1;</span><br><span class="line">    //åˆ›å»ºå¤§é¡¶å † æŠŠarray è½¬æ¢ä¸ºå¤§é¡¶å †å±‚æ¬¡çš„éå†ç»“æœ</span><br><span class="line">    [self heapCreate:list];</span><br><span class="line"></span><br><span class="line">    while (endIndex &gt;= 0) &#123;</span><br><span class="line"></span><br><span class="line">        //äº¤æ¢å¤§é¡¶å †çš„æ”¶å°¾ä¸¤ä¸ªå€¼</span><br><span class="line">        if (_sortObjectBlock)</span><br><span class="line">        &#123;</span><br><span class="line">            _sortObjectBlock(0,list[endIndex]);</span><br><span class="line">            _sortObjectBlock(endIndex,list[0]);</span><br><span class="line"></span><br><span class="line">            [list exchangeObjectAtIndex:0 withObjectAtIndex:endIndex];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //ç¼©å°å¤§é¡¶å †çš„èŒƒå›´</span><br><span class="line">        endIndex -- ;</span><br><span class="line">        [self heapAdjast:list withStartIndex:0 withEndIndex:endIndex + 1];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//æ„å»ºå¤§é¡¶å †çš„å±‚æ¬¡éå†åºåˆ—</span><br><span class="line">- (void)heapCreate:(NSMutableArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    NSInteger i = array.count;</span><br><span class="line">    for (; i &gt; 0; i -- )</span><br><span class="line">    &#123;</span><br><span class="line">        [self heapAdjast:array withStartIndex:i - 1 withEndIndex:array.count];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å¯¹å¤§é¡¶å †çš„å±€éƒ¨è°ƒæ•´ï¼Œä½¿å…¶æ”¹èŠ‚ç‚¹çš„æ‰€æœ‰çˆ¶ç±»ç¬¦åˆå¤§é¡¶å †çš„ç‰¹ç‚¹</span><br><span class="line">- (void)heapAdjast:(NSMutableArray *)array withStartIndex:(NSInteger)startIndex withEndIndex:(NSInteger)endIndex</span><br><span class="line">&#123;</span><br><span class="line">    NSNumber * temp = array[startIndex];</span><br><span class="line">    //çˆ¶èŠ‚ç‚¹ä¸‹æ ‡</span><br><span class="line">    NSInteger fatherIndex = startIndex + 1;</span><br><span class="line">    //å·¦å­©å­ä¸‹æ ‡</span><br><span class="line">    NSInteger leftChildIndex = fatherIndex * 2;</span><br><span class="line">    while (leftChildIndex &lt;= endIndex) &#123;</span><br><span class="line">        //æ¯”è¾ƒå·¦å³èŠ‚ç‚¹ æ‰¾å‡ºè¾ƒå¤§çš„è§’æ ‡</span><br><span class="line">        if (leftChildIndex &lt; endIndex &amp;&amp; array[leftChildIndex - 1] &lt; array[leftChildIndex])</span><br><span class="line">        &#123;</span><br><span class="line">            leftChildIndex ++ ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //å¦‚æœè¾ƒå¤§çš„å­èŠ‚ç‚¹æ¯”æ ¹èŠ‚ç‚¹å¤§ èµ‹å€¼ä¸ºçˆ¶èŠ‚ç‚¹</span><br><span class="line">        if (temp &lt; array[leftChildIndex - 1])</span><br><span class="line">        &#123;</span><br><span class="line">            if (_sortObjectBlock)</span><br><span class="line">            &#123;</span><br><span class="line">                _sortObjectBlock(fatherIndex - 1,array[leftChildIndex - 1]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            array[fatherIndex - 1] = array[leftChildIndex - 1];</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            break ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fatherIndex = leftChildIndex;</span><br><span class="line">        leftChildIndex = fatherIndex * 2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (_sortObjectBlock)</span><br><span class="line">    &#123;</span><br><span class="line">        _sortObjectBlock(fatherIndex - 1,temp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    array[fatherIndex - 1] = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="åŸºæ•°æ’åº"><a href="#åŸºæ•°æ’åº" class="headerlink" title="åŸºæ•°æ’åº"></a>åŸºæ•°æ’åº</h3><p>&ensp;&ensp;&ensp;&ensp;å®ƒæ˜¯é€è¿‡é”®å€¼çš„éƒ¨ä»½èµ„è®¯ï¼Œå°†è¦æ’åºçš„å…ƒç´ åˆ†é…è‡³æŸäº›â€œæ¡¶â€ä¸­ï¼Œè—‰ä»¥è¾¾åˆ°æ’åºçš„ä½œç”¨ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - åŸºæ•°æ’åº</span><br><span class="line">- (NSMutableArray *)sort7:(NSMutableArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    [self radixSort:array];</span><br><span class="line">    return array.copy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)radixSort:(NSMutableArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    //åˆ›å»ºç©ºæ¡¶</span><br><span class="line">    NSMutableArray * bucket = [self createBucket];</span><br><span class="line"></span><br><span class="line">    //å¾…æ’æ•°ç»„çš„æœ€å¤§æ•°å€¼</span><br><span class="line">    NSNumber * maxNumber = [self listMaxItem:array];</span><br><span class="line"></span><br><span class="line">    //æœ€å¤§æ•°å€¼çš„æ•°å­—ä½æ•°</span><br><span class="line">    NSInteger maxLength = [self numberLength:maxNumber];</span><br><span class="line"></span><br><span class="line">    //æŒ‰ç…§ä»ä½ä½åˆ°é«˜ä½çš„é¡ºåºæ‰§è¡Œæ’åºè¿‡ç¨‹</span><br><span class="line">    for (NSInteger digit = 1 ; digit &lt;= maxLength ; digit ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        //å…¥æ¡¶</span><br><span class="line">        for (NSNumber * item in array)</span><br><span class="line">        &#123;</span><br><span class="line">            //ç¡®å®šitem å½’å±å“ªä¸ªæ¡¶ ä»¥digitä½æ•°ä¸ºåŸºæ•°</span><br><span class="line">            NSInteger baseNumber = [self fetchBaseNumber:item digit:digit];</span><br><span class="line">            NSMutableArray * mutArray = bucket[baseNumber];</span><br><span class="line">            //å°†æ•°æ®æ”¾å…¥ç©ºæ¡¶ä¸Š</span><br><span class="line">            [mutArray addObject:item];            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        NSInteger index = 0;</span><br><span class="line"></span><br><span class="line">        //å‡ºæ¡¶</span><br><span class="line">        for (NSInteger i = 0 ; i &lt; bucket.count ; i ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            NSMutableArray * subArray = bucket[i];</span><br><span class="line">            //å°†æ¡¶çš„æ•°æ®æ”¾å›å¾…æ’æ•°ç»„ä¸­</span><br><span class="line">            while (subArray.count != 0) &#123;</span><br><span class="line">                NSNumber * number = [subArray objectAtIndex:0];</span><br><span class="line"></span><br><span class="line">                if (_sortObjectBlock)</span><br><span class="line">                &#123;</span><br><span class="line">                    _sortObjectBlock(index,number);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                array[index] = number;</span><br><span class="line">                [subArray removeObjectAtIndex:0];</span><br><span class="line">                index ++ ;</span><br><span class="line">            &#125;            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//åˆ›å»ºç©ºæ¡¶</span><br><span class="line">- (NSMutableArray *)createBucket</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableArray * bucket = [NSMutableArray array];</span><br><span class="line">    for (NSInteger i = 0 ; i &lt; 10 ; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        NSMutableArray * array = [NSMutableArray array];</span><br><span class="line">        [bucket addObject:array];</span><br><span class="line">    &#125;</span><br><span class="line">    return bucket;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å–åˆ—è¡¨æœ€å¤§å€¼</span><br><span class="line">- (NSNumber *)listMaxItem:(NSArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    NSNumber * maxNumber = array[0];</span><br><span class="line">    for (NSNumber * number in array)</span><br><span class="line">    &#123;</span><br><span class="line">        if (maxNumber &lt; number)</span><br><span class="line">        &#123;</span><br><span class="line">            maxNumber = number;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return maxNumber;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//æ•°å­—çš„ä½æ•°</span><br><span class="line">- (NSInteger)numberLength:(NSNumber *)number</span><br><span class="line">&#123;</span><br><span class="line">    NSString * string = [NSString stringWithFormat:@&quot;%ld&quot;,(long)[number integerValue]];</span><br><span class="line">    return string.length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//number æ“ä½œçš„æ•°å­—  digit ä½æ•°  è¿”å›è¯¥ä½æ•°ä¸Šçš„æ•°å­—</span><br><span class="line">- (NSInteger)fetchBaseNumber:(NSNumber *)number digit:(NSInteger)digit</span><br><span class="line">&#123;</span><br><span class="line">    //digitä¸ºåŸºæ•°ä½æ•°</span><br><span class="line">    if (digit &gt; 0 &amp;&amp; digit &lt;= [self numberLength:number])</span><br><span class="line">    &#123;</span><br><span class="line">        NSMutableArray * numbersArray = [NSMutableArray array];</span><br><span class="line">        NSString * string = [NSString stringWithFormat:@&quot;%ld&quot;,[number integerValue]];</span><br><span class="line">        for (NSInteger index = 0 ; index &lt; [self numberLength:number] ; index ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            NSString * temp = [string substringWithRange:NSMakeRange(index, 1)];</span><br><span class="line">            [numbersArray addObject:temp];</span><br><span class="line">        &#125;</span><br><span class="line">        NSString * str = numbersArray[numbersArray.count - digit];</span><br><span class="line">        return [str integerValue];</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>å‚è€ƒ:<a href="https://www.cnblogs.com/ludashi/p/6065086.html" target="_blank" rel="noopener">iOSå¯è§†åŒ–åŠ¨æ€ç»˜åˆ¶å…«ç§æ’åºè¿‡ç¨‹(Swiftç‰ˆ)</a></strong></p><p><strong>æºç :<a href="https://github.com/iOS-Misaki/SortDemo">SortDemo</a></strong></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;å…ˆçœ‹å›¾ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿å±•ç¤ºgifå›¾ç‰‡ï¼Œåœ¨å†’æ³¡æ’åºã€é€‰æ‹©æ’åºã€æ’å…¥æ’åºï¼Œè§†å›¾æ›´æ–°åœç•™çš„æ—¶é—´è®¾ç½®ä¸º0.001ç§’ï¼Œå…¶ä»–æ’åºè®¾ç½®è§†å›¾æ›´æ–°æ—¶é—´ä¸º0.003ç§’ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>SDWebImage æºç æµ…æ</title>
    <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/04/11/SDWebImage-%E6%BA%90%E7%A0%81%E6%B5%85%E6%9E%90/"/>
    <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/04/11/SDWebImage-æºç æµ…æ/</id>
    <published>2018-04-11T03:49:26.000Z</published>
    <updated>2018-07-27T06:39:51.109Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;&ensp;&ensp;åœ¨iOSçš„å›¾ç‰‡åŠ è½½æ¡†æ¶ä¸­ï¼ŒSDWebImageå¯è°“æ˜¯å æ®å¤§åŠå£æ±Ÿå±±ã€‚å®ƒæ”¯æŒä»ç½‘ç»œä¸­ä¸‹è½½ä¸”ç¼“å­˜å›¾ç‰‡ï¼Œå¹¶è®¾ç½®å›¾ç‰‡åˆ°å¯¹åº”çš„UIImageViewæ§ä»¶æˆ–è€…UIButtonæ§ä»¶ã€‚åœ¨é¡¹ç›®ä¸­ä½¿ç”¨SDWebImageæ¥ç®¡ç†å›¾ç‰‡åŠ è½½ç›¸å…³æ“ä½œå¯ä»¥æå¤§åœ°æé«˜å¼€å‘æ•ˆç‡ï¼Œè®©æˆ‘ä»¬æ›´åŠ ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å®ç°ã€‚æœ¬ç¯‡æ–‡ç« ä¼šç€é‡è®²è§£<code>SDImageCache</code>ã€<code>SDWebImageDownloader</code>è¿™ä¸¤ä¸ªç±»ã€‚<br><a id="more"></a></p><p><img src="https://upload-images.jianshu.io/upload_images/1487718-7bd27225e029042f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="SDWebImageç±»å›¾.png"></p><h2 id="å›¾ç‰‡ä¸‹è½½"><a href="#å›¾ç‰‡ä¸‹è½½" class="headerlink" title="å›¾ç‰‡ä¸‹è½½"></a>å›¾ç‰‡ä¸‹è½½</h2><p>&ensp;&ensp;&ensp;&ensp;åœ¨<code>SDWebImage</code>ä¸­ï¼Œå›¾ç‰‡çš„ä¸‹è½½æ˜¯ç”±<code>SDWebImageDownloader</code>å®Œæˆçš„ã€‚<code>SDWebImageDownloader</code>æ˜¯ä¸ªå•ä¾‹ï¼Œå…ˆæ¥çœ‹ä¸‹è½½é€‰é¡¹ï¼Œ<code>SDWebImageDownloaderOptions</code>æšä¸¾ã€‚ä¸»è¦æ¶‰åŠåˆ°ä¸‹è½½çš„ä¼˜å…ˆçº§ã€ç¼“å­˜ã€åå°æ‰§è¡Œã€<code>cookies</code>è¿™äº›æ–¹é¢ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_OPTIONS(NSUInteger, SDWebImageDownloaderOptions) &#123;</span><br><span class="line">    SDWebImageDownloaderLowPriority = 1 &lt;&lt; 0,</span><br><span class="line">    SDWebImageDownloaderProgressiveDownload = 1 &lt;&lt; 1,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * é»˜è®¤è¯·æ±‚ä¸ä½¿ç”¨ç¼“å­˜</span><br><span class="line">    */</span><br><span class="line">    SDWebImageDownloaderUseNSURLCache = 1 &lt;&lt; 2,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * å¦‚æœå†²ç¼“å­˜ä¸­è¯»å–å›¾ç‰‡ï¼Œä½¿ç”¨nilæ¥ä¼ å‚å®Œæˆblock</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line">    SDWebImageDownloaderIgnoreCachedResponse = 1 &lt;&lt; 3,</span><br><span class="line">    /**</span><br><span class="line">    * åœ¨iOS 4.0ä»¥ä¸Šçš„ç³»ç»Ÿå¯ä»¥åå°ä¸‹è½½</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line">    SDWebImageDownloaderContinueInBackground = 1 &lt;&lt; 4,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * å¯ä»¥è‡ªå®šä¹‰ä¸‹è½½çš„cookies</span><br><span class="line">    */</span><br><span class="line">    SDWebImageDownloaderHandleCookies = 1 &lt;&lt; 5,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * å…è®¸ä¸å—ä¿¡ä»»çš„SSLè¯ä¹¦</span><br><span class="line">    */</span><br><span class="line">    SDWebImageDownloaderAllowInvalidSSLCertificates = 1 &lt;&lt; 6,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * å›¾ç‰‡ä¸‹è½½æ”¾åœ¨é«˜ä¼˜å…ˆçº§</span><br><span class="line">    */</span><br><span class="line">    SDWebImageDownloaderHighPriority = 1 &lt;&lt; 7,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>ä¸‹è½½é¡ºåºä¹Ÿå®šä¹‰äº†ä¸€ä¸ªæšä¸¾ï¼Œé»˜è®¤çš„æ˜¯é˜Ÿåˆ—çš„æ–¹å¼ï¼Œå…ˆè¿›å…ˆå‡ºï¼Œå¦ä¸€ç§æ˜¯å…ˆè¿›åå‡ºã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger, SDWebImageDownloaderExecutionOrder) &#123;</span><br><span class="line">    SDWebImageDownloaderFIFOExecutionOrder,</span><br><span class="line">    SDWebImageDownloaderLIFOExecutionOrder</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>å›¾ç‰‡ä¸‹è½½æ˜¯åœ¨<code>NSOperationQueue</code>é˜Ÿåˆ—ä¸­å®Œæˆçš„ï¼Œé»˜è®¤é˜Ÿåˆ—çš„æœ€å¤§å¹¶å‘æ•°6ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (assign, nonatomic) NSInteger maxConcurrentDownloads;</span><br></pre></td></tr></table></figure></p><p>ä¸‹è½½å›¾ç‰‡çš„æ“ä½œå¯¹åº”ä¸€äº›å›è°ƒï¼Œè¿›åº¦æ¡çš„å›è°ƒï¼Œä¸‹è½½å®Œæˆçš„å›è°ƒï¼Œ<code>header</code>è¿‡æ»¤ç­‰ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typedef void(^SDWebImageDownloaderProgressBlock)(NSInteger receivedSize, NSInteger expectedSize);</span><br><span class="line"></span><br><span class="line">typedef void(^SDWebImageDownloaderCompletedBlock)(UIImage *image, NSData *data, NSError *error, BOOL finished);</span><br><span class="line"></span><br><span class="line">typedef NSDictionary *(^SDWebImageDownloaderHeadersFilterBlock)(NSURL *url, NSDictionary *headers);</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (strong, nonatomic) NSMutableDictionary *URLCallbacks;</span><br></pre></td></tr></table></figure><p>&ensp;&ensp;&ensp;&ensp;åœ¨ä¸‹è½½å™¨çš„<code>URLCallbacks</code>å±æ€§ä¸­ï¼Œæ˜¯ä¸ªå¯å˜å­—å…¸ï¼Œ<code>key</code>æ˜¯å›¾ç‰‡çš„<code>url</code>,<code>value</code>æ˜¯ä¸ªæ•°ç»„ï¼Œå­˜æ”¾æ¯å¼ å›¾ç‰‡çš„å¤šç»„å›è°ƒä¿¡æ¯ã€‚ç”±äºå…è®¸å¤šä¸ªå›¾ç‰‡åŒæ—¶ä¸‹è½½ï¼Œæ‰€ä»¥ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ<code>URLCallbacks</code>ï¼Œæ‰€ä»¥æŠŠè¿™ä¸‹æ“ä½œéƒ½æ”¾åœ¨<code>GCD</code>çš„æ …æ é˜Ÿåˆ—ä¸­ï¼Œéš”ç¦»å¼€æ¥ï¼Œé¿å…çº¿ç¨‹çš„ä¸å®‰å…¨æ€§ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">- (void)addProgressCallback:(SDWebImageDownloaderProgressBlock)progressBlock andCompletedBlock:(SDWebImageDownloaderCompletedBlock)completedBlock forURL:(NSURL *)url createCallback:(SDWebImageNoParamsBlock)createCallback </span><br><span class="line">&#123;</span><br><span class="line">    // The URL will be used as the key to the callbacks dictionary so it cannot be nil. If it is nil immediately call the completed block with no image or data.</span><br><span class="line">    if (url == nil) </span><br><span class="line">    &#123;</span><br><span class="line">        if (completedBlock != nil)</span><br><span class="line">        &#123;</span><br><span class="line">            completedBlock(nil, nil, nil, NO);</span><br><span class="line">        &#125;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dispatch_barrier_sync(self.barrierQueue, ^&#123;</span><br><span class="line">        BOOL first = NO;</span><br><span class="line">        if (!self.URLCallbacks[url]) </span><br><span class="line">        &#123;</span><br><span class="line">            self.URLCallbacks[url] = [NSMutableArray new];</span><br><span class="line">            first = YES;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Handle single download of simultaneous download request for the same URL</span><br><span class="line">        NSMutableArray *callbacksForURL = self.URLCallbacks[url];</span><br><span class="line">        NSMutableDictionary *callbacks = [NSMutableDictionary new];</span><br><span class="line">        if (progressBlock) callbacks[kProgressCallbackKey] = [progressBlock copy];</span><br><span class="line">        if (completedBlock) callbacks[kCompletedCallbackKey] = [completedBlock copy];</span><br><span class="line">        [callbacksForURL addObject:callbacks];</span><br><span class="line">        self.URLCallbacks[url] = callbacksForURL;</span><br><span class="line"></span><br><span class="line">        if (first) </span><br><span class="line">        &#123;</span><br><span class="line">            createCallback();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;å›¾ç‰‡ä¸‹è½½å™¨ä¸‹è½½çš„æ—¶å€™æ”¾åœ¨<code>downloadImageWithURL:options:progress:completed:</code>æ–¹æ³•æ¥å¤„ç†çš„ï¼Œé‡Œé¢è°ƒç”¨åˆšæ‰æåˆ°çš„æ–¹æ³•ï¼ŒæŠŠè¯·æ±‚çš„ä¿¡æ¯å­˜å…¥ç®¡ç†å™¨ä¸­ï¼ŒåŒæ—¶åœ¨åˆ›å»ºå›è°ƒçš„<code>block</code>ä¸­åˆ›å»ºæ–°çš„æ“ä½œï¼Œé…ç½®åæ”¾å…¥<code>downloadQueue</code>çš„æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œæœ€åæ–¹æ³•è¿”å›æ–°åˆ›å»ºçš„æ“ä½œã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">- (id &lt;SDWebImageOperation&gt;)downloadImageWithURL:(NSURL *)url options:(SDWebImageDownloaderOptions)options progress:(SDWebImageDownloaderProgressBlock)progressBlock completed:(SDWebImageDownloaderCompletedBlock)completedBlock </span><br><span class="line">&#123;</span><br><span class="line">    __block SDWebImageDownloaderOperation *operation;</span><br><span class="line">    __weak __typeof(self)wself = self;</span><br><span class="line"></span><br><span class="line">    [self addProgressCallback:progressBlock andCompletedBlock:completedBlock forURL:url createCallback:^&#123;</span><br><span class="line">        NSTimeInterval timeoutInterval = wself.downloadTimeout;</span><br><span class="line">        if (timeoutInterval == 0.0) </span><br><span class="line">        &#123;</span><br><span class="line">            timeoutInterval = 15.0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼Œæ ¹æ®optionså‚æ•°è®¾ç½®å±æ€§</span><br><span class="line">        // ä¸ºäº†é¿å…æ½œåœ¨çš„é‡å¤ç¼“å­˜(NSURLCache + SDImageCache)ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®å‘ŠçŸ¥éœ€è¦ç¼“å­˜ï¼Œåˆ™ç¦ç”¨å›¾ç‰‡è¯·æ±‚çš„ç¼“å­˜æ“ä½œ</span><br><span class="line">        NSMutableURLRequest *request = [[NSMutableURLRequest alloc] initWithURL:url cachePolicy:(options &amp; SDWebImageDownloaderUseNSURLCache ? NSURLRequestUseProtocolCachePolicy : NSURLRequestReloadIgnoringLocalCacheData) timeoutInterval:timeoutInterval];</span><br><span class="line">        request.HTTPShouldHandleCookies = (options &amp; SDWebImageDownloaderHandleCookies);</span><br><span class="line">        request.HTTPShouldUsePipelining = YES;</span><br><span class="line">        if (wself.headersFilter) </span><br><span class="line">        &#123;</span><br><span class="line">            request.allHTTPHeaderFields = wself.headersFilter(url, [wself.HTTPHeaders copy]);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            request.allHTTPHeaderFields = wself.HTTPHeaders;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºSDWebImageDownloaderOperationï¼Œé…ç½®å‚æ•°ï¼ŒåŒ…æ‹¬æ˜¯å¦éœ€è¦è®¤è¯ã€ä¼˜å…ˆçº§</span><br><span class="line">        operation = [[wself.operationClass alloc] initWithRequest:request</span><br><span class="line">                                                          options:options</span><br><span class="line">                                                         progress:^(NSInteger receivedSize, NSInteger expectedSize) &#123;</span><br><span class="line"></span><br><span class="line">                                                        //ä»ç®¡ç†å™¨çš„callbacksForURLä¸­æ‰¾å‡ºURLæ‰€æœ‰çš„è¿›åº¦å¤„ç†å›è°ƒå¹¶è°ƒç”¨</span><br><span class="line">                                                        SDWebImageDownloader *sself = wself;</span><br><span class="line">                                                        if (!sself) return;</span><br><span class="line">                                                        __block NSArray *callbacksForURL;</span><br><span class="line">                                                        dispatch_sync(sself.barrierQueue, ^&#123;</span><br><span class="line">                                                            callbacksForURL = [sself.URLCallbacks[url] copy];</span><br><span class="line">                                                        &#125;);</span><br><span class="line">                                                        </span><br><span class="line">                                                        for (NSDictionary *callbacks in callbacksForURL) </span><br><span class="line">                                                        &#123;</span><br><span class="line">                                                            dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                                                                SDWebImageDownloaderProgressBlock callback = callbacks[kProgressCallbackKey];</span><br><span class="line">                                                                if (callback) callback(receivedSize, expectedSize);</span><br><span class="line">                                                            &#125;);</span><br><span class="line">                                                        &#125;</span><br><span class="line">                                                    &#125;</span><br><span class="line">                                                        completed:^(UIImage *image, NSData *data, NSError *error, BOOL finished) </span><br><span class="line">                                                        &#123;</span><br><span class="line">                                                            //ä»ç®¡ç†å™¨çš„callbacksForURLä¸­æ‰¾å‡ºè¯¥URLæ‰€æœ‰çš„è¿›åº¦å¤„ç†å›è°ƒå¹¶ä¸”è°ƒç”¨</span><br><span class="line">                                                            SDWebImageDownloader *sself = wself;</span><br><span class="line">                                                            if (!sself) return;</span><br><span class="line">                                                            __block NSArray *callbacksForURL;</span><br><span class="line">                                                            dispatch_barrier_sync(sself.barrierQueue, ^&#123;</span><br><span class="line">                                                                callbacksForURL = [sself.URLCallbacks[url] copy];</span><br><span class="line">                                                                //å®Œæˆåï¼Œå°†URLå¯¹åº”çš„å›è°ƒä¿¡æ¯ä»URLCallbacksä¸­åˆ é™¤</span><br><span class="line">                                                                if (finished) </span><br><span class="line">                                                                &#123;</span><br><span class="line">                                                                    [sself.URLCallbacks removeObjectForKey:url];</span><br><span class="line">                                                                &#125;</span><br><span class="line">                                                            &#125;);</span><br><span class="line">                                                            for (NSDictionary *callbacks in callbacksForURL) </span><br><span class="line">                                                            &#123;</span><br><span class="line">                                                                SDWebImageDownloaderCompletedBlock callback = callbacks[kCompletedCallbackKey];</span><br><span class="line">                                                                if (callback) callback(image, data, error, finished);</span><br><span class="line">                                                            &#125;</span><br><span class="line">                                                        &#125;</span><br><span class="line">                                                        cancelled:^&#123;</span><br><span class="line">                                                            //å–æ¶ˆæ“ä½œå°†è¯¥urlå¯¹åº”çš„å›è°ƒä¿¡æ¯ä»URLCallbacksä¸­åˆ é™¤</span><br><span class="line">                                                            SDWebImageDownloader *sself = wself;</span><br><span class="line">                                                            if (!sself) return;</span><br><span class="line">                                                            dispatch_barrier_async(sself.barrierQueue, ^&#123;</span><br><span class="line">                                                                [sself.URLCallbacks removeObjectForKey:url];</span><br><span class="line">                                                            &#125;);</span><br><span class="line">                                                        &#125;];</span><br><span class="line">        operation.shouldDecompressImages = wself.shouldDecompressImages;</span><br><span class="line"></span><br><span class="line">        if (wself.username &amp;&amp; wself.password) </span><br><span class="line">        &#123;</span><br><span class="line">            operation.credential = [NSURLCredential credentialWithUser:wself.username password:wself.password persistence:NSURLCredentialPersistenceForSession];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (options &amp; SDWebImageDownloaderHighPriority) </span><br><span class="line">        &#123;</span><br><span class="line">            operation.queuePriority = NSOperationQueuePriorityHigh;</span><br><span class="line">        &#125;</span><br><span class="line">        else if (options &amp; SDWebImageDownloaderLowPriority) </span><br><span class="line">        &#123;</span><br><span class="line">            operation.queuePriority = NSOperationQueuePriorityLow;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—downloadQueueä¸­</span><br><span class="line">        //æ ¹æ®ä¸‹è½½æšä¸¾çš„é¡ºåºæ¥ç¡®å®šé˜Ÿåˆ—çš„é¡ºåº</span><br><span class="line">        [wself.downloadQueue addOperation:operation];</span><br><span class="line">        if (wself.executionOrder == SDWebImageDownloaderLIFOExecutionOrder) </span><br><span class="line">        &#123;</span><br><span class="line">            // Emulate LIFO execution order by systematically adding new operations as last operation&apos;s dependency</span><br><span class="line">            [wself.lastAddedOperation addDependency:operation];</span><br><span class="line">            wself.lastAddedOperation = operation;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    return operation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸‹è½½æ“ä½œ<br><code>SDWebImage</code>å®šä¹‰äº†ä¸€ä¸ªåè®®<code>SDWebImageOperation</code>ï¼Œåè®®åªå£°æ˜äº†ä¸€ä¸ª<code>cancel</code>æ–¹æ³•ï¼Œç”¨äºå–æ¶ˆæ“ä½œã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@protocol SDWebImageOperation &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">- (void)cancel;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p><p><code>SDWebImageDownloaderOperation</code>åœ¨åˆ†ç±»ä¸­é‡‡ç”¨äº†<code>NSURLConnectionDataDelegate</code>åè®®ï¼Œå¹¶ä¸”å®ç°äº†è¯¥åè®®çš„ä¸€ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response;</span><br><span class="line">- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data;</span><br><span class="line">- (void)connectionDidFinishLoading:(NSURLConnection *)aConnection;</span><br><span class="line">- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error;</span><br><span class="line">- (NSCachedURLResponse *)connection:(NSURLConnection *)connection willCacheResponse:(NSCachedURLResponse *)cachedResponse;</span><br><span class="line">- (BOOL)connectionShouldUseCredentialStorage:(NSURLConnection __unused *)connection;</span><br><span class="line">- (void)connection:(NSURLConnection *)connection willSendRequestForAuthenticationChallenge:(NSURLAuthenticationChallenge *)challenge;</span><br></pre></td></tr></table></figure></p><p>é‡ç‚¹æ¥çœ‹<code>didReceiveData</code>æ–¹æ³•ï¼Œä¸»è¦ä»»åŠ¡æ˜¯æ¥æ”¶æ•°æ®ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    // é™„åŠ æ•°æ®</span><br><span class="line">    [self.imageData appendData:data];</span><br><span class="line"></span><br><span class="line">    if ((self.options &amp; SDWebImageDownloaderProgressiveDownload) &amp;&amp; self.expectedSize &gt; 0 &amp;&amp; self.completedBlock)</span><br><span class="line">    &#123;</span><br><span class="line">        // è·å–å·²ä¸‹è½½æ•°æ®æ€»å¤§å°</span><br><span class="line">        const NSInteger totalSize = self.imageData.length;</span><br><span class="line"></span><br><span class="line">        // æ›´æ–°æ•°æ®æº è¿™é‡Œè¦ä¼ å…¥æ‰€æœ‰çš„æ•°æ®ï¼Œè€Œä¸ä»…æ˜¯æ–°æ•°æ®</span><br><span class="line">        CGImageSourceRef imageSource = CGImageSourceCreateWithData((__bridge CFDataRef)self.imageData, NULL);</span><br><span class="line"></span><br><span class="line">        // ç¬¬ä¸€æ¬¡è·å–æ•°æ®æ—¶ï¼Œä»è¿™äº›æ•°æ®è·å–å›¾ç‰‡çš„é•¿ã€å®½ã€æ–¹å‘</span><br><span class="line">        if (width + height == 0) </span><br><span class="line">        &#123;</span><br><span class="line">            CFDictionaryRef properties = CGImageSourceCopyPropertiesAtIndex(imageSource, 0, NULL);</span><br><span class="line">            if (properties) </span><br><span class="line">            &#123;</span><br><span class="line">                NSInteger orientationValue = -1;</span><br><span class="line">                CFTypeRef val = CFDictionaryGetValue(properties, kCGImagePropertyPixelHeight);</span><br><span class="line">                if (val) CFNumberGetValue(val, kCFNumberLongType, &amp;height);</span><br><span class="line">                val = CFDictionaryGetValue(properties, kCGImagePropertyPixelWidth);</span><br><span class="line">                if (val) CFNumberGetValue(val, kCFNumberLongType, &amp;width);</span><br><span class="line">                val = CFDictionaryGetValue(properties, kCGImagePropertyOrientation);</span><br><span class="line">                if (val) CFNumberGetValue(val, kCFNumberNSIntegerType, &amp;orientationValue);</span><br><span class="line">                CFRelease(properties);</span><br><span class="line"></span><br><span class="line">                // åˆ¶åˆ°Core Graphicsçš„æ—¶å€™ï¼Œä¼šä¸¢å¤±æ–¹å‘ä¿¡æ¯ï¼Œæœ‰æ—¶å€™ç”±initWithCGIImageåˆ›å»ºçš„æ–¹å‘ä¼šä¸å¯¹ï¼Œæ‰€ä»¥åœ¨é‡Œé¢å…ˆä¿å­˜æ–¹å‘ä¿¡æ¯</span><br><span class="line">                orientation = [[self class] orientationFromPropertyValue:(orientationValue == -1 ? 1 : orientationValue)];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //å›¾ç‰‡è¿˜æ²¡æœ‰ä¸‹è½½å®Œæˆ</span><br><span class="line">        if (width + height &gt; 0 &amp;&amp; totalSize &lt; self.expectedSize) </span><br><span class="line">        &#123;</span><br><span class="line">            // ä½¿ç”¨ç°æœ‰çš„æ•°æ®åˆ›å»ºå›¾ç‰‡å¯¹è±¡ï¼Œå¦‚æœæ•°æ®ä¸­å­˜æœ‰å¤šå¼ å›¾ç‰‡ï¼Œå–ç¬¬ä¸€å¼ </span><br><span class="line"></span><br><span class="line">            #ifdef TARGET_OS_IPHONE</span><br><span class="line">            // iOSåªæ”¯æŒRGBé¢œè‰²ç©ºé—´ï¼Œæ‰€ä»¥åœ¨æ­¤å¯¹ä¸‹è½½ä¸‹æ¥çš„å›¾ç‰‡åšä¸ªé¢œè‰²ç©ºé—´è½¬æ¢å¤„ç†</span><br><span class="line">            if (partialImageRef) </span><br><span class="line">            &#123;</span><br><span class="line">                const size_t partialHeight = CGImageGetHeight(partialImageRef);</span><br><span class="line">                CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();</span><br><span class="line">                CGContextRef bmContext = CGBitmapContextCreate(NULL, width, height, 8, width * 4, colorSpace, kCGBitmapByteOrderDefault | kCGImageAlphaPremultipliedFirst);</span><br><span class="line">                CGColorSpaceRelease(colorSpace);</span><br><span class="line">                if (bmContext) </span><br><span class="line">                &#123;</span><br><span class="line">                    CGContextDrawImage(bmContext, (CGRect)&#123;.origin.x = 0.0f, .origin.y = 0.0f, .size.width = width, .size.height = partialHeight&#125;, partialImageRef);</span><br><span class="line">                    CGImageRelease(partialImageRef);</span><br><span class="line">                    partialImageRef = CGBitmapContextCreateImage(bmContext);</span><br><span class="line">                    CGContextRelease(bmContext);</span><br><span class="line">                &#125;   </span><br><span class="line">                else </span><br><span class="line">                &#123;</span><br><span class="line">                    CGImageRelease(partialImageRef);</span><br><span class="line">                    partialImageRef = nil;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            #endif</span><br><span class="line"></span><br><span class="line">            //å›¾ç‰‡çš„ç¼©æ”¾ã€è§£ç æ“ä½œ</span><br><span class="line">            if (partialImageRef) </span><br><span class="line">            &#123;</span><br><span class="line">                UIImage *image = [UIImage imageWithCGImage:partialImageRef scale:1 orientation:orientation];</span><br><span class="line">                NSString *key = [[SDWebImageManager sharedManager] cacheKeyForURL:self.request.URL];</span><br><span class="line">                UIImage *scaledImage = [self scaledImageForKey:key image:image];</span><br><span class="line">                if (self.shouldDecompressImages) </span><br><span class="line">                &#123;</span><br><span class="line">                    image = [UIImage decodedImageWithImage:scaledImage];</span><br><span class="line">                &#125;</span><br><span class="line">                else </span><br><span class="line">                &#123;</span><br><span class="line">                    image = scaledImage;</span><br><span class="line">                &#125;</span><br><span class="line">                CGImageRelease(partialImageRef);</span><br><span class="line">                dispatch_main_sync_safe(^&#123;</span><br><span class="line">                    if (self.completedBlock) </span><br><span class="line">                    &#123;</span><br><span class="line">                        self.completedBlock(image, nil, nil, NO);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);            </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CFRelease(imageSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (self.progressBlock) </span><br><span class="line">    &#123;</span><br><span class="line">        self.progressBlock(self.imageData.length, self.expectedSize);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>SDWebImageDownloaderOperation</code>ç»§æ‰¿è‡ª<code>NSOperation</code>ï¼Œæ²¡æœ‰å®ç°<code>main</code>æ–¹æ³•ã€‚è€Œæ˜¯é‡‡ç”¨<code>start</code>æ–¹æ³•ï¼Œæ–¹ä¾¿è‡ªå·±ç®¡ç†ä¸‹è½½ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">- (void)start </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    //ç®¡ç†ä¸‹è½½çŠ¶æ€ï¼Œå¦‚æœå·²å–æ¶ˆï¼Œåˆ™é‡ç½®å½“å‰ä¸‹è½½å¹¶è®¾ç½®å®ŒæˆçŠ¶æ€ä¸ºYES</span><br><span class="line">    @synchronized (self) </span><br><span class="line">    &#123;</span><br><span class="line">        if (self.isCancelled) </span><br><span class="line">        &#123;</span><br><span class="line">            self.finished = YES;</span><br><span class="line">            [self reset];</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #if TARGET_OS_IPHONE &amp;&amp; __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= __IPHONE_4_0</span><br><span class="line"></span><br><span class="line">        //å¦‚æœè®¾ç½®åå°æ‰§è¡Œï¼Œå°±åå°æ‰§è¡Œ</span><br><span class="line">        Class UIApplicationClass = NSClassFromString(@&quot;UIApplication&quot;);</span><br><span class="line">        BOOL hasApplication = UIApplicationClass &amp;&amp; [UIApplicationClass respondsToSelector:@selector(sharedApplication)];</span><br><span class="line">        if (hasApplication &amp;&amp; [self shouldContinueWhenAppEntersBackground]) </span><br><span class="line">        &#123;</span><br><span class="line">            __weak __typeof__ (self) wself = self;</span><br><span class="line">            UIApplication * app = [UIApplicationClass performSelector:@selector(sharedApplication)];</span><br><span class="line">            self.backgroundTaskId = [app beginBackgroundTaskWithExpirationHandler:^&#123;</span><br><span class="line">                __strong __typeof (wself) sself = wself;</span><br><span class="line"></span><br><span class="line">                if (sself) </span><br><span class="line">                &#123;</span><br><span class="line">                    [sself cancel];</span><br><span class="line"></span><br><span class="line">                    [app endBackgroundTask:sself.backgroundTaskId];</span><br><span class="line">                    sself.backgroundTaskId = UIBackgroundTaskInvalid;    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        #endif</span><br><span class="line"></span><br><span class="line">        self.executing = YES;</span><br><span class="line">        self.connection = [[NSURLConnection alloc] initWithRequest:self.request delegate:self startImmediately:NO];</span><br><span class="line">        self.thread = [NSThread currentThread];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [self.connection start];</span><br><span class="line"></span><br><span class="line">    if (self.connection) </span><br><span class="line">    &#123;</span><br><span class="line">        if (self.progressBlock) </span><br><span class="line">        &#123;</span><br><span class="line">            self.progressBlock(0, NSURLResponseUnknownLength);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //ä¸»çº¿ç¨‹æŠ›å‡ºä¸‹è½½å¼€å§‹é€šçŸ¥</span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            [[NSNotificationCenter defaultCenter] postNotificationName:SDWebImageDownloadStartNotification object:self];</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        //å¯åŠ¨run loop</span><br><span class="line">        if (floor(NSFoundationVersionNumber) &lt;= NSFoundationVersionNumber_iOS_5_1) </span><br><span class="line">        &#123;</span><br><span class="line">            // Make sure to run the runloop in our background thread so it can process downloaded data</span><br><span class="line">            // Note: we use a timeout to work around an issue with NSURLConnection cancel under iOS 5</span><br><span class="line">            //       not waking up the runloop, leading to dead threads (see https://github.com/rs/SDWebImage/issues/466)</span><br><span class="line">            CFRunLoopRunInMode(kCFRunLoopDefaultMode, 10, false);</span><br><span class="line">        &#125;</span><br><span class="line">        else </span><br><span class="line">        &#123;</span><br><span class="line">            CFRunLoopRun();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //å¦‚æœæœªå®Œæˆï¼Œåˆ™å–æ¶ˆè¿æ¥</span><br><span class="line">        if (!self.isFinished) </span><br><span class="line">        &#123;</span><br><span class="line">            [self.connection cancel];</span><br><span class="line">            [self connection:self.connection didFailWithError:[NSError errorWithDomain:NSURLErrorDomain code:NSURLErrorTimedOut userInfo:@&#123;NSURLErrorFailingURLErrorKey : self.request.URL&#125;]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else </span><br><span class="line">    &#123;</span><br><span class="line">        if (self.completedBlock) </span><br><span class="line">        &#123;</span><br><span class="line">            self.completedBlock(nil, nil, [NSError errorWithDomain:NSURLErrorDomain code:0 userInfo:@&#123;NSLocalizedDescriptionKey : @&quot;Connection can&apos;t be initialized&quot;&#125;], YES);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #if TARGET_OS_IPHONE &amp;&amp; __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= __IPHONE_4_0</span><br><span class="line">    Class UIApplicationClass = NSClassFromString(@&quot;UIApplication&quot;);</span><br><span class="line">    if(!UIApplicationClass || ![UIApplicationClass respondsToSelector:@selector(sharedApplication)]) </span><br><span class="line">    &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (self.backgroundTaskId != UIBackgroundTaskInvalid) </span><br><span class="line">    &#123;</span><br><span class="line">        UIApplication * app = [UIApplication performSelector:@selector(sharedApplication)];</span><br><span class="line">        [app endBackgroundTask:self.backgroundTaskId];</span><br><span class="line">        self.backgroundTaskId = UIBackgroundTaskInvalid;</span><br><span class="line">    &#125;</span><br><span class="line">    #endif</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;ä¸‹è½½å®Œæˆæˆ–è€…ä¸‹è½½å¤±è´¥åï¼Œéœ€è¦åœæ­¢å½“å‰çº¿ç¨‹çš„<code>run loop</code>ï¼Œæ¸…é™¤è¿æ¥ï¼Œå¹¶ä¸”æŠ›å‡ºä¸‹è½½åœæ­¢çš„é€šçŸ¥ã€‚å¦‚æœä¸‹è½½æˆåŠŸï¼Œå°±ä¼šå¤„ç†å®Œæ•´çš„å›¾ç‰‡æ•°æ®ï¼Œå¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾å’Œè§£å‹ç¼©æ“ä½œï¼Œæä¾›ç»™å®Œæˆå›è°ƒä½¿ç”¨ã€‚</p><h2 id="å›¾ç‰‡ç¼“å­˜"><a href="#å›¾ç‰‡ç¼“å­˜" class="headerlink" title="å›¾ç‰‡ç¼“å­˜"></a>å›¾ç‰‡ç¼“å­˜</h2><p>&ensp;&ensp;&ensp;&ensp;ç¼“å­˜çš„åŠŸèƒ½ç”±<code>SDImageCache</code>å®Œæˆï¼Œè´Ÿè´£å¤„ç†å†…å­˜ç¼“å­˜å’Œä¸€ä¸ªå¯é€‰çš„ç£ç›˜ç¼“å­˜ã€‚å…¶ä¸­ç£ç›˜ç¼“å­˜çš„å†™æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šå¡æ­»UIã€‚<br>&ensp;&ensp;&ensp;&ensp;åœ¨iOS ä¸­å†…å­˜ç¼“å­˜çš„æ˜¯ä½¿ç”¨<code>NSCacheå¯¹</code>è±¡æ¥å®ç°çš„ã€‚<code>NSCache</code>å’Œå­—å…¸ç±»ä¼¼ï¼Œå­˜å‚¨é”®å€¼å¯¹ã€‚ç£ç›˜ç¼“å­˜çš„å¤„ç†æ˜¯ä½¿ç”¨<code>NSFileManager</code>æ¥å®ç°çš„ï¼Œå›¾ç‰‡å­˜å‚¨çš„ä½ç½®ä½äº<code>Cache</code>æ–‡ä»¶å¤¹ï¼Œ<code>SDImageCache</code>å®šä¹‰äº†ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œæ¥å¼‚æ­¥å­˜å‚¨å›¾ç‰‡ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">@interface SDImageCache ()</span><br><span class="line"></span><br><span class="line">@property (strong, nonatomic) NSCache *memCache;</span><br><span class="line">@property (strong, nonatomic) NSString *diskCachePath;</span><br><span class="line">@property (strong, nonatomic) NSMutableArray *customPaths;</span><br><span class="line">@property (SDDispatchQueueSetterSementics, nonatomic) dispatch_queue_t ioQueue;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">- (id)initWithNamespace:(NSString *)ns diskCacheDirectory:(NSString *)directory </span><br><span class="line">&#123;</span><br><span class="line">    if ((self = [super init])) </span><br><span class="line">    &#123;</span><br><span class="line">        NSString *fullNamespace = [@&quot;com.hackemist.SDWebImageCache.&quot; stringByAppendingString:ns];</span><br><span class="line"></span><br><span class="line">        // initialise PNG signature data</span><br><span class="line">        kPNGSignatureData = [NSData dataWithBytes:kPNGSignatureBytes length:8];</span><br><span class="line"></span><br><span class="line">        // Create IO serial queue</span><br><span class="line">        _ioQueue = dispatch_queue_create(&quot;com.hackemist.SDWebImageCache&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"></span><br><span class="line">        // Init default values</span><br><span class="line">        _maxCacheAge = kDefaultCacheMaxCacheAge;</span><br><span class="line"></span><br><span class="line">        // Init the memory cache</span><br><span class="line">        _memCache = [[AutoPurgeCache alloc] init];</span><br><span class="line">        _memCache.name = fullNamespace;</span><br><span class="line"></span><br><span class="line">        // Init the disk cache</span><br><span class="line">        if (directory != nil) </span><br><span class="line">        &#123;</span><br><span class="line">            _diskCachePath = [directory stringByAppendingPathComponent:fullNamespace];</span><br><span class="line">        &#125;</span><br><span class="line">        else </span><br><span class="line">        &#123;</span><br><span class="line">            NSString *path = [self makeDiskCachePath:ns];</span><br><span class="line">            _diskCachePath = path;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Set decompression to YES</span><br><span class="line">        _shouldDecompressImages = YES;</span><br><span class="line"></span><br><span class="line">        // memory cache enabled</span><br><span class="line">        _shouldCacheImagesInMemory = YES;</span><br><span class="line"></span><br><span class="line">        // Disable iCloud</span><br><span class="line">        _shouldDisableiCloud = YES;</span><br><span class="line"></span><br><span class="line">        dispatch_sync(_ioQueue, ^&#123;</span><br><span class="line">            _fileManager = [NSFileManager new];</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        #if TARGET_OS_IPHONE</span><br><span class="line">        // Subscribe to app events</span><br><span class="line">        [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(clearMemory) name:UIApplicationDidReceiveMemoryWarningNotification object:nil];</span><br><span class="line"></span><br><span class="line">        [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(cleanDisk) name:UIApplicationWillTerminateNotification object:nil];</span><br><span class="line"></span><br><span class="line">        [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(backgroundCleanDisk) name:UIApplicationDidEnterBackgroundNotification object:nil];</span><br><span class="line">        </span><br><span class="line">        #endif</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;<code>SDImageCache</code>ä¸­æä¾›äº†å¾ˆå¤šæ–¹æ³•æ¥ç¼“å­˜ã€è·å–ã€ç§»é™¤å›¾ç‰‡ã€‚å¯¹äºå›¾ç‰‡ï¼Œæ–¹ä¾¿æ“ä½œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª<code>key</code>æ¥ç´¢å¼•å®ƒã€‚åœ¨å†…å­˜ä¸­ï¼ŒæŠŠå®ƒè®¾ç½®ä¸º<code>NSCache</code>ä¸­çš„<code>key</code>å€¼ï¼Œåœ¨ç£ç›˜ä¸­ï¼ŒæŠŠ<code>key</code>ä½œä¸ºå›¾ç‰‡çš„æ–‡ä»¶åã€‚è¿™ä¸ª<code>key</code>å°±æ˜¯å›¾ç‰‡çš„<code>url</code>ã€‚<br>å›¾ç‰‡çš„ç¼“å­˜æ“ä½œï¼Œè¯¥æ“ä½œä¼šåœ¨å†…å­˜ä¸­æ”¾ç½®ä¸€ä»½ç¼“å­˜ï¼Œè€Œå¦‚æœç¡®å®šéœ€è¦ç¼“å­˜åˆ°ç£ç›˜ï¼Œå°±é™ç£ç›˜ç¼“å­˜æ“ä½œä½œä¸ºä¸€ä¸ª<code>task</code>æ”¾åˆ°ä¸²è¡Œé˜Ÿåˆ—ä¸­å¤„ç†ï¼Œåœ¨iOSä¸­ï¼Œä¼šå…ˆæ£€æµ‹å›¾ç‰‡æ˜¯<code>PNG</code>è¿˜æ˜¯<code>JPEG</code>ï¼Œ<br>ç„¶åè½¬æ¢ä¸ºç›¸åº”çš„å›¾ç‰‡æ•°æ®ï¼Œæœ€åå°†æ•°æ®å†™å…¥ç£ç›˜ä¸­ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">- (void)storeImage:(UIImage *)image recalculateFromImage:(BOOL)recalculate imageData:(NSData *)imageData forKey:(NSString *)key toDisk:(BOOL)toDisk </span><br><span class="line">&#123;</span><br><span class="line">    if (!image || !key) </span><br><span class="line">    &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    // å†…å­˜ç¼“å­˜ï¼Œå­˜å…¥NSCacheä¸­ï¼ŒåŒæ—¶å­˜å…¥å›¾ç‰‡çš„æ¶ˆè€—å€¼</span><br><span class="line">    </span><br><span class="line">    if (self.shouldCacheImagesInMemory) </span><br><span class="line">    &#123;</span><br><span class="line">        NSUInteger cost = SDCacheCostForImage(image);</span><br><span class="line">        [self.memCache setObject:image forKey:key cost:cost];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (toDisk) </span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        //å¦‚æœç¡®å®šéœ€è¦ç£ç›˜ç¼“å­˜ï¼Œå°†ç¼“å­˜æ“ä½œä½œä¸ºä¸€ä¸ªä»»åŠ¡æ”¾å…¥ioQueueä¸­</span><br><span class="line">        dispatch_async(self.ioQueue, ^&#123;</span><br><span class="line">            NSData *data = imageData;</span><br><span class="line"></span><br><span class="line">            if (image &amp;&amp; (recalculate || !data)) </span><br><span class="line">            &#123;</span><br><span class="line">                #if TARGET_OS_IPHONE</span><br><span class="line">                // è¿™é‡Œéœ€è¦ç¡®å®šæ˜¯PNGè¿˜æ˜¯JPEGï¼ŒPNGå›¾ç‰‡å®¹æ˜“æ£€æµ‹ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªå”¯ä¸€ç­¾åã€‚PNGå›¾ç‰‡çš„å‰8ä¸ªå­—èŠ‚æ€»æ˜¯åŒ…å«ä»¥ä¸‹å€¼ï¼š 137 80 78 71 13 10 26 10</span><br><span class="line">                // åœ¨dataä¸ºnilçš„æƒ…å†µä¸‹å‡å®šå›¾ç‰‡ä¸ºPNGï¼Œä»¥é¿å…ä¸¢å¤±é€æ˜åº¦ã€‚è€Œå½“å›¾ç‰‡æœ‰æ•°æ®æ—¶ï¼Œä¼šæ£€æµ‹å‰ç¼€ï¼Œç¡®å®šå›¾ç‰‡çš„ç±»å‹</span><br><span class="line">                int alphaInfo = CGImageGetAlphaInfo(image.CGImage);</span><br><span class="line">                BOOL hasAlpha = !(alphaInfo == kCGImageAlphaNone || alphaInfo == kCGImageAlphaNoneSkipFirst ||alphaInfo == kCGImageAlphaNoneSkipLast);</span><br><span class="line">                BOOL imageIsPng = hasAlpha;</span><br><span class="line"></span><br><span class="line">                // But if we have an image data, we will look at the preffix</span><br><span class="line">                if ([imageData length] &gt;= [kPNGSignatureData length]) </span><br><span class="line">                &#123;</span><br><span class="line">                    imageIsPng = ImageDataHasPNGPreffix(imageData);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (imageIsPng) </span><br><span class="line">                &#123;</span><br><span class="line">                    data = UIImagePNGRepresentation(image);</span><br><span class="line">                &#125;</span><br><span class="line">                else </span><br><span class="line">                &#123;</span><br><span class="line">                    data = UIImageJPEGRepresentation(image, (CGFloat)1.0);</span><br><span class="line">                &#125;</span><br><span class="line">                #else</span><br><span class="line">                data = [NSBitmapImageRep representationOfImageRepsInArray:image.representations usingType: NSJPEGFileType properties:nil];</span><br><span class="line">                #endif</span><br><span class="line">            &#125;</span><br><span class="line">            //åˆ›å»ºç¼“å­˜æ–‡ä»¶å¹¶ä¸”å­˜å‚¨å›¾ç‰‡</span><br><span class="line">            if (data) </span><br><span class="line">            &#123;</span><br><span class="line">                if (![_fileManager fileExistsAtPath:_diskCachePath]) </span><br><span class="line">                &#123;</span><br><span class="line">                    [_fileManager createDirectoryAtPath:_diskCachePath withIntermediateDirectories:YES attributes:nil error:NULL];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                // get cache Path for image key</span><br><span class="line">                NSString *cachePathForKey = [self defaultCachePathForKey:key];</span><br><span class="line">                // transform to NSUrl</span><br><span class="line">                NSURL *fileURL = [NSURL fileURLWithPath:cachePathForKey];</span><br><span class="line"></span><br><span class="line">                [_fileManager createFileAtPath:cachePathForKey contents:data attributes:nil];</span><br><span class="line"></span><br><span class="line">                // disable iCloud backup</span><br><span class="line">                if (self.shouldDisableiCloud) </span><br><span class="line">                &#123;</span><br><span class="line">                    [fileURL setResourceValue:[NSNumber numberWithBool:YES] forKey:NSURLIsExcludedFromBackupKey error:nil];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å›¾ç‰‡æ˜¯é€šè¿‡æŒ‡å®šçš„<code>key</code>æ¥æŸ¥è¯¢ã€‚ä¸‹é¢åˆ†åˆ«ä¸ºå†…å­˜å’Œç£ç›˜æŸ¥è¯¢<code>key</code>çš„æ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (UIImage *)imageFromMemoryCacheForKey:(NSString *)key;</span><br><span class="line">- (UIImage *)imageFromDiskCacheForKey:(NSString *)key;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœåªæ˜¯æƒ³æŸ¥çœ‹æœ¬åœ°æ˜¯å¦å­˜åœ¨<code>key</code>æŒ‡å®šçš„å›¾ç‰‡ï¼Œä¸ç®¡æ˜¯åœ¨ç£ç›˜ä¸Šè¿˜æ˜¯å†…å­˜ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">- (NSOperation *)queryDiskCacheForKey:(NSString *)key done:(SDWebImageQueryCompletedBlock)doneBlock </span><br><span class="line">&#123;</span><br><span class="line">    if (!doneBlock) </span><br><span class="line">    &#123;</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (!key) </span><br><span class="line">    &#123;</span><br><span class="line">        doneBlock(nil, SDImageCacheTypeNone);</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // é¦–å…ˆæŸ¥çœ‹å†…å­˜ç¼“å­˜ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œç›´æ¥å›è°ƒdoneBlockè¿”å›</span><br><span class="line">    UIImage *image = [self imageFromMemoryCacheForKey:key];</span><br><span class="line">    if (image) </span><br><span class="line">    &#123;</span><br><span class="line">        doneBlock(image, SDImageCacheTypeMemory);</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å†…å­˜ä¸­æ²¡æœ‰ï¼Œå»ç£ç›˜æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œå°†å…¶æ”¾åˆ°å†…å­˜ç¼“å­˜ä¸­ï¼Œå›è°ƒdoneBlockè¿”å›</span><br><span class="line">    NSOperation *operation = [NSOperation new];</span><br><span class="line">    dispatch_async(self.ioQueue, ^&#123;</span><br><span class="line">        if (operation.isCancelled) </span><br><span class="line">        &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @autoreleasepool &#123;</span><br><span class="line">            UIImage *diskImage = [self diskImageForKey:key];</span><br><span class="line">            if (diskImage &amp;&amp; self.shouldCacheImagesInMemory) </span><br><span class="line">            &#123;</span><br><span class="line">                NSUInteger cost = SDCacheCostForImage(diskImage);</span><br><span class="line">                [self.memCache setObject:diskImage forKey:key cost:cost];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                doneBlock(diskImage, SDImageCacheTypeDisk);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return operation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;æ¸…ç†ç¼“å­˜æœ‰ä¸¤ä¸ªæ–¹æ³•ã€‚å¯ä»¥åˆ†ä¸ºå®Œå…¨æ¸…ç©ºå’Œéƒ¨åˆ†æ¸…ç†ã€‚å®Œå…¨æ¸…ç©ºæ˜¯ç›´æ¥æŠŠç¼“å­˜çš„æ–‡ä»¶å¤¹ç§»é™¤ï¼Œéƒ¨åˆ†æ¸…ç†å¯ä»¥è®¾ç½®å‚æ•°æ¥ç§»é™¤æ–‡ä»¶ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)clearDisk;</span><br><span class="line">- (void)cleanDiskWithCompletionBlock:(SDWebImageNoParamsBlock)completionBlock;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;éƒ¨åˆ†æ¸…ç†å¯ä»¥è®¾ç½®å‚æ•°æ¥ç§»é™¤æ–‡ä»¶ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæŒ‡æ ‡ï¼šæ–‡ä»¶çš„ç¼“å­˜æœ‰æ•ˆæœŸå’Œæœ€å¤§ç¼“å­˜ç©ºé—´å¤§å°ï¼Œç¼“å­˜çš„æœ‰æ•ˆæœŸé€šè¿‡<code>maxCacheAge</code>è®¾ç½®ï¼Œé»˜è®¤<br>ä¸€å‘¨æ—¶é—´ã€‚å¦‚æœæ–‡ä»¶çš„çš„ç¼“å­˜æ—¶é—´è¶…è¿‡è¿™ä¸ªæ—¶é—´å€¼ï¼Œåˆ™å°†å…¶ç§»é™¤ã€‚æœ€å¤§ç¼“å­˜ç©ºé—´é€šè¿‡<code>maxCacheSize</code>å±æ€§è®¾ç½®ï¼Œå¦‚æœæ‰€æœ‰ç¼“å­˜æ–‡ä»¶çš„æ€»å¤§å°è¶…è¿‡<br>è¿™ä¸ªå¤§å°ï¼Œä¼šæŒ‰ç…§æ–‡ä»¶æœ€åä¿®æ”¹çš„æ—¶é—´çš„é€†åºï¼Œæ¯æ¬¡ä¸€åŠçš„é€’å½’æ¥ç§»é™¤è¿‡æ—©çš„æ–‡ä»¶ï¼Œä¸€ç›´åˆ°ç¼“å­˜çš„å®é™…å¤§å°å°äºè®¾ç½®çš„æœ€å¤§ä½¿ç”¨ç©ºé—´ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">- (void)cleanDiskWithCompletionBlock:(SDWebImageNoParamsBlock)completionBlock </span><br><span class="line">&#123;</span><br><span class="line">    dispatch_async(self.ioQueue, ^&#123;</span><br><span class="line">        NSURL *diskCacheURL = [NSURL fileURLWithPath:self.diskCachePath isDirectory:YES];</span><br><span class="line">        NSArray *resourceKeys = @[NSURLIsDirectoryKey, NSURLContentModificationDateKey, NSURLTotalFileAllocatedSizeKey];</span><br><span class="line"></span><br><span class="line">        // æšä¸¾å™¨å…ˆè·å–ç¼“å­˜æ–‡ä»¶çš„æœ‰ç”¨å±æ€§</span><br><span class="line">        NSDirectoryEnumerator *fileEnumerator = [_fileManager enumeratorAtURL:diskCacheURL includingPropertiesForKeys:resourceKeys options:NSDirectoryEnumerationSkipsHiddenFiles errorHandler:NULL];</span><br><span class="line"></span><br><span class="line">        NSDate *expirationDate = [NSDate dateWithTimeIntervalSinceNow:-self.maxCacheAge];</span><br><span class="line">        NSMutableDictionary *cacheFiles = [NSMutableDictionary dictionary];</span><br><span class="line">        NSUInteger currentCacheSize = 0;</span><br><span class="line"></span><br><span class="line">        // æšä¸¾ç¼“å­˜æ–‡ä»¶ä¸­æ‰€æœ‰çš„æ–‡ä»¶å¤¹ï¼Œç§»é™¤æ¯”è¿‡æœŸæ—¥æœŸæ›´æ—©çš„æ–‡ä»¶ï¼Œè¿˜æœ‰å­˜å‚¨æ–‡ä»¶å±æ€§æ–¹ä¾¿åé¢æ‰§è¡ŒåŸºäºç¼“å­˜å¤§å°çš„æ¸…ç†æ“ä½œ</span><br><span class="line">        NSMutableArray *urlsToDelete = [[NSMutableArray alloc] init];</span><br><span class="line">        for (NSURL *fileURL in fileEnumerator) </span><br><span class="line">        &#123;</span><br><span class="line">            NSDictionary *resourceValues = [fileURL resourceValuesForKeys:resourceKeys error:NULL];</span><br><span class="line"></span><br><span class="line">            // è·³è¿‡æ–‡ä»¶å¤¹</span><br><span class="line">            if ([resourceValues[NSURLIsDirectoryKey] boolValue]) </span><br><span class="line">            &#123;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // ç§»é™¤æ—©äºè¿‡æœŸæ—¥æœŸçš„æ–‡ä»¶</span><br><span class="line">            NSDate *modificationDate = resourceValues[NSURLContentModificationDateKey];</span><br><span class="line">            if ([[modificationDate laterDate:expirationDate] isEqualToDate:expirationDate]) </span><br><span class="line">            &#123;</span><br><span class="line">                [urlsToDelete addObject:fileURL];</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // è®¡ç®—å­˜å‚¨æ–‡ä»¶çš„æ€»å¤§å°</span><br><span class="line">            NSNumber *totalAllocatedSize = resourceValues[NSURLTotalFileAllocatedSizeKey];</span><br><span class="line">            currentCacheSize += [totalAllocatedSize unsignedIntegerValue];</span><br><span class="line">            [cacheFiles setObject:resourceValues forKey:fileURL];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for (NSURL *fileURL in urlsToDelete) </span><br><span class="line">        &#123;</span><br><span class="line">            [_fileManager removeItemAtURL:fileURL error:nil];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // å¦‚æœç£ç›˜ç¼“å­˜çš„å¤§å°å¤§äºé…ç½®å€¼ï¼Œåˆ™æ‰§è¡ŒåŸºäºæ–‡ä»¶å¤§å°çš„æ¸…ç†ï¼Œé¦–å…ˆåˆ é™¤æœ€æ—©çš„æ–‡ä»¶</span><br><span class="line">        if (self.maxCacheSize &gt; 0 &amp;&amp; currentCacheSize &gt; self.maxCacheSize) </span><br><span class="line">        &#123;</span><br><span class="line">            // é€’å½’è®¾ç½®æœ€å¤§ç¼“å­˜çš„ä¸€åŠä½œä¸ºæ¸…ç†ç›®æ ‡</span><br><span class="line">            const NSUInteger desiredCacheSize = self.maxCacheSize / 2;</span><br><span class="line"></span><br><span class="line">            // æŒ‰ç…§æœ€åä¿®æ”¹æ—¶é—´æ¥æ’åºå‰©ä¸‹çš„ç¼“å­˜æ–‡ä»¶</span><br><span class="line">            NSArray *sortedFiles = [cacheFiles keysSortedByValueWithOptions:NSSortConcurrent usingComparator:^NSComparisonResult(id obj1, id obj2) </span><br><span class="line">            &#123;</span><br><span class="line">                return [obj1[NSURLContentModificationDateKey] compare:obj2[NSURLContentModificationDateKey]];</span><br><span class="line">            &#125;];</span><br><span class="line"></span><br><span class="line">            // åˆ é™¤æ–‡ä»¶çŸ¥é“æ»¡è¶³æœŸæœ›å€¼</span><br><span class="line">            for (NSURL *fileURL in sortedFiles) </span><br><span class="line">            &#123;</span><br><span class="line">                if ([_fileManager removeItemAtURL:fileURL error:nil]) </span><br><span class="line">                &#123;</span><br><span class="line">                    NSDictionary *resourceValues = cacheFiles[fileURL];</span><br><span class="line">                    NSNumber *totalAllocatedSize = resourceValues[NSURLTotalFileAllocatedSizeKey];</span><br><span class="line">                    currentCacheSize -= [totalAllocatedSize unsignedIntegerValue];</span><br><span class="line"></span><br><span class="line">                    if (currentCacheSize &lt; desiredCacheSize) </span><br><span class="line">                    &#123;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (completionBlock) </span><br><span class="line">        &#123;</span><br><span class="line">            dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                completionBlock();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä¸ä¼šç›´æ¥ä½¿ç”¨<code>SDWebImageDownloader</code>å’Œ<code>SDImageCache</code>æ¥æ‰§è¡Œå›¾ç‰‡çš„ä¸‹è½½å’Œç¼“å­˜ï¼Œ<code>SDWebImage</code>æä¾›äº†<code>SDWebImageManager</code>æ¥ç®¡ç†å›¾ç‰‡çš„<br>ä¸‹è½½å’Œç¼“å­˜ï¼Œè¿™ä¸ªå¯¹è±¡çš„<code>delegate</code>å£°æ˜äº†ä¸¤ä¸ªå¯é€‰çš„æ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@property (strong, nonatomic, readwrite) SDImageCache *imageCache;</span><br><span class="line">@property (strong, nonatomic, readwrite) SDWebImageDownloader *imageDownloader;</span><br><span class="line"></span><br><span class="line">@protocol SDWebImageManagerDelegate &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">@optional</span><br><span class="line"></span><br><span class="line">//æ§åˆ¶å½“å›¾ç‰‡åœ¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°æ—¶ï¼Œåº”è¯¥ä¸‹è½½å“ªä¸ªå›¾ç‰‡</span><br><span class="line">- (BOOL)imageManager:(SDWebImageManager *)imageManager shouldDownloadImageForURL:(NSURL *)imageURL;</span><br><span class="line"></span><br><span class="line">//å›¾ç‰‡ä¸‹è½½å®Œæˆæ—¶ï¼Œä¸”è¢«ç¼“å­˜åˆ°å†…å­˜æˆ–è€…ç£ç›˜å‰ç«‹å³è½¬æ¢</span><br><span class="line">- (UIImage *)imageManager:(SDWebImageManager *)imageManager transformDownloadedImage:(UIImage *)image withURL:(NSURL *)imageURL;</span><br></pre></td></tr></table></figure></p><p>æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªæ–¹æ³•æ€ä¹ˆè°ƒç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line">- (id &lt;SDWebImageOperation&gt;)downloadImageWithURL:(NSURL *)url options:(SDWebImageOptions)options progress (SDWebImageDownloaderProgressBlock)progressBlock completed:(SDWebImageCompletionWithFinishedBlock)completedBlock </span><br><span class="line">&#123;</span><br><span class="line">    // åˆ¤æ–­urlçš„åˆæ³•æ€§</span><br><span class="line">    if ([url isKindOfClass:NSString.class]) </span><br><span class="line">    &#123;</span><br><span class="line">        url = [NSURL URLWithString:(NSString *)url];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Prevents app crashing on argument type error like sending NSNull instead of NSURL</span><br><span class="line">    </span><br><span class="line">    if (![url isKindOfClass:NSURL.class]) </span><br><span class="line">    &#123;</span><br><span class="line">        url = nil;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //åˆ›å»ºSDWebImageCombinedOperationå¯¹è±¡</span><br><span class="line">    __block SDWebImageCombinedOperation *operation = [SDWebImageCombinedOperation new];</span><br><span class="line">    __weak SDWebImageCombinedOperation *weakOperation = operation;</span><br><span class="line"></span><br><span class="line">    //åˆ¤æ–­æ˜¯å¦ä¸‹è½½å¤±è´¥è¿‡</span><br><span class="line">    BOOL isFailedUrl = NO;</span><br><span class="line">    @synchronized (self.failedURLs) &#123;</span><br><span class="line">        isFailedUrl = [self.failedURLs containsObject:url];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //ç©ºURLæˆ–è€…åœ¨ä¸å¯é‡è¯•æƒ…å†µä¸‹ä¸”æ˜¯ä¸ªä¸‹è½½å¤±è´¥è¿‡çš„URL ï¼Œç›´æ¥è¿”å›æ“ä½œ</span><br><span class="line">    if (url.absoluteString.length == 0 || (!(options &amp; SDWebImageRetryFailed) &amp;&amp; isFailedUrl)) </span><br><span class="line">    &#123;</span><br><span class="line">        dispatch_main_sync_safe(^&#123;</span><br><span class="line">            NSError *error = [NSError errorWithDomain:NSURLErrorDomain code:NSURLErrorFileDoesNotExist userInfo:nil];</span><br><span class="line">            completedBlock(nil, error, SDImageCacheTypeNone, YES, url);</span><br><span class="line">        &#125;);</span><br><span class="line">        return operation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @synchronized (self.runningOperations) &#123;</span><br><span class="line">        [self.runningOperations addObject:operation];</span><br><span class="line">    &#125;</span><br><span class="line">    NSString *key = [self cacheKeyForURL:url];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //ä¸‹è½½</span><br><span class="line">    operation.cacheOperation = [self.imageCache queryDiskCacheForKey:key done:^(UIImage *image, SDImageCacheType cacheType) </span><br><span class="line">    &#123;</span><br><span class="line">        if (operation.isCancelled) </span><br><span class="line">        &#123;</span><br><span class="line">            @synchronized (self.runningOperations) &#123;</span><br><span class="line">                [self.runningOperations removeObject:operation];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if ((!image || options &amp; SDWebImageRefreshCached) &amp;&amp; (![self.delegate respondsToSelector:@selector(imageManager:shouldDownloadImageForURL:)] || [self.delegate imageManager:self shouldDownloadImageForURL:url]))</span><br><span class="line">        &#123;</span><br><span class="line">            if (image &amp;&amp; options &amp; SDWebImageRefreshCached) </span><br><span class="line">            &#123;</span><br><span class="line">                dispatch_main_sync_safe(^&#123;</span><br><span class="line">                    // If image was found in the cache but SDWebImageRefreshCached is provided, notify about the cached image</span><br><span class="line">                    // AND try to re-download it in order to let a chance to NSURLCache to refresh it from server.</span><br><span class="line">                    completedBlock(image, nil, cacheType, YES, url);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // download if no image or requested to refresh anyway, and download allowed by delegate</span><br><span class="line">            SDWebImageDownloaderOptions downloaderOptions = 0;</span><br><span class="line">            if (options &amp; SDWebImageLowPriority) downloaderOptions |= SDWebImageDownloaderLowPriority;</span><br><span class="line">            if (options &amp; SDWebImageProgressiveDownload) downloaderOptions |= SDWebImageDownloaderProgressiveDownload;</span><br><span class="line">            if (options &amp; SDWebImageRefreshCached) downloaderOptions |= SDWebImageDownloaderUseNSURLCache;</span><br><span class="line">            if (options &amp; SDWebImageContinueInBackground) downloaderOptions |= SDWebImageDownloaderContinueInBackground;</span><br><span class="line">            if (options &amp; SDWebImageHandleCookies) downloaderOptions |= SDWebImageDownloaderHandleCookies;</span><br><span class="line">            if (options &amp; SDWebImageAllowInvalidSSLCertificates) downloaderOptions |= SDWebImageDownloaderAllowInvalidSSLCertificates;</span><br><span class="line">            if (options &amp; SDWebImageHighPriority) downloaderOptions |= SDWebImageDownloaderHighPriority;</span><br><span class="line">            if (image &amp;&amp; options &amp; SDWebImageRefreshCached) </span><br><span class="line">            &#123;</span><br><span class="line">                // force progressive off if image already cached but forced refreshing</span><br><span class="line">                downloaderOptions &amp;= ~SDWebImageDownloaderProgressiveDownload;</span><br><span class="line">                // ignore image read from NSURLCache if image if cached but force refreshing</span><br><span class="line">                downloaderOptions |= SDWebImageDownloaderIgnoreCachedResponse;</span><br><span class="line">            &#125;</span><br><span class="line">            id &lt;SDWebImageOperation&gt; subOperation = [self.imageDownloader downloadImageWithURL:url options:downloaderOptions progress:progressBlock completed:^(UIImage *downloadedImage, NSData *data, NSError *error, BOOL finished) </span><br><span class="line">            &#123;</span><br><span class="line">                if (weakOperation.isCancelled) </span><br><span class="line">                &#123;</span><br><span class="line">                    // Do nothing if the operation was cancelled</span><br><span class="line">                    // See #699 for more details</span><br><span class="line">                    // if we would call the completedBlock, there could be a race condition between this block and another completedBlock for the same object, so if this one is called second, we will overwrite the new data</span><br><span class="line">                &#125;</span><br><span class="line">                else if (error) </span><br><span class="line">                &#123;</span><br><span class="line">                    dispatch_main_sync_safe(^&#123;</span><br><span class="line">                        if (!weakOperation.isCancelled) </span><br><span class="line">                        &#123;</span><br><span class="line">                            completedBlock(nil, error, SDImageCacheTypeNone, finished, url);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                    if (error.code != NSURLErrorNotConnectedToInternet &amp;&amp; error.code != NSURLErrorCancelled &amp;&amp; error.code != NSURLErrorTimedOut &amp;&amp; error.code != NSURLErrorInternationalRoamingOff &amp;&amp; error.code != NSURLErrorDataNotAllowed &amp;&amp; error.code != NSURLErrorCannotFindHost &amp;&amp; error.code != NSURLErrorCannotConnectToHost) </span><br><span class="line">                    &#123;</span><br><span class="line">                        @synchronized (self.failedURLs) &#123;</span><br><span class="line">                            [self.failedURLs addObject:url];</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                else </span><br><span class="line">                &#123;</span><br><span class="line">                    if ((options &amp; SDWebImageRetryFailed)) </span><br><span class="line">                    &#123;</span><br><span class="line">                        @synchronized (self.failedURLs) &#123;</span><br><span class="line">                            [self.failedURLs removeObject:url];</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    BOOL cacheOnDisk = !(options &amp; SDWebImageCacheMemoryOnly);</span><br><span class="line"></span><br><span class="line">                    if (options &amp; SDWebImageRefreshCached &amp;&amp; image &amp;&amp; !downloadedImage) </span><br><span class="line">                    &#123;</span><br><span class="line">                        // Image refresh hit the NSURLCache cache, do not call the completion block</span><br><span class="line">                    &#125;</span><br><span class="line">                    else if (downloadedImage &amp;&amp; (!downloadedImage.images || (options &amp; SDWebImageTransformAnimatedImage)) &amp;&amp; [self.delegate respondsToSelector:@selector(imageManager:transformDownloadedImage:withURL:)]) </span><br><span class="line">                    &#123;</span><br><span class="line">                        dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^&#123;</span><br><span class="line">                            UIImage *transformedImage = [self.delegate imageManager:self transformDownloadedImage:downloadedImage withURL:url];</span><br><span class="line"></span><br><span class="line">                            if (transformedImage &amp;&amp; finished) </span><br><span class="line">                            &#123;</span><br><span class="line">                                BOOL imageWasTransformed = ![transformedImage isEqual:downloadedImage];</span><br><span class="line">                                [self.imageCache storeImage:transformedImage recalculateFromImage:imageWasTransformed imageData:(imageWasTransformed ? nil : data) forKey:key toDisk:cacheOnDisk];</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            dispatch_main_sync_safe(^&#123;</span><br><span class="line">                                if (!weakOperation.isCancelled) </span><br><span class="line">                                &#123;</span><br><span class="line">                                    completedBlock(transformedImage, nil, SDImageCacheTypeNone, finished, url);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                    else </span><br><span class="line">                    &#123;</span><br><span class="line">                        if (downloadedImage &amp;&amp; finished) </span><br><span class="line">                        &#123;</span><br><span class="line">                            [self.imageCache storeImage:downloadedImage recalculateFromImage:NO imageData:data forKey:key toDisk:cacheOnDisk];</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        dispatch_main_sync_safe(^&#123;</span><br><span class="line">                            if (!weakOperation.isCancelled) </span><br><span class="line">                            &#123;</span><br><span class="line">                                completedBlock(downloadedImage, nil, SDImageCacheTypeNone, finished, url);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (finished) </span><br><span class="line">                &#123;</span><br><span class="line">                    @synchronized (self.runningOperations) &#123;</span><br><span class="line">                        [self.runningOperations removeObject:operation];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;];</span><br><span class="line">    </span><br><span class="line">            operation.cancelBlock = ^&#123;</span><br><span class="line">                [subOperation cancel];</span><br><span class="line"></span><br><span class="line">                @synchronized (self.runningOperations) &#123;</span><br><span class="line">                    [self.runningOperations removeObject:weakOperation];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        else if (image) </span><br><span class="line">        &#123;</span><br><span class="line">            dispatch_main_sync_safe(^&#123;</span><br><span class="line">                if (!weakOperation.isCancelled) </span><br><span class="line">                &#123;</span><br><span class="line">                    completedBlock(image, nil, cacheType, YES, url);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        </span><br><span class="line">            @synchronized (self.runningOperations) &#123;</span><br><span class="line">                [self.runningOperations removeObject:operation];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else </span><br><span class="line">        &#123;</span><br><span class="line">            // Image not in cache and download disallowed by delegate</span><br><span class="line">            dispatch_main_sync_safe(^&#123;</span><br><span class="line">                if (!weakOperation.isCancelled) </span><br><span class="line">                &#123;</span><br><span class="line">                    completedBlock(nil, nil, SDImageCacheTypeNone, YES, url);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        </span><br><span class="line">            @synchronized (self.runningOperations) &#123;</span><br><span class="line">                [self.runningOperations removeObject:operation];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    return operation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="ç”¨åˆ°çš„çŸ¥è¯†ç‚¹"><a href="#ç”¨åˆ°çš„çŸ¥è¯†ç‚¹" class="headerlink" title="ç”¨åˆ°çš„çŸ¥è¯†ç‚¹"></a>ç”¨åˆ°çš„çŸ¥è¯†ç‚¹</h2><p><code>SDWebImage</code>çš„ä¸»è¦åŠŸèƒ½æ˜¯å›¾ç‰‡çš„ä¸‹è½½å’Œç¼“å­˜ï¼Œç”¨åˆ°äº†çŸ¥è¯†ç‚¹éå¸¸å¤š</p><ul><li><code>GCD</code>çš„<code>dispatch_barrier_sync</code>å‡½æ•°ï¼Œè¿™ä¸ªæˆ‘åœ¨<a href="https://www.jianshu.com/p/32f7d4cb051c" target="_blank" rel="noopener">GCDçš„ä½¿ç”¨ï¼ˆä¸‰ï¼‰</a>ä¸­è¯´æ˜è¿‡ã€‚</li><li><code>NSOperationQueue</code>é˜Ÿåˆ—æ“ä½œï¼Œ<code>NSOperationQueue</code>æ˜¯åŸºäº<code>GCD</code>æ¥å®ç°çš„ï¼Œå¯¹<code>SDWebImage</code>ä¸­æˆ‘ä»¬å°±çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ä¾èµ–å°†ä¸‹è½½é¡ºåºè®¾ç½®æˆåè¿›å…ˆå‡ºçš„é¡ºåºã€‚</li><li><code>NSURLConnection</code>ç½‘ç»œè¯·æ±‚ã€‚</li><li><code>NSCache</code>:ç±»ä¼¼äºé›†åˆçš„å®¹å™¨ï¼Œå­˜å‚¨é”®å€¼å¯¹ã€‚</li><li>æ¸…ç†ç¼“å­˜ç­–ç•¥ï¼Œè®¾ç½®è¿‡æœŸæ—¥æœŸå’Œæœ€å¤§ç¼“å­˜ç©ºé—´å¤§å°ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;åœ¨iOSçš„å›¾ç‰‡åŠ è½½æ¡†æ¶ä¸­ï¼ŒSDWebImageå¯è°“æ˜¯å æ®å¤§åŠå£æ±Ÿå±±ã€‚å®ƒæ”¯æŒä»ç½‘ç»œä¸­ä¸‹è½½ä¸”ç¼“å­˜å›¾ç‰‡ï¼Œå¹¶è®¾ç½®å›¾ç‰‡åˆ°å¯¹åº”çš„UIImageViewæ§ä»¶æˆ–è€…UIButtonæ§ä»¶ã€‚åœ¨é¡¹ç›®ä¸­ä½¿ç”¨SDWebImageæ¥ç®¡ç†å›¾ç‰‡åŠ è½½ç›¸å…³æ“ä½œå¯ä»¥æå¤§åœ°æé«˜å¼€å‘æ•ˆç‡ï¼Œè®©æˆ‘ä»¬æ›´åŠ ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å®ç°ã€‚æœ¬ç¯‡æ–‡ç« ä¼šç€é‡è®²è§£&lt;code&gt;SDImageCache&lt;/code&gt;ã€&lt;code&gt;SDWebImageDownloader&lt;/code&gt;è¿™ä¸¤ä¸ªç±»ã€‚&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Runtimeçš„å¸¸è§ç”¨æ³•</title>
    <link href="https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/01/08/Runtime%E7%9A%84%E5%B8%B8%E8%A7%81%E7%94%A8%E6%B3%95/"/>
    <id>https://github.com/iOS-Misaki/iOS-Misaki.github.io/2018/01/08/Runtimeçš„å¸¸è§ç”¨æ³•/</id>
    <published>2018-01-08T08:46:19.000Z</published>
    <updated>2018-10-26T09:29:46.022Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;è¿™åŠå¹´ï¼ŒåŸç”ŸiOSåŸºæœ¬ä¸Šæ²¡æœ‰å¼€å‘ä»»åŠ¡ï¼Œéƒ½æ˜¯ä¸€äº›æ— å…³ç´§è¦çš„è¿­ä»£ã€‚å¤§éƒ¨åˆ†å¼€å‘æ—¶é—´æ”¾åœ¨äº†å‰ç«¯<code>Angular</code>é¡¹ç›®ä¸Šï¼Œç°åœ¨çš„å‰ç«¯æ°´å¹³ä¹Ÿä»…ä»…æ˜¯ï¼Œä¾è‘«èŠ¦ç”»ç“¢ï¼Œåˆšå¥½å®Œæˆå¼€å‘ä»»åŠ¡è€Œå·²ã€‚iOSçš„åŸºç¡€ä¸œè¥¿è™½ç„¶è¯´æ²¡æœ‰ä¸¢ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰å¾€æ›´æ·±çš„æ–¹å‘å»ä¸“ç ”ï¼Œ<code>Swift</code>ä¹Ÿæ˜¯åˆšå¥½ä¼šç”¨ï¼Œæ²¡æœ‰æ·±ç©¶ã€‚æ¸©æ°´ç…®é’è›™ï¼Œå’Œåˆšè¿›å…¬å¸çš„é‚£ä¸€ä¼šæ¯”ï¼Œå¿ƒæ€å·®è·å¾ˆå¤§ã€‚ä»Šå¤©æŠŠä¸€äº›åŸºç¡€æ€§çš„ä¸œè¥¿<code>Runtime</code>ï¼Œé‡æ‹¾ä¸€ä¸‹å§ã€‚</p><a id="more"></a><h2 id="Runtime-ç»™categoryæ·»åŠ å±æ€§"><a href="#Runtime-ç»™categoryæ·»åŠ å±æ€§" class="headerlink" title="Runtime ç»™categoryæ·»åŠ å±æ€§"></a>Runtime ç»™categoryæ·»åŠ å±æ€§</h2><p>&ensp;&ensp;<code>category</code>å’Œç»§æ‰¿ï¼Œæœ‰ç›¸ä¼¼çš„åŠŸèƒ½ã€‚ç»§æ‰¿æ—¢èƒ½æ·»åŠ æ–¹æ³•ï¼Œä¹Ÿèƒ½æ·»åŠ æˆå‘˜å˜é‡ã€‚ç»§æ‰¿æ˜¯å­ç±»ç»§æ‰¿è‡ªçˆ¶ç±»ï¼Œå­ç±»ä¸­å¢åŠ çš„æ–¹æ³•ä¸ä¼šæˆä¸ºçˆ¶ç±»çš„ä¸€éƒ¨åˆ†ã€‚<code>category</code>å¯ä»¥åœ¨ä¸çŸ¥é“ç±»æºç çš„æƒ…å†µä¸‹ï¼Œä¸ºç±»æ·»åŠ æ–°æ–¹æ³•ï¼Œä¸èƒ½æ·»åŠ æˆå‘˜å˜é‡ï¼Œä½†æ˜¯å¯ä»¥ç”¨è¿‡<code>Runtime</code>æ¥å®ç°ã€‚ä»¥å‰é¡¹ç›®ä¸­å¾ˆå¤šé€šç”¨çš„å±æ€§éƒ½ç”¨ç»§æ‰¿å®ç°ï¼Œä½†æ˜¯ä¸å¤ªå¥½ç»´æŠ¤ï¼ˆå®‰æ…°è‡ªå·±ç½¢äº†â˜ºï¼Œä¸¤å¹´äº†ï¼Œä¸€ç›´éƒ½æ˜¯è‡ªå·±ä¸€ä¸ªäººç»´æŠ¤é¡¹ç›®ï¼‰ï¼Œæ”¹æˆ<code>category</code>æ¥å®ç°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface UIViewController (Extension)</span><br><span class="line"></span><br><span class="line">@property (nonatomic,copy) NSString * fileName;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;UIViewController+Extension.h&quot;</span><br><span class="line"></span><br><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line"></span><br><span class="line">@implementation UIViewController (Extension)</span><br><span class="line"></span><br><span class="line">//getter</span><br><span class="line">- (void)setFileName:(NSString *)fileName</span><br><span class="line">&#123;</span><br><span class="line">    objc_setAssociatedObject(self, @selector(fileName), fileName, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//setter</span><br><span class="line">- (NSString *)fileName</span><br><span class="line">&#123;</span><br><span class="line">    NSString * _fileName = objc_getAssociatedObject(self, @selector(fileName));</span><br><span class="line">    if (!_fileName)</span><br><span class="line">    &#123;</span><br><span class="line">        _fileName = @&quot;xx.mp3&quot;;</span><br><span class="line">        objc_setAssociatedObject(self, @selector(fileName), _fileName, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">    &#125;</span><br><span class="line">    return _fileName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Runtime-æ–¹æ³•äº¤æ¢"><a href="#Runtime-æ–¹æ³•äº¤æ¢" class="headerlink" title="Runtime æ–¹æ³•äº¤æ¢"></a>Runtime æ–¹æ³•äº¤æ¢</h2><p>&ensp;&ensp;è¿™ä¸ªå…¶å®å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº†ï¼Œæ¯”å¦‚ç”¨<code>NullSafe</code>æ¥é¿å…é‡åˆ°<code>null</code>å´©æºƒç­‰ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">+ (void)load</span><br><span class="line">&#123;</span><br><span class="line">    //ç±»åŠ è½½æ—¶è°ƒç”¨ï¼Œç¡®ä¿åªæ‰§è¡Œä¸€æ¬¡</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        //åŸå§‹æ–¹æ³• è¿™é‡Œåªæ˜¯ä¸¾ä¾‹ï¼ŒviewWillAppear</span><br><span class="line">        Method originalM = class_getClassMethod([self class], @selector(viewWillAppear:));</span><br><span class="line"></span><br><span class="line">        //è‡ªå®šä¹‰æ–¹æ³•</span><br><span class="line">        Method customM = class_getClassMethod(self, @selector(yy_viewVillAppear:));</span><br><span class="line"></span><br><span class="line">        //äº¤æ¢</span><br><span class="line">        method_exchangeImplementations(originalM, customM);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)yy_viewVillAppear:(BOOL)animated</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;%s&quot;,__FUNCTION__);</span><br><span class="line"></span><br><span class="line">    //è¿™é‡Œå·²ç»æ›¿æ¢äº†æ–¹æ³•viewWillAppearï¼Œæ‰€ä»¥ä¸æ˜¯é€’å½’è°ƒç”¨</span><br><span class="line">    [self yy_viewVillAppear:animated];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Runtime-ç»™Modelèµ‹å€¼"><a href="#Runtime-ç»™Modelèµ‹å€¼" class="headerlink" title="Runtime ç»™Modelèµ‹å€¼"></a>Runtime ç»™Modelèµ‹å€¼</h2><h3 id="å­—å…¸çš„Keyå’ŒModelçš„å±æ€§åç§°ç›¸åŒ"><a href="#å­—å…¸çš„Keyå’ŒModelçš„å±æ€§åç§°ç›¸åŒ" class="headerlink" title="å­—å…¸çš„Keyå’ŒModelçš„å±æ€§åç§°ç›¸åŒ"></a>å­—å…¸çš„Keyå’ŒModelçš„å±æ€§åç§°ç›¸åŒ</h3><h4 id="æ–°å»ºåŸºç±»BaseModel"><a href="#æ–°å»ºåŸºç±»BaseModel" class="headerlink" title="æ–°å»ºåŸºç±»BaseModel"></a>æ–°å»ºåŸºç±»BaseModel</h4><p>&ensp;&ensp;ç»§æ‰¿NSObjectï¼Œé‡Œé¢å†™ä¸€äº›å…¬å…±æ–¹æ³•ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;BaseModel.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation BaseModel</span><br><span class="line"></span><br><span class="line">#pragma mark - é€šè¿‡å­—ç¬¦ä¸²åˆ›å»ºå­—ç¬¦ä¸²çš„setteræ–¹æ³•ï¼Œå¹¶è¿”å›</span><br><span class="line">- (SEL)creatSetterWithPropertyName:(NSString *)properyName</span><br><span class="line">&#123;</span><br><span class="line">    //é¦–å­—æ¯å¤§å†™</span><br><span class="line">    properyName = properyName.capitalizedString;</span><br><span class="line"></span><br><span class="line">    properyName = [NSString stringWithFormat:@&quot;set%@:&quot;,properyName];</span><br><span class="line"></span><br><span class="line">    return NSSelectorFromString(properyName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æŠŠå­—å…¸ä¸­çš„valueèµ‹å€¼ç»™å®ä½“ç±»çš„å±æ€§</span><br><span class="line">- (void)assignToPropertyWithDictionary:(NSDictionary *)dictionary</span><br><span class="line">&#123;</span><br><span class="line">    if (dictionary == nil)</span><br><span class="line">    &#123;</span><br><span class="line">        return ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    NSArray * keyArray = [dictionary allKeys];</span><br><span class="line"></span><br><span class="line">    //å¾ªç¯éå†å­—å…¸çš„key,åŠ¨æ€ç”Ÿæˆå®ä½“ç±»çš„setteræ–¹æ³•ï¼Œç„¶åæŠŠå­—å…¸çš„valueé€šè¿‡setteræ–¹æ³•èµ‹å€¼ç»™å®ä½“ç±»çš„å±æ€§</span><br><span class="line">    for (int i = 0 ; i &lt; keyArray.count ; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        //è·å–å®ä½“ç±»çš„setteræ–¹æ³•</span><br><span class="line">        SEL setSel = [self creatSetterWithPropertyName:keyArray[i]];</span><br><span class="line"></span><br><span class="line">        if ([self respondsToSelector:setSel])</span><br><span class="line">        &#123;</span><br><span class="line">            //è·å–å­—å…¸ä¸­keyå¯¹åº”çš„value</span><br><span class="line">            NSString * value = [NSString stringWithFormat:@&quot;%@&quot;,dictionary[keyArray[i]]];</span><br><span class="line"></span><br><span class="line">            //æŠŠvalueé€šè¿‡setteræ–¹æ³•èµ‹å€¼ç»™å®ä½“ç±»çš„å±æ€§</span><br><span class="line">            [self performSelectorOnMainThread:setSel withObject:value waitUntilDone:[NSThread isMainThread]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;ç„¶åç»™å®ä½“ç±»æä¾›åˆå§‹åŒ–æ–¹æ³•å’Œæ„é€ å™¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - å®ä¾‹æ–¹æ³•</span><br><span class="line">- (instancetype)initWithDictionary:(NSDictionary *)dictionary</span><br><span class="line">&#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self)</span><br><span class="line">    &#123;</span><br><span class="line">        [self assignToPropertyWithDictionary:dictionary];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - ç±»æ–¹æ³•è¿”å›ä¸€ä¸ªå®ä¾‹</span><br><span class="line">+ (instancetype)initWithDictionary:(NSDictionary *)dictionary</span><br><span class="line">&#123;</span><br><span class="line">    return [[self alloc] initWithDictionary:dictionary];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="å®ä¾‹girlModel-ç»§æ‰¿è‡ªBaseModel"><a href="#å®ä¾‹girlModel-ç»§æ‰¿è‡ªBaseModel" class="headerlink" title="å®ä¾‹girlModel,ç»§æ‰¿è‡ªBaseModel"></a>å®ä¾‹girlModel,ç»§æ‰¿è‡ªBaseModel</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;BaseModel.h&quot;</span><br><span class="line"></span><br><span class="line">@interface girlModel : BaseModel</span><br><span class="line"></span><br><span class="line">@property (nonatomic,copy) NSString * girl0;</span><br><span class="line">@property (nonatomic,copy) NSString * girl1;</span><br><span class="line">@property (nonatomic,copy) NSString * girl2;</span><br><span class="line">@property (nonatomic,copy) NSString * girl3;</span><br><span class="line">@property (nonatomic,copy) NSString * girl4;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºå­—å…¸ç»™modelèµ‹å€¼"><a href="#åˆ›å»ºå­—å…¸ç»™modelèµ‹å€¼" class="headerlink" title="åˆ›å»ºå­—å…¸ç»™modelèµ‹å€¼"></a>åˆ›å»ºå­—å…¸ç»™modelèµ‹å€¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">NSMutableDictionary * dic = [[NSMutableDictionary alloc]initWithCapacity:11];</span><br><span class="line">for (int i = 0 ; i &lt; 5 ; i ++ )</span><br><span class="line">&#123;</span><br><span class="line">    NSString * key = [NSString stringWithFormat:@&quot;girl%d&quot;,i];</span><br><span class="line">    NSString * value = [NSString stringWithFormat:@&quot;æˆ‘æ˜¯ç¬¬%dä¸ªå¥³å­©&quot;,i];</span><br><span class="line">    [dic setObject:value forKey:key];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">girlModel * model1 = [girlModel initWithDictionary:dic];</span><br><span class="line">NSLog(@&quot;%@&quot;,model1.girl0);</span><br><span class="line">NSLog(@&quot;%@&quot;,model1.girl1);</span><br><span class="line">NSLog(@&quot;%@&quot;,model1.girl2);</span><br><span class="line">NSLog(@&quot;%@&quot;,model1.girl3);</span><br><span class="line">NSLog(@&quot;%@&quot;,model1.girl4);</span><br></pre></td></tr></table></figure><p>&ensp;&ensp;æˆ–è€…ç”¨setValuesForKeysWithDictionaryæ¥éªŒè¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">girlModel * model2 = [girlModel new];</span><br><span class="line">[model2 setValuesForKeysWithDictionary:dic];</span><br><span class="line">NSLog(@&quot;%@&quot;,model2.girl0);</span><br><span class="line">NSLog(@&quot;%@&quot;,model2.girl1);</span><br><span class="line">NSLog(@&quot;%@&quot;,model2.girl2);</span><br><span class="line">NSLog(@&quot;%@&quot;,model2.girl3);</span><br><span class="line">NSLog(@&quot;%@&quot;,model2.girl4);</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;ä¸Šé¢çš„æ–¹æ³•é€‚ç”¨ä¸å­—å…¸ä¸­çš„key å’Œmodelå±æ€§åä¸€ä¸€å¯¹åº”çš„æƒ…å†µã€‚ä¸‹é¢ä¼šç»™å‡ºå¦‚ä½•å»éå†Modelä¸­å±æ€§çš„å€¼ï¼Œå¹¶ä¸”ç»™å‡ºå­—å…¸çš„Keyå’ŒModelçš„å±æ€§å<strong>ä¸ä¸€æ ·</strong>çš„æƒ…å†µæˆ‘ä»¬è¯¥å¦‚ä½•èµ‹å€¼ã€‚</p><h3 id="å­—å…¸çš„Keyå’ŒModelçš„å±æ€§åç§°ä¸åŒ"><a href="#å­—å…¸çš„Keyå’ŒModelçš„å±æ€§åç§°ä¸åŒ" class="headerlink" title="å­—å…¸çš„Keyå’ŒModelçš„å±æ€§åç§°ä¸åŒ"></a>å­—å…¸çš„Keyå’ŒModelçš„å±æ€§åç§°ä¸åŒ</h3><h4 id="è·å–Modelçš„å®ä½“å±æ€§"><a href="#è·å–Modelçš„å®ä½“å±æ€§" class="headerlink" title="è·å–Modelçš„å®ä½“å±æ€§"></a>è·å–Modelçš„å®ä½“å±æ€§</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - é€šè¿‡runtimeæ¥è·å–modelä¸­æ‰€æœ‰å±æ€§çš„åç§°</span><br><span class="line">- (NSArray *)allPropertNames</span><br><span class="line">&#123;</span><br><span class="line">    //å­˜å‚¨æ‰€æœ‰çš„å±æ€§åç§°</span><br><span class="line">    NSMutableArray * allNames = [[NSMutableArray alloc]init];</span><br><span class="line"></span><br><span class="line">    //å­˜å‚¨å±æ€§çš„ä¸ªæ•°</span><br><span class="line">    unsigned int propertyCount = 0;</span><br><span class="line"></span><br><span class="line">    //é€šè¿‡è¿è¡Œæ—¶è·å–å½“å‰ç±»çš„å±æ€§</span><br><span class="line">    objc_property_t * propertys = class_copyPropertyList([self class], &amp;propertyCount);</span><br><span class="line"></span><br><span class="line">    for (int i = 0 ; i &lt; propertyCount ; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        objc_property_t property = propertys[i];</span><br><span class="line">        const char * propertName = property_getName(property);</span><br><span class="line">        [allNames addObject:[NSString stringWithUTF8String:propertName]];</span><br><span class="line">    &#125;</span><br><span class="line">    //é‡Šæ”¾</span><br><span class="line">    free(propertys);</span><br><span class="line"></span><br><span class="line">    return allNames;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - é€šè¿‡å­—ç¬¦ä¸²æ¥åˆ›å»ºæ”¹å­—ç¬¦ä¸²çš„setteræ–¹æ³•ï¼Œå¹¶è¿”å›</span><br><span class="line">- (SEL)creatGetterWithPropertyName:(NSString *)propertyName</span><br><span class="line">&#123;</span><br><span class="line">    //OCä¸­getteræ–¹æ³•å°±æ˜¯å±æ€§æœ¬èº«</span><br><span class="line">    return NSSelectorFromString(propertyName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Modelçš„å±æ€§åŠ¨æ€çš„æ‰§è¡Œgetteræ–¹æ³•"><a href="#Modelçš„å±æ€§åŠ¨æ€çš„æ‰§è¡Œgetteræ–¹æ³•" class="headerlink" title="Modelçš„å±æ€§åŠ¨æ€çš„æ‰§è¡Œgetteræ–¹æ³•"></a>Modelçš„å±æ€§åŠ¨æ€çš„æ‰§è¡Œgetteræ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">- (void)displayCurrentModelPropert</span><br><span class="line">&#123;</span><br><span class="line">    //è·å–å®ä½“ç±»çš„å±æ€§å</span><br><span class="line">    NSArray * array = [self allPropertNames];</span><br><span class="line"></span><br><span class="line">    NSMutableString * resultString = [[NSMutableString alloc] init];</span><br><span class="line"></span><br><span class="line">    for (int i = 0 ; i &lt; array.count ; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        SEL getSel = [self creatGetterWithPropertyName:array[i]];</span><br><span class="line"></span><br><span class="line">        if ([self respondsToSelector:getSel])</span><br><span class="line">        &#123;</span><br><span class="line">            //è·å¾—ç±»å’Œæ–¹æ³•çš„ç­¾å</span><br><span class="line">            NSMethodSignature * signature = [self methodSignatureForSelector:getSel];</span><br><span class="line"></span><br><span class="line">            //ä»ç­¾åè·å–è°ƒç”¨å¯¹è±¡</span><br><span class="line">            NSInvocation * invocation = [NSInvocation invocationWithMethodSignature:signature];</span><br><span class="line"></span><br><span class="line">            //è®¾ç½®target å’Œ selector</span><br><span class="line">            [invocation setTarget:self];</span><br><span class="line"></span><br><span class="line">            [invocation setSelector:getSel];</span><br><span class="line"></span><br><span class="line">            NSObject * __unsafe_unretained returnValue = nil;</span><br><span class="line"></span><br><span class="line">            [invocation invoke];</span><br><span class="line"></span><br><span class="line">            [invocation getReturnValue:&amp;returnValue];</span><br><span class="line"></span><br><span class="line">            [resultString appendFormat:@&quot;%@\n&quot;,returnValue];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    NSLog(@&quot;%@&quot;,resultString);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&ensp;&ensp;ä¸‹é¢æ¥éªŒè¯ä¸€ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[model1 displayCurrentModelPropert];</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœ<br><img src="http://upload-images.jianshu.io/upload_images/1487718-bb56ac83763e1a5c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å±å¹•å¿«ç…§ 2018-01-17 ä¸‹åˆ8.56.45.png"></p><p>&ensp;&ensp;<strong>å½“å­—å…¸çš„keyå’Œmodelä¸­å±æ€§ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨ä¸€ä¸ªæ˜ å°„æ¥ç»´æŠ¤ã€‚åŸºç±»ä¸­æ·»åŠ ä¸€ä¸ªè¿”å›æ˜ å°„å­—å…¸çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç„¶ååœ¨å­ç±»ä¸­è¿›è¡Œé‡å†™ï¼Œè¿™ä¸ªæ˜ å°„æ–¹æ³•åœ¨åŸºç±»ä¸­è¿”å›nil, å¦‚æœå­ç±»éœ€è¦é‡å†™çš„è¯å°±å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œé‡å†™å¹¶è¿”å›æ˜ å°„å­—å…¸</strong>ã€‚</p><h4 id="æ„å»ºæ˜ å°„å…³ç³»"><a href="#æ„å»ºæ˜ å°„å…³ç³»" class="headerlink" title="æ„å»ºæ˜ å°„å…³ç³»"></a>æ„å»ºæ˜ å°„å…³ç³»</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - æ„å»ºæ˜ å°„å…³ç³»</span><br><span class="line">- (NSDictionary *)propertMap</span><br><span class="line">&#123;</span><br><span class="line">    return nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&ensp;&ensp;ä¿®æ”¹ä¸€ä¸‹åˆå§‹åŒ–æ–¹æ³•ï¼Œåœ¨æœ‰æ˜ å°„å­—å…¸çš„æƒ…å†µå’Œæ²¡æœ‰æ˜ å°„å­—å…¸çš„æƒ…å†µä¸‹è°ƒç”¨çš„æ–¹æ³•æ˜¯ä¸ä¸€æ ·çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - å®ä¾‹æ–¹æ³•</span><br><span class="line">- (instancetype)initWithDictionary:(NSDictionary *)dictionary</span><br><span class="line">&#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self)</span><br><span class="line">    &#123;</span><br><span class="line">        if ([self propertMap] == nil)</span><br><span class="line">        &#123;</span><br><span class="line">            [self assignToPropertyWithDictionary:dictionary];</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            [self assignToPropertyWithNoMapDictionary:dictionary];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)assignToPropertyWithNoMapDictionary:(NSDictionary *)dictionary</span><br><span class="line">&#123;</span><br><span class="line">    //è·å–å­—å…¸å’Œmodelå±æ€§çš„æ˜ å°„å…³ç³»</span><br><span class="line">    NSDictionary * propertyMapDictionary = [self propertMap];</span><br><span class="line"></span><br><span class="line">    NSArray * dicKeyArray = [dictionary allKeys];</span><br><span class="line"></span><br><span class="line">    NSMutableDictionary * tempDic = [[NSMutableDictionary alloc]initWithCapacity:dicKeyArray.count];</span><br><span class="line"></span><br><span class="line">    for (int i = 0 ; i &lt; dicKeyArray.count ; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        NSString * key = dicKeyArray[i];</span><br><span class="line">        [tempDic setObject:dictionary[key] forKey:propertyMapDictionary[key]];</span><br><span class="line">    &#125;</span><br><span class="line">    [self assignToPropertyWithDictionary:tempDic];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;ä¸‹é¢æ–°å»ºä¸€ä¸ªboyMdoelç»§æ‰¿BaseModelï¼Œå¹¶ä¸”é‡å†™æ˜ å°„å…³ç³»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic,copy) NSString * boy0;</span><br><span class="line">@property (nonatomic,copy) NSString * boy1;</span><br><span class="line">@property (nonatomic,copy) NSString * boy2;</span><br><span class="line">@property (nonatomic,copy) NSString * boy3;</span><br><span class="line">@property (nonatomic,copy) NSString * boy4;</span><br><span class="line"></span><br><span class="line">- (NSDictionary *)propertMap</span><br><span class="line">&#123;</span><br><span class="line">    return @&#123;@&quot;key0&quot;:@&quot;boy0&quot;,</span><br><span class="line">             @&quot;key1&quot;:@&quot;boy1&quot;,</span><br><span class="line">             @&quot;key2&quot;:@&quot;boy2&quot;,</span><br><span class="line">             @&quot;key3&quot;:@&quot;boy3&quot;,</span><br><span class="line">             @&quot;key4&quot;:@&quot;boy4&quot;,&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;ç„¶åç”Ÿæˆæ•°æ®éªŒè¯ä¸€ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NSMutableDictionary * dic1 = [[NSMutableDictionary alloc]initWithCapacity:5];</span><br><span class="line">for (int i = 0 ; i &lt; 5 ; i ++ )</span><br><span class="line">&#123;</span><br><span class="line">    NSString * key = [NSString stringWithFormat:@&quot;key%d&quot;,i];</span><br><span class="line">    NSString * value = [NSString stringWithFormat:@&quot;æˆ‘æ˜¯ç¬¬%dä¸ªç”·å­©&quot;,i];</span><br><span class="line">    [dic1 setObject:value forKey:key];</span><br><span class="line">&#125;</span><br><span class="line">boyModel * model3 = [boyModel initWithDictionary:dic1];</span><br><span class="line">[model3 displayCurrentModelPropert];</span><br></pre></td></tr></table></figure></p><p><img src="http://upload-images.jianshu.io/upload_images/1487718-4c39b491400e4cc5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å±å¹•å¿«ç…§ 2018-01-17 ä¸‹åˆ9.21.47.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;è¿™åŠå¹´ï¼ŒåŸç”ŸiOSåŸºæœ¬ä¸Šæ²¡æœ‰å¼€å‘ä»»åŠ¡ï¼Œéƒ½æ˜¯ä¸€äº›æ— å…³ç´§è¦çš„è¿­ä»£ã€‚å¤§éƒ¨åˆ†å¼€å‘æ—¶é—´æ”¾åœ¨äº†å‰ç«¯&lt;code&gt;Angular&lt;/code&gt;é¡¹ç›®ä¸Šï¼Œç°åœ¨çš„å‰ç«¯æ°´å¹³ä¹Ÿä»…ä»…æ˜¯ï¼Œä¾è‘«èŠ¦ç”»ç“¢ï¼Œåˆšå¥½å®Œæˆå¼€å‘ä»»åŠ¡è€Œå·²ã€‚iOSçš„åŸºç¡€ä¸œè¥¿è™½ç„¶è¯´æ²¡æœ‰ä¸¢ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰å¾€æ›´æ·±çš„æ–¹å‘å»ä¸“ç ”ï¼Œ&lt;code&gt;Swift&lt;/code&gt;ä¹Ÿæ˜¯åˆšå¥½ä¼šç”¨ï¼Œæ²¡æœ‰æ·±ç©¶ã€‚æ¸©æ°´ç…®é’è›™ï¼Œå’Œåˆšè¿›å…¬å¸çš„é‚£ä¸€ä¼šæ¯”ï¼Œå¿ƒæ€å·®è·å¾ˆå¤§ã€‚ä»Šå¤©æŠŠä¸€äº›åŸºç¡€æ€§çš„ä¸œè¥¿&lt;code&gt;Runtime&lt;/code&gt;ï¼Œé‡æ‹¾ä¸€ä¸‹å§ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
